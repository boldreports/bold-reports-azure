/*!
*  filename: custom-domain.min.js
*  version : unknown version
*  Copyright Syncfusion Inc. 2001 - 2013. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
function ResetCustomDomainDialog(){$("#custom-domain-name").val("");$(".charge-custom-domain-div").show();$(".validate-custom-domain-div").hide();$(".upload-ssl-certificate-div").hide();$(".domain-registration-success").hide();$("#billing-address-container").hide();$("#card-payment-container").hide();clearCardAndBillingAddressValue();$("#custom-domain-popup").ejDialog({width:440});$("#custom-domain-popup").ejDialog("refresh")}function validateSSLCertificateForm(){var n=$(".input-ssl-certificate").prop("files"),t=$("#ssl-certificate-password").val();return $("#certificate-upload-validation-message").text(""),n.length>0&&t.length>0?($(".custom-domain-input").removeClass("has-error"),$("#ssl-certificate-validate-button").removeAttr("disabled"),!0):($("#ssl-certificate-validate-button").attr("disabled",!0),!1)}function OnCustomDomainOpen(){$("#custom-domain-name").focus()}function OnCustomDomainClose(){ResetCustomDomainDialog()}function UploadSslCertificateFile(){$(".input-file").before(function(){if(!$(this).prev().hasClass("input-ghost")){var n=$("<input type='file' class='input-ssl-certificate' name='sslfile' accept='.pfx' style='visibility:hidden; height:0'>");return n.attr("name",$(this).attr("name")),n.change(function(){n.next(n).find("input").val(n.val().split("\\").pop())}),$(this).find("button.btn-choose").click(function(){n.click()}),$(this).find("button.btn-reset").click(function(){n.val(null);$(this).parents(".input-file").find("input").val("")}),$(this).find("input").css("cursor","pointer"),$(this).find("input").mousedown(function(){return $(this).parents(".input-file").prev().click(),!1}),n}})}function IsValidDomainName(n){var t=new RegExp(/^((?:(?:(?:\w[\.\-\+]?)*)\w)+)((?:(?:(?:\w[\.\-\+]?){0,62})\w)+)\.(\w{2,6})$/);return t.test(n)}function buyCustomDomain(){if(!(isCardExist.toLowerCase()==="true")){if($("#card-pay-now-button").attr("disabled",!0),!$("#card-form-id").valid()){$("#card-pay-now-button").attr("disabled",!1);card._complete&&cvc._complete&&exp._complete||(document.querySelector(".error>.message").textContent="Your card number is incomplete.");return}showWaitingPopup("server-app-container");var o=$("#pay-form-info-fullname").val(),n=$("#name").val(),s=$("#pay-form-info-email").val(),t=$("#pay-form-info-address1").val(),i=$("#pay-form-info-address2").val(),r=$("#pay-form-info-country").val(),u=$("#pay-form-info-city").val(),f=$("#pay-form-info-state").val(),e=$("#pay-form-info-zip").val(),h={name:n!=""?n:undefined,address_line1:t!=""?t:undefined,address_line2:i!=""?i:undefined,address_country:r!=""?r:undefined,address_city:u!=""?u:undefined,address_state:f!=""?f:undefined,address_zip:e!=""?e:undefined};stripe.createToken(card,h).then(function(n){if(n.token){var t=n.token.card;$.ajax({url:createSubscriptionCardUrl,type:"POST",data:{token:n.token.id,fullName:o,email:s,addressLine1:t.address_line1,addressLine2:t.address_line2,city:t.address_city,state:t.address_state,country:t.address_country,zip:t.address_zip},success:function(n){if(n.Status)$("#card-payment-container").hide(),$(".validate-custom-domain-div").show(),$("#custom-domain-name").removeAttr("disabled").val(""),isCardExist="true",hideWaitingPopup("server-app-container");else{hideWaitingPopup("server-app-container");$("#card-pay-now-button").attr("disabled",!1);var t=$("#upgradecard-details .validation-error");n.ErrorCode?t.html(window.Server.App.LocalizationContent.RetryPaymentFailDescription1+n.ErrorCode+" – <a href='"+helpSiteBaseUrl+"/site-settings/payments/error-codes' target='_blank'>"+window.Server.App.LocalizationContent.RetryPaymentFailDescription2):t.html(n.StatusMessage)}}})}else n.error&&n.error.message&&(showCreditcardValidation(n),$("#card-pay-now-button").removeAttr("disabled"),hideWaitingPopup("server-app-container"))})}}function clearCardAndBillingAddressValue(){$("#billing-address-container").children().find("div").removeClass("has-error");$(".validation-error").text("");$("#card-form-id").children().find("input").val("");$("#pay-form-info-country").val("default");$("#pay-form-info-country").selectpicker("refresh");$("#name").val("");card.clear();cvc.clear();exp.clear()}function refreshCustomDomainDialogBoxPosition(){var n=$("#custom-domain-popup");n.ejDialog({width:441});n.ejDialog({width:440});n.ejDialog("refresh")}function showCreditcardValidation(n){var t=document.querySelector(".error>.message");t.textContent=n.error?n.error.message:""}function validateForm(n){n.preventDefault();$(".update-card, .update-card-and-pay").trigger("click")}function enableInputs(n){Array.prototype.forEach.call(n.querySelectorAll("input[type='text'], input[type='email'], input[type='tel']"),function(n){n.removeAttribute("disabled")})}function disableInputs(n){Array.prototype.forEach.call(n.querySelectorAll("input[type='text'], input[type='email'], input[type='tel']"),function(n){n.setAttribute("disabled","true")})}function updateBillingAddress(n,t,i,r,u,f,e,o){$("#update-billing-body").ejWaitingPopup("show");$.ajax({type:"POST",data:{fullName:n,eMail:t,address1:i,address2:r,country:u,city:f,state:e,zip:o},url:updateBillingAddressUrl,success:function(n){$("#update-billing-body").ejWaitingPopup("hide");n.Status?($("#pay-form-info-fullname").val(n.CardDetail.FullName),$("#pay-form-info-address1").val(n.CardDetail.Address1),$("#pay-form-info-address2").val(n.CardDetail.Address2),$("#pay-form-info-city").val(n.CardDetail.City),$("#pay-form-info-state").val(n.CardDetail.State),$("#pay-form-info-zip").val(n.CardDetail.ZipCode),$("#pay-form-info-email").val(n.CardDetail.Email),isBillingAddressChanged=!1,SuccessAlert(window.Server.App.LocalizationContent.UpdateBillingAddressTitle,window.Server.App.LocalizationContent.UpdateBillingAddressSuccess,2e3)):WarningAlert(window.Server.App.LocalizationContent.UpdateBillingAddressTitle,window.Server.App.LocalizationContent.UpdateBillingAddressFailed,2e3)}})}function updateCardDetails(n){$.ajax({type:"POST",data:{cardToken:n},url:updateCardUrl,success:function(n){$("#card-details-popup_wrapper").ejWaitingPopup("hide");n.Status?($("#card-details-popup").ejDialog("close"),card.clear(),cvc.clear(),exp.clear(),window.location.reload()):($(".error").css("display","block"),$(".message").text(n.Data))}})}function updateAndPay(n){$.ajax({type:"POST",data:{cardToken:n},url:updateCardUrl,success:function(n){n.Status?($("#card-details-popup_wrapper").ejWaitingPopup("hide"),$("#card-details-popup").ejDialog("close"),card.clear(),retryPayment()):($("#card-details-popup_wrapper").ejWaitingPopup("hide"),$(".error").css("display","block"),$(".message").text(n.Data))}})}function retryPayment(){var n;window.innerWidth<1280?(n="200px",failurePopupWidth="450px"):(n="190px",failurePopupWidth="440px");messageBox("",window.Server.App.LocalizationContent.RetryPaymentTitle,window.Server.App.LocalizationContent.RetryPaymentWait,"success",function(){onCloseMessageBox()},undefined,undefined,"155px",undefined,"retry-payment-loader");$(".message-box-btn-holder").append("<span class='loader'><\/span>");$.ajax({type:"POST",data:{},url:retryPaymentUrl,success:function(t){$("#server-app-container").ejWaitingPopup("hide");t.Status?messageBox("",window.Server.App.LocalizationContent.RetryPaymentTitle,window.Server.App.LocalizationContent.RetryPaymentSuccess,"success",function(){onCloseMessageBox();location.reload()},undefined,"430px","140px",undefined,"retry-payment-messageBox"):t.Data=="Something went wrong, try again."?messageBox("",window.Server.App.LocalizationContent.RetryPaymentTitle,window.Server.App.LocalizationContent.RetryPaymentFailDescription3,"success",function(){onCloseMessageBox()},undefined,"420px",undefined,undefined,"retry-payment-messageBox"):messageBox("",window.Server.App.LocalizationContent.RetryPaymentTitle,window.Server.App.LocalizationContent.RetryPaymentFailDescription1+"<br/>"+t.Data+" – <a href='"+helpSiteBaseUrl+"/site-settings/payments/error-codes' target='_blank'>"+window.Server.App.LocalizationContent.RetryPaymentFailDescription2,"success",function(){onCloseMessageBox()},undefined,failurePopupWidth,n,undefined,"retry-payment-messageBox")}})}var isBillingAddressChanged;$(document).ready(function(){$("#custom-domain-popup").ejDialog({width:"440px",height:"auto",showOnInit:!1,allowDraggable:!1,enableResize:!1,showHeader:!1,enableModal:!0,open:"OnCustomDomainOpen",close:"OnCustomDomainClose"});UploadSslCertificateFile();$(document).on("click","#card-pay-now-button",function(n){n.preventDefault();$("#card-pay-now-button").is(":visible")&&buyCustomDomain()})});$(document).on("click","#add-custom-domain",function(){$("#custom-domain-popup").show();$("#custom-domain-popup").ejDialog("open")});$(document).on("click",".close-custom-domain",function(){$("#custom-domain-popup").ejDialog("close")});$(document).on("click",".registration-success-close",function(){$("#custom-domain-popup").ejDialog("close");location.reload()});$(document).on("click","#custom-domain-buy-button",function(){$(".charge-custom-domain-div").hide();isCardExist.toLowerCase()==="true"?($(".validate-custom-domain-div").show(),$("#custom-domain-name").removeAttr("disabled").val(""),refreshCustomDomainDialogBoxPosition()):($("#billing-address-container").show(),$("#custom-domain-popup").ejDialog({width:560}),$("#custom-domain-popup").ejDialog("refresh"),$("#pay-form-info-fullname").focus())});$(document).on("click","#billing-address-validate-button",function(n){$("#billing-address-validate-button").is(":visible")&&$("#card-form-id").valid()&&(n.preventDefault(),$("#card-payment-container").show(),$("#billing-address-container").hide(),$("#custom-domain-popup").ejDialog({width:440}),$("#custom-domain-popup").ejDialog("refresh"),card.focus())});$(document).on("click","#ssl-certificate-validate-back",function(){$(".validate-custom-domain-div").show();$(".upload-ssl-certificate-div").hide()});$(document).on("click",".custom-domain-link-copy",function(){var n=$(".custom-domain-link-copy");$(".custom-domain-link").select();/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)?n.removeClass("su su-copy").attr("data-original-title",""):(document.execCommand("copy"),n.tooltip("hide").attr("data-original-title",window.Server.App.LocalizationContent.Copysuccess).tooltip("fixTitle").tooltip("show"),setTimeout(function(){n.attr("data-original-title",window.Server.App.LocalizationContent.LinkCopy);n.tooltip()},7e3))});$(document).on("click","#card-pay-back",function(){$("#billing-address-container").show();$("#card-payment-container").hide();$("#custom-domain-popup").ejDialog({width:560});$("#custom-domain-popup").ejDialog("refresh");$("#pay-form-info-fullname").focus()});$(document).on("keyup","#custom-domain-name",function(n){this.value=this.value.toLowerCase();var t=$("#custom-domain-name").val().trim();t.length>0&&IsValidDomainName(t)?($(".custom-domain-input").removeClass("has-error"),$("#custom-domain-validate-button").removeAttr("disabled"),n.which==13&&$("#custom-domain-validate-button").click()):$("#custom-domain-validate-button").attr("disabled",!0)});$(document).on("keyup","#billing-address-container",function(n){n.which==13&&$("#billing-address-container").is(":visible")&&$("#card-form-id").valid()&&$("#billing-address-validate-button").click()});$(document).on("keyup","#ssl-certificate-password",function(n){validateSSLCertificateForm()&&n.which==13&&$("#ssl-certificate-validate-button").click()});$(document).on("change",".input-ssl-certificate",function(){validateSSLCertificateForm()});$(document).on("click","#custom-domain-validate-button",function(){$("#custom-domain-name, #custom-domain-validate-button").attr("disabled",!0);$("#domain-validation-message").text("");var n=$("#custom-domain-name").val().trim();n.length>0&&IsValidDomainName(n)&&($("#custom-domain-validate-button").append($("<span class='col-sm-4 no-padding loader-gif'><div class='loader-blue loader-icon' id='schedule-name-validation-loader-icon'><svg class='circular'><circle class='path' cx='27' cy='27' r='10' fill='none' stroke-width='4' stroke-miterlimit='10'><\/circle><\/svg><\/div><\/span>")),$.ajax({type:"POST",url:validateCustomDomainUrl,data:{customHostName:n},success:function(n){$("#custom-domain-name").removeAttr("disabled");$("span.loader-gif").remove();n.Status?($(".validate-custom-domain-div").hide(),$(".upload-ssl-certificate-div").show(),$(".input-ssl-certificate, .ssl-browsefile-input, #ssl-certificate-password").val(""),$("#certificate-upload-validation-message").text(""),$("#ssl-certificate-validate-button").attr("disabled",!0)):($(".custom-domain-input").addClass("has-error"),$("#domain-validation-message").text(n.StatusMessage),$("#custom-domain-name").focus())},error:function(){$("#custom-domain-name").removeAttr("disabled")}}))});$(document).on("click","#ssl-certificate-validate-button",function(){if(validateSSLCertificateForm()){$("#ssl-certificate-validate-button").append($("<span class='col-sm-4 no-padding loader-gif'><div class='loader-blue loader-icon' id='schedule-name-validation-loader-icon'><svg class='circular'><circle class='path' cx='27' cy='27' r='10' fill='none' stroke-width='4' stroke-miterlimit='10'><\/circle><\/svg><\/div><\/span>"));$("#ssl-certificate-password, .ssl-browsefile-button, .ssl-browsefile-input, #ssl-certificate-validate-back, #ssl-certificate-validate-button").attr("disabled",!0);var t=$("#custom-domain-name").val().trim(),n=new FormData,i=$(".input-ssl-certificate")[0].files[0];n.append("pfxBlobArray",i);n.append("password",$("#ssl-certificate-password").val());n.append("customHostName",t);$.ajax({type:"POST",url:addCustomDomainUrl,data:n,contentType:!1,processData:!1,success:function(n){$("span.loader-gif").remove();$("#ssl-certificate-password, .ssl-browsefile-button, .ssl-browsefile-input, #ssl-certificate-validate-back").removeAttr("disabled");$("#ssl-certificate-password").val("");n.Status?($(".upload-ssl-certificate-div").hide(),$(".custom-domain-address").text(t),$(".custom-domain-address").attr("href","https://"+t),$(".valid-until-date").text(n.ExpirationDate),$(".domain-registration-success").show()):$("#certificate-upload-validation-message").text(n.StatusMessage)},error:function(){$("#ssl-certificate-password, .ssl-browsefile-button, .ssl-browsefile-input, #ssl-certificate-validate-back").removeAttr("disabled");$("#ssl-certificate-password").val("")}})}});var card=null,cvc=null,exp=null,stripe;$(document).ready(function(){function s(n){var t=document.getElementById("brand-icon"),u="su-credit-card",r;for((n in i)&&(u=i[n]),r=t.classList.length-1;r>=0;r--)t.classList.remove(t.classList[r]);t.classList.add(u)}function e(){if(isCardExist){var n=$("#name").val(),t={name:n!=""?n:undefined};$("#card-details-popup_wrapper").ejWaitingPopup("show");stripe.createToken(card,t).then(function(n){n.token?$(".update-card-and-pay").length==1?updateAndPay(n.token.id):$(".update-card").length==1&&updateCardDetails(n.token.id):(n.error&&n.error.message&&showCreditcardValidation(n),$("#card-details-popup_wrapper").ejWaitingPopup("hide"))})}}function o(){$("#card-details-popup").ejDialog("close");$("#name").val("");card.clear();cvc.clear();exp.clear()}var r,u,f,n,t,i;generateProfileAvatar();r=createLoader("update-billing-body");$("#update-billing-body").ejWaitingPopup({template:$("#"+r)});u=createLoader("server-app-container");$("#server-app-container").ejWaitingPopup({template:$("#"+u)});$("#tenant-status").length>0&&$("#tenant-status").val().toLowerCase()=="suspended"&&$("#notification-section").css("display","none");$("#card-details-popup").ejDialog({width:"470px",showOnInit:!1,allowDraggable:!1,enableResize:!1,enableModal:!0,showHeader:!1,closeOnEscape:!0});$("#messageBox").ejDialog({width:parent.window.innerWidth>460?"450px":parent.window.innerWidth-10,height:"150px",showOnInit:!1,allowDraggable:!0,enableResize:!1,showHeader:!1,enableModal:!0,close:"onMessageDialogClose"});f=createLoader("card-details-popup_wrapper");$("#card-details-popup_wrapper").ejWaitingPopup({template:$("#"+f)});stripe=Stripe($("#stripePublicKey").text().trim());n=stripe.elements();t={base:{fontSize:"12px"},invalid:{iconColor:"#a94442",color:"#a94442"}};card=n.create("cardNumber",{hidePostalCode:!0,placeholder:"XXXX XXXX XXXX XXXX",style:t});card.mount("#card-number");cvc=n.create("cardCvc",{placeholder:"CVC",style:t});cvc.mount("#card-cvc");exp=n.create("cardExpiry",{placeholder:"MM / YY",style:t});exp.mount("#card-exp");i={visa:"su-visa",mastercard:"su-mastercard",amex:"su-american-express",discover:"su-discover",diners:"su-diners",jcb:"su-jcb",unionpay:"su-unionpay",unknown:"su-credit-card"};card.on("change",function(n){n.brand&&s(n.brand);showCreditcardValidation(n)});exp.on("change",function(n){showCreditcardValidation(n)});cvc.on("change",function(n){showCreditcardValidation(n)});$(document).on("click",".update-card, .update-card-and-pay",function(n){n.preventDefault();e()});$(document).on("click",".cancel-update",function(){o()});$(document).on("click",".edit-card, .update-and-pay ",function(){$("#card-details-popup").ejDialog("open")});$(document).keyup(function(n){n.which==13&&$("#update-card-container").is(":visible")&&(isCardExist?e():$("#payment-submit").click())});$(document).on("click",".PopupClose",function(){o()});$.validator.addMethod("isRequired",function(n){return!isEmptyOrWhitespace(n)},window.Server.App.LocalizationContent.ItemNameValidator);$.validator.addMethod("isValidEmail",function(n){return n.trim()===""?!0:IsEmail(n)},window.Server.App.LocalizationContent.IsValidEmail);$("#card-form-id").validate({errorElement:"span.validation-error",ignore:"",onkeyup:function(n,t){t.keyCode!=9?$(n).valid():!0},onfocusout:function(n){$(n).valid()},rules:{"pay-form-info-fullname":{isRequired:!0},"pay-form-info-email":{isRequired:!0,isValidEmail:!0},"pay-form-info-address1":{isRequired:!0},"pay-form-info-address2":{isRequired:!1},"pay-form-info-city":{isRequired:!0},"pay-form-info-country":{isRequired:!0},"pay-form-info-state":{isRequired:!0},"pay-form-info-zip":{isRequired:!0}},highlight:function(n){var t=$("#"+n.id).not(":disabled");t&&$(n).closest("div").addClass("has-error")},unhighlight:function(n){$(n).closest("div").removeClass("has-error");$(n).closest("div").find("span.validation-error").html("")},errorPlacement:function(n,t){var i=$("#"+t.context.id).not(":disabled");i&&$(t).closest("div").find("span.validation-error").html(n.html())},messages:{"pay-form-info-fullname":{isRequired:window.Server.App.LocalizationContent.FullnameValidator},"pay-form-info-email":{isRequired:window.Server.App.LocalizationContent.EmailValidator,isValidEmail:window.Server.App.LocalizationContent.IsValidEmail},"pay-form-info-address1":{isRequired:window.Server.App.LocalizationContent.AddressValidator},"pay-form-info-city":{isRequired:window.Server.App.LocalizationContent.CityValidator},"pay-form-info-country":{isRequired:window.Server.App.LocalizationContent.CountryValidator},"pay-form-info-state":{isRequired:window.Server.App.LocalizationContent.StateValidator},"pay-form-info-zip":{isRequired:window.Server.App.LocalizationContent.ZipValidator},"pay-form-info-card-name":{isRequired:window.Server.App.LocalizationContent.NameonCardValidator}}})});isBillingAddressChanged=!1;$(document).on("change","#pay-form-info-fullname, #pay-form-info-email, #pay-form-info-address1, #pay-form-info-address2, #pay-form-info-state, #pay-form-info-city, #pay-form-info-zip, #pay-form-info-country",function(){isBillingAddressChanged=!0;$("#validation-detail>.validation-error").text("")});$(document).on("click",".update-billing-address",function(){if(isBillingAddressChanged){var t=document.querySelector(".pay-form-info"),n=t.querySelector("form"),i=n.querySelector("#pay-form-info-fullname"),r=n.querySelector("#pay-form-info-address1"),u=n.querySelector("#pay-form-info-address2"),f=n.querySelector("#pay-form-info-city"),e=n.querySelector("#pay-form-info-state"),o=n.querySelector("#pay-form-info-zip"),s=n.querySelector("#pay-form-info-country"),h=n.querySelector("#pay-form-info-email");$("#card-form-id").valid()&&(disableInputs(n),updateBillingAddress(i.value,h.value,r.value,u.value,s.value,f.value,e.value,o.value),enableInputs(n))}else $("#validation-detail>.validation-error").text(window.Server.App.LocalizationContent.BillingAddressNotChanged)});$(document).on("click",".retry-payment ",function(){retryPayment()});$(document).on("click","#payment-submit",function(n){if($("#payment-submit").attr("disabled",!0),!$("#card-form-id").valid()){$("#payment-submit").attr("disabled",!1);card._complete&&cvc._complete&&exp._complete||(document.querySelector(".error>.message").textContent="Your card number is incomplete.");return}showWaitingPopup("server-app-container");n.preventDefault();var s=$("#pay-form-info-fullname").val(),t=$("#name").val(),h=$("#pay-form-info-email").val(),i=$("#pay-form-info-address1").val(),r=$("#pay-form-info-address2").val(),u=$("#pay-form-info-country").val(),f=$("#pay-form-info-city").val(),e=$("#pay-form-info-state").val(),o=$("#pay-form-info-zip").val(),c={name:t!=""?t:undefined,address_line1:i!=""?i:undefined,address_line2:r!=""?r:undefined,address_country:u!=""?u:undefined,address_city:f!=""?f:undefined,address_state:e!=""?e:undefined,address_zip:o!=""?o:undefined};stripe.createToken(card,c).then(function(n){if(n.token){var t=n.token.card;$.ajax({url:createSubscriptionCardUrl,type:"POST",data:{token:n.token.id,fullName:s,email:h,addressLine1:t.address_line1,addressLine2:t.address_line2,city:t.address_city,state:t.address_state,country:t.address_country,zip:t.address_zip},success:function(n){if(n.Status)hideWaitingPopup("server-app-container"),SuccessAlert(window.Server.App.LocalizationContent.Payments,window.Server.App.LocalizationContent.AddPaymentDetailSuccess,7e3),card.clear(),cvc.clear(),exp.clear(),window.location.reload();else{hideWaitingPopup("server-app-container");$("#payment-submit").attr("disabled",!1);var t=$("#add-card-details .validation-error");n.ErrorCode?t.html(window.Server.App.LocalizationContent.RetryPaymentFailDescription1+n.ErrorCode+" – <a href='"+helpSiteBaseUrl+"/site-settings/payments/error-codes' target='_blank'>"+window.Server.App.LocalizationContent.RetryPaymentFailDescription2):t.html(n.StatusMessage)}}})}else n.error&&n.error.message&&(showCreditcardValidation(n),$("#payment-submit").removeAttr("disabled"),hideWaitingPopup("server-app-container"))})});$(document).on("click",".selectpicker",function(){$(this).parent().parent().removeClass("has-error");$(this).parent().parent().closest("div").find("span.validation-error").html("")})