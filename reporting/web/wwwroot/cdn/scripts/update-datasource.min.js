/*!
*  filename: update-datasource.min.js
*  version : unknown version
*  Copyright Syncfusion Inc. 2001 - 2013. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
function showEJ2Spinner(n){ejs.popups.showSpinner($(n)[0])}function hideEJ2Spinner(n){ejs.popups.hideSpinner($(n)[0])}function renderEJ2Textbox(n,t){if(n.ej2_instances==undefined){let i=new ejs.inputs.TextBox({width:t});i.appendTo(n)}}function createEJ2Spinner(n){ejs.popups.createSpinner({target:$(n)[0],cssClass:"e-spin-overlay"})}function renderEJ2Button(n,t){let i=new ejs.buttons.Button({isPrimary:t});i.appendTo(n)}function initializeToastControl(){toastInstance=new ejs.notifications.Toast({title:window.Server.App.LocalizationContent.Success+"!",content:window.Server.App.LocalizationContent.DatasourceUpdateSuccess,target:document.body,cssClass:"e-toast-success",timeOut:1e3,close:function(){toastInstance.toastCloseCb()},position:{X:"Right",Y:"Top"},showCloseButton:!0,newestOnTop:!0,animation:{hide:{effect:"SlideRightOut"},show:{effect:"SlideRightIn"}}});toastInstance.appendTo(".dc-toast")}function showToast(n){toastInstance.show();toastInstance.toastCloseCb=n}function closePopup(){parent.$(".ud-iframe").attr("src","");parent.$(".ud-popup")[0].ej2_instances[0].hide()}function extractXSRFTokenFromCookie(){var n=parent.document.cookie.split("; ").find(n=>n.startsWith("XSRF-TOKEN="));return n?n.split("=")[1]:null}function setXSRFRequestHeader(n){n.setRequestHeader("X-XSRF-TOKEN",extractXSRFTokenFromCookie())}function decodeHtmlAsString(n){var t=document.createElement("textarea");return t.innerHTML=n,t.value}let updateDataSourceApp=angular.module("updateDataSourceApp",["ejangular"]);updateDataSourceApp.config(["$httpProvider",function(n){n.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";n.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded"}]);updateDataSourceApp.service("ajaxService",["$http","$q",function(n,t){function u(n){return!angular.isObject(n.data)||!n.data.message?t.reject(window.Server.App.LocalizationContent.UnknownError):t.reject(n.data.message)}function f(n){return n.data}let i,r=!1;return{get:function(e){r&&i.resolve();r=!0;i=t.defer();let o=n({method:"get",url:e,timeout:i.promise});return o.then(f,u)},postQueryData:function(t,i){let r=n({method:"post",url:t,data:JSON.stringify(i),headers:{"Content-Type":"application/json"}});return r.then(f,u)},cancelRequest:function(){r&&i.resolve()}}}]);let toastInstance;$(document).ready(function(){initializeToastControl()});createEJ2Spinner(".ud-container");showEJ2Spinner(".ud-container");updateDataSourceApp.controller("updateDataSourceCtrl",["$scope","ajaxService",function(n){n.connectorList=[];n.dataList=[];n.categories=[];n._CryptoAES=window.CryptoJS;n._keyCode=(Math.random()+" ").substring(2,10)+(Math.random()+" ").substring(2,10);n._ivCode=(Math.random()+" ").substring(2,10)+(Math.random()+" ").substring(2,10);n._key=n._CryptoAES.enc.Utf8.parse(n._keyCode);n._iv=n._CryptoAES.enc.Utf8.parse(n._ivCode);n.datasourceCallback=function(t){availableDSList=n.sortCollection(t,"name");n.doAjaxRequest("GET",getDataConnectors,{},$.proxy(n.getConnectionInfo,this))};n.convertTilesInfoFormat=function(n){for(var t,u,r=[],i=0;i<n.length;i++)t=n[i],u=ej.isNullOrUndefined(t.category)?"Rest":t.category,r.push({id:t.id,iconClassName:t.src+"-tile",category:u,itemType:t.itemType,extType:t.extType,displayName:t.name,connector:t.connector,description:t.description});return r};n.initializeDesigner=function(){var t={serviceUrl:serviceURL,reportServerUrl:serverURL,isAzureApp:isAzureApplication,serviceAuthorizationToken:designerToken,ajaxBeforeLoad:n.ajaxBeforeSend,encryptData:n.encryptData,decryptData:n.decryptData,customBrandSettings:{hideHelpLink:isHideHelpLink,customDomain:customDomain,customBrandName:custombrandName,customLinks:window.customLinks}};designerInstance=new boldReportDesigner($("#updateDesigner"),t)};(getConnectorList=function(){var t=$.proxy(n.datasourceCallback,this);n.initializeDesigner();designerInstance.getDataConnectorsInfo(t,null)})();n.getConnectionInfo=function(t){t&&t.status&&t.data&&(connectionList=t.data.connectionList);n.dataList=n.convertTilesInfoFormat(availableDSList);n.connectorList=n.dataList;var i=[];n.connectorList.filter(function(n){i.push(n.category)});n.selectedDataConnector=Array.prototype.filter.call(n.connectorList,function(n){var t=conString.ConnectionProperties.DataProvider,i=t;return t.indexOf("_")!==-1&&(i=t.split("_")[0]),i.toLowerCase()===n.extType.toLowerCase()})[0];hideEJ2Spinner(".ud-container");n.$apply()};n.doAjaxRequest=function(t,i,r,u){$.ajax({type:t,url:i,data:r,beforeSend:function(t){t.setRequestHeader("ServerUrl",serverURL);t.setRequestHeader("serviceAuthorizationToken",designerToken);n._setRequestHeader(t)},success:function(n){(u,n)&&ej.ReportUtil.invokeCallBack(u,n)},error:function(){ej.ReportUtil.invokeCallBack(u,null)}})};n.sortCollection=function(n,t){return n.sort(function(n,i){return n[t]<i[t]?-1:n[t]>i[t]?1:0})};n._encryptData=function(t){return n._CryptoAES.AES.encrypt(n._CryptoAES.enc.Utf8.parse(t),_key,{keySize:16,iv:_iv,mode:n._CryptoAES.mode.CBC,padding:n._CryptoAES.pad.Pkcs7}).toString()};n._decryptData=function(t){return n._CryptoAES.AES.decrypt(t,_key,{keySize:16,iv:_iv,mode:n._CryptoAES.mode.CBC,padding:n._CryptoAES.pad.Pkcs7}).toString(n._CryptoAES.enc.Utf8)};n.encryptData=function(t){t&&t.data&&(t.data=n._encryptData(t.data))};n.decryptData=function(t){t&&t.data&&(t.data=n._decryptData(t.data))};n._injectKeys=function(t){t&&t.headers&&(t.headers.push({Key:"keyCode",Value:n._keyCode}),t.headers.push({Key:"ivCode",Value:n._ivCode}))};n._setRequestHeader=function(t){t&&(t.setRequestHeader("keyCode",n._keyCode),t.setRequestHeader("ivCode",n._ivCode))};n.ajaxBeforeSend=function(t){n._injectKeys(t)}}]);updateDataSourceApp.controller("connectDataHeaderCtrl",["$scope",function(n){n.onCloseBtnClick=function(){closePopup()}}]);let connectorScope;updateDataSourceApp.controller("connectorCtrl",["$scope","ajaxService",function(n,t){connectorScope=n;n.isCustomExtension=n.selectedDataConnector.itemType==="e-custom";angular.element(".dc-header").text(n.selectedDataConnector.displayName);let i=new ejs.popups.Tooltip({content:"valudescription",target:".dc-description-img",position:"RightBottom",offsetY:-10,cssClass:"e-rpt-label-tooltip",windowCollision:!0,animation:{open:{effect:"FadeIn",duration:500,delay:0},close:{effect:"FadeOut",duration:500,delay:0}}});i.beforeOpen=function(){i.content="Connect To "+n.selectedDataConnector.description;i.dataBind()};i.appendTo(angular.element(".dc-header-container")[0]);n.updateDataContainerHeight=function(){angular.element(".dc-container").css("height",window.innerHeight-angular.element(".ud-header-container").height()-angular.element(".ud-footer-container").height())};n.updateDesignerContainerHeight=function(){return window.innerHeight-(angular.element(".data-designer-container")[0].getBoundingClientRect().top-angular.element(".ud-header-container")[0].getBoundingClientRect().top)-angular.element(".ud-footer-container").height()-24};angular.element(".data-designer-container").css("height",n.updateDesignerContainerHeight());window.addEventListener("resize",n.updateDataContainerHeight);n.resizeTO=undefined;n.reportDataExtensions=dataExtensions;n._CryptoAES=window.CryptoJS;n._keyCode=(Math.random()+" ").substring(2,10)+(Math.random()+" ").substring(2,10);n._ivCode=(Math.random()+" ").substring(2,10)+(Math.random()+" ").substring(2,10);n._key=n._CryptoAES.enc.Utf8.parse(n._keyCode);n._iv=n._CryptoAES.enc.Utf8.parse(n._ivCode);n.onAjaxBeforeLoad=function(t){t&&t.headers&&(t.headers.push({Key:"keyCode",Value:n._keyCode}),t.headers.push({Key:"ivCode",Value:n._ivCode}))};n.encryptData=function(t){t&&t.data&&(t.data=n._CryptoAES.AES.encrypt(n._CryptoAES.enc.Utf8.parse(t.data),n._key,{keySize:16,iv:n._iv,mode:n._CryptoAES.mode.CBC,padding:n._CryptoAES.pad.Pkcs7}).toString())};n.decryptData=function(t){t&&t.data&&(t.data=n._CryptoAES.AES.decrypt(t.data,n._key,{keySize:16,iv:n._iv,mode:n._CryptoAES.mode.CBC,padding:n._CryptoAES.pad.Pkcs7}).toString(n._CryptoAES.enc.Utf8))};n.onDesignerCreate=function(){this.model.filterDataConnectors=window.connectionList;this.dataExtensions=designerInstance.dataExtensions;this.builtInExts=designerInstance.builtInExts;this.isOnPremiseMode=window.isSelfHosted;n.isCustomExtension&&(this.dataExtensions=[n.selectedDataConnector.extType]);this.dataSource.renderContainer($(".dataContainer"));n.renderDescription.call(this);this.dataSource.configTable.data("selected",n.selectedDataConnector.itemType);this.dataSource.configTable.data("selectedExt",n.selectedDataConnector.extType);$("#dataDesigner_datasource_dsname").val(decodeHtmlAsString(dataSourceDetail.Name));$("#dataDesigner_datasource_descname").val(decodeHtmlAsString(dataSourceDetail.Description));this.dataSource.editData(conString.ConnectionProperties.DataProvider,conString);let t=n.isCustomExtension?this.extensiondataSource:this.dataSource;t.validateConnection=function(t,i){$(".dataContainer").find(".e-rptdesigner-error").length||(n.isCustomExtension?n.connectionResult(t,i,this):n.connectionResult(this.constructCon(),t,this))};t.showIndicator=function(){showEJ2Spinner(".ud-container")};t.hideIndicator=function(){hideEJ2Spinner(".ud-container")}};n.renderDescription=function(){let n=this._id+"_datasource_descname";this.dataSource.renderTextArea(window.Server.App.LocalizationContent.Description,n,$("table.e-rptdesigner-dsconfig-table"));$("#"+n).attr("maxlength",1024);$("#"+n+"_td").append('<div class="descname-info">* '+window.Server.App.LocalizationContent.MaxNoOfCharacters+"<\/div>")};n.testConnection=function(t){n.dataDesigner.dataSource.connectionCallBack=t;n.dataDesigner.dataSource.connectDatasource()};n.showValidationMsg=function(n,t,i){let r=$("#"+n+"_error_icon_td"),u=$("#"+n+"_td").find(".e-designer-content-label");t?(ej.ReportUtil.showErrIndictor(r,!0,i),u.addClass("e-rptdesigner-error")):(ej.ReportUtil.showErrIndictor(r,!1),u.removeClass("e-rptdesigner-error"))};n.updateDataSource=function(i){let r={Name:$("#dataDesigner_datasource_dsname").val(),Description:$("#dataDesigner_datasource_descname").val(),IsNameChanged:$("#dataDesigner_datasource_dsname").val()!==dataSourceDetail.Name,IsDescriptionChanged:$("#dataDesigner_datasource_descname").val()!==dataSourceDetail.Description,Id:dataSourceDetail.Id};t.postQueryData(updateURL,{conString:JSON.stringify(i),dataSourceDetail:JSON.stringify(r)}).then(function(t){hideEJ2Spinner(".ud-container");t.error?n.dataDesigner.getInstance("ReportUtil").ejAlertDialog(window.Server.App.LocalizationContent.DataConnector,t.error,!1,!0,!1,window.Server.App.LocalizationContent.DataFailure):t.result.IsNameExist?n.showValidationMsg("dataDesigner_datasource_dsname",!0,window.Server.App.LocalizationContent.IsDataSourceExist):(n.dataSourceName=i.Name,n.dataDesigner.dataSource.connectionCallBack())})};n.connectionResult=function(t,i,r){i==="true"?(showEJ2Spinner(".ud-container"),t.ConnectionProperties.EmbeddedData?(delete t.ConnectionProperties.EmbeddedData.__type,n.dataDesigner.getInstance("ReportUtil").doAjaxPost("POST",ej.ReportUtil.getTenantUrl(n.dataDesigner.model.serviceUrl+"/PostDesignerAction/",n.dataDesigner.model.tenantName),{action:"EmbeddedData",data:JSON.stringify({designerAction:"EmbeddedData",embeddedData:t.ConnectionProperties.EmbeddedData})},{fnction:i=>{i.indexOf("Sf_Exception")!==-1?n.dataDesigner.getInstance("ReportUtil").ejAlertDialog(window.Server.App.LocalizationContent.DataConnector,i,!1,!0,!1,window.Server.App.LocalizationContent.EmbeddeddDataFailure):(t.ConnectionProperties.EmbeddedData.Data=i,n.updateDataSource(t))},indicator:[null,null]})):n.updateDataSource(t)):r.reportDesigner.getInstance("ReportUtil").ejAlertDialog(r.getLocale("alertLabel"),i,!1,!0,!1,r.getLocale("alertConnectionFailed"),{})};n.$on("$destroy",function(){window.removeEventListener("resize",n.updateDataContainerHeight)})}]);updateDataSourceApp.controller("connectDataFooterCtrl",["$scope",function(n){n.onUpdateBtnClick=function(){connectorScope.testConnection(function(){showToast(function(){parent.location.reload()})})}}]);renderEJ2Button(angular.element(".ud-footer-update-btn")[0],!0);$.ajaxSetup({beforeSend:function(n){setXSRFRequestHeader(n)}})