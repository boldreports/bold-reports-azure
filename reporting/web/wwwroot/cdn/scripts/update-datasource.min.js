/*!
*  filename: update-datasource.min.js
*  version : unknown version
*  Copyright Syncfusion Inc. 2001 - 2013. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
function initializeToastControl(){toastInstance=new ejs.notifications.Toast({title:"Success!",content:"Data Source has been updated successfully",target:document.body,cssClass:"e-toast-success",timeOut:1e3,close:function(){toastInstance.toastCloseCb()},position:{X:"Right",Y:"Top"},showCloseButton:!0,newestOnTop:!0,animation:{hide:{effect:"SlideRightOut"},show:{effect:"SlideRightIn"}}});toastInstance.appendTo(".dc-toast")}function showToast(n){toastInstance.show();toastInstance.toastCloseCb=n}function hideDataSourceWaitingPopup(){waitingPopUpElement=parent.$(".ud-popup");hideWaitingPopup(waitingPopUpElement)}function closePopup(){parent.$(".ud-iframe").attr("src","");parent.$(".ud-popup").ejDialog("close")}let updateDataSourceApp=angular.module("updateDataSourceApp",["ejangular"]);updateDataSourceApp.config(["$httpProvider",function(n){n.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";n.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded"}]);updateDataSourceApp.service("ajaxService",["$http","$q",function(n,t){function u(n){return!angular.isObject(n.data)||!n.data.message?t.reject(window.Server.App.LocalizationContent.UnknownError):t.reject(n.data.message)}function f(n){return n.data}let i,r=!1;return{get:function(e){r&&i.resolve();r=!0;i=t.defer();let o=n({method:"get",url:e,timeout:i.promise});return o.then(f,u)},postQueryData:function(t,i){let r=n({method:"post",url:t,data:JSON.stringify(i),headers:{"Content-Type":"application/json"}});return r.then(f,u)},cancelRequest:function(){r&&i.resolve()}}}]);let toastInstance;$(document).ready(function(){initializeToastControl()});updateDataSourceApp.controller("updateDataSourceCtrl",["$scope","ajaxService",function(n){n.connectorList=[];n.dataList=[];n.categories=[];n.datasourceCallback=function(t){availableDSList=n.sortCollection(t,"name");n.doAjaxRequest("GET",getDataConnectors,{},$.proxy(n.getConnectionInfo,this))};n.convertTilesInfoFormat=function(n){for(var t,u,r=[],i=0;i<n.length;i++)t=n[i],u=ej.isNullOrUndefined(t.category)?"Rest":t.category,r.push({id:t.id,iconClassName:t.src+"-tile",category:u,itemType:t.itemType,extType:t.extType,displayName:t.name,connector:t.connector,description:t.description});return r};n.initializeDesigner=function(){var n={serviceUrl:serviceURL,reportServerUrl:serverURL,isAzureApp:isAzureApplication,serviceAuthorizationToken:designerToken,customBrandSettings:{hideHelpLink:isHideHelpLink,customDomain:customDomain,customBrandName:custombrandName,customLinks:window.customLinks}};designerInstance=new boldReportDesigner($("#updateDesigner"),n)};(getConnectorList=function(){var t=$.proxy(n.datasourceCallback,this);n.initializeDesigner();designerInstance.getDataConnectorsInfo(t,null)})();n.getConnectionInfo=function(t){t&&t.status&&t.data&&(connectionList=t.data.connectionList);n.dataList=n.convertTilesInfoFormat(availableDSList);n.connectorList=n.dataList;var i=[];n.connectorList.filter(function(n){i.push(n.category)});n.selectedDataConnector=Array.prototype.filter.call(n.connectorList,function(n){return n.extType.toLowerCase()===conString.ConnectionProperties.DataProvider.toLowerCase()})[0];hideDataSourceWaitingPopup();n.$apply()};n.doAjaxRequest=function(n,t,i,r){$.ajax({type:n,url:t,data:i,beforeSend:function(n){n.setRequestHeader("ServerUrl",serverURL);n.setRequestHeader("serviceAuthorizationToken",designerToken)},success:function(n){(r,n)&&ej.ReportUtil.invokeCallBack(r,n)},error:function(){ej.ReportUtil.invokeCallBack(r,null)}})};n.sortCollection=function(n,t){return n.sort(function(n,i){return n[t]<i[t]?-1:n[t]>i[t]?1:0})}}]);updateDataSourceApp.controller("connectDataHeaderCtrl",["$scope",function(n){n.onCloseBtnClick=function(){closePopup()}}]);let connectorScope;updateDataSourceApp.controller("connectorCtrl",["$scope","ajaxService",function(n,t){connectorScope=n;n.isCustomExtension=n.selectedDataConnector.itemType==="e-custom";angular.element(".dc-header").text(n.selectedDataConnector.displayName);angular.element(".dc-description").text("Connect To "+n.selectedDataConnector.description);n.updateDataContainerHeight=function(){angular.element(".dc-container").css("height",window.innerHeight-angular.element(".ud-header-container").height()-angular.element(".ud-footer-container").height())};n.updateDesignerContainerHeight=function(){return window.innerHeight-(angular.element(".data-designer-container")[0].getBoundingClientRect().top-angular.element(".ud-header-container")[0].getBoundingClientRect().top)-angular.element(".ud-footer-container").height()-24};angular.element(".data-designer-container").css("height",n.updateDesignerContainerHeight());window.addEventListener("resize",n.updateDataContainerHeight);n.resizeTO=undefined;n.reportDataExtensions=dataExtensions;n.onDesignerCreate=function(){this.model.filterDataConnectors=window.connectionList;n.isCustomExtension&&(this.dataExtensions=[n.selectedDataConnector.extType]);this.dataSource.renderContainer($(".dataContainer"));n.renderDescription.call(this);this.dataSource.configTable.data("selected",n.selectedDataConnector.itemType);this.dataSource.configTable.data("selectedExt",n.selectedDataConnector.extType);$("#dataDesigner_datasource_dsname").val(dataSourceDetail.Name);$("#dataDesigner_datasource_descname").val(dataSourceDetail.Description);this.dataSource.editData(n.selectedDataConnector.extType,conString);let t=n.isCustomExtension?this.extensiondataSource:this.dataSource;t.validateConnection=function(t,i){$(".dataContainer").find(".e-rptdesigner-error").length||(n.isCustomExtension?n.connectionResult(t,i,this):n.connectionResult(this.constructCon(),t,this))};t.showIndicator=function(){showWaitingPopup(".ud-container")};t.hideIndicator=function(){hideWaitingPopup(".ud-container")};n.disableDesignerScroller()};n.renderDescription=function(){let n=this._id+"_datasource_descname";this.dataSource.renderTextArea("Description (Optional)",n,$("table.e-rptdesigner-dsconfig-table"));$("#"+n).attr("maxlength",1024);$("#"+n+"_td").append('<div class="descname-info">*1024 characters maximum<\/div>')};n.disableDesignerScroller=function(){$("#dataDesigner_dsConfigBodyContainer").data("ejScroller").disable();let n=$("#dataDesigner_dsConfigBodyContainer")[0].firstElementChild;n.classList.add("e-content");n.classList.add("rs-scroller")};n.testConnection=function(t){n.dataDesigner.dataSource.connectionCallBack=t;n.dataDesigner.dataSource.connectDatasource()};n.showValidationMsg=function(n,t,i){let r=$("#"+n+"_error_icon_td"),u=$("#"+n+"_td").find(".e-designer-content-label");t?(ej.ReportUtil.showErrIndictor(r,!0,i),u.addClass("e-rptdesigner-error")):(ej.ReportUtil.showErrIndictor(r,!1),u.removeClass("e-rptdesigner-error"))};n.updateDataSource=function(i){let r={Name:$("#dataDesigner_datasource_dsname").val(),Description:$("#dataDesigner_datasource_descname").val(),IsNameChanged:$("#dataDesigner_datasource_dsname").val()!==dataSourceDetail.Name,IsDescriptionChanged:$("#dataDesigner_datasource_descname").val()!==dataSourceDetail.Description,Id:dataSourceDetail.Id};t.postQueryData(updateURL,{conString:JSON.stringify(i),dataSourceDetail:JSON.stringify(r)}).then(function(t){hideWaitingPopup(".ud-container");t.error?n.dataDesigner.getInstance("ReportUtil").ejAlertDialog("Data Connector",t.error,!1,!0,!1,"Failed to save data"):t.result.IsNameExist?n.showValidationMsg("dataDesigner_datasource_dsname",!0,"DataSource name already exists"):(n.dataSourceName=i.Name,n.dataDesigner.dataSource.connectionCallBack())})};n.connectionResult=function(t,i,r){i==="true"?(showWaitingPopup(".ud-container"),t.ConnectionProperties.EmbeddedData?(delete t.ConnectionProperties.EmbeddedData.__type,n.dataDesigner.getInstance("ReportUtil").doAjaxPost("POST",ej.ReportUtil.getTenantUrl(n.dataDesigner.model.serviceUrl+"/PostDesignerAction/",n.dataDesigner.model.tenantName),{action:"EmbeddedData",data:JSON.stringify({designerAction:"EmbeddedData",embeddedData:t.ConnectionProperties.EmbeddedData})},{fnction:i=>{i.indexOf("Sf_Exception")!==-1?n.dataDesigner.getInstance("ReportUtil").ejAlertDialog("Data Connector",i,!1,!0,!1,"Report Designer failed to parse the embedded data"):(t.ConnectionProperties.EmbeddedData.Data=i,n.updateDataSource(t))},indicator:[null,null]})):n.updateDataSource(t)):r.reportDesigner.getInstance("ReportUtil").ejAlertDialog(r.getLocale("alertLabel"),i,!1,!0,!1,r.getLocale("alertConnectionFailed"),{})};n.$on("$destroy",function(){window.removeEventListener("resize",n.updateDataContainerHeight)})}]);updateDataSourceApp.controller("connectDataFooterCtrl",["$scope",function(n){n.onUpdateBtnClick=function(){connectorScope.testConnection(function(){showToast(function(){parent.location.reload()})})}}])