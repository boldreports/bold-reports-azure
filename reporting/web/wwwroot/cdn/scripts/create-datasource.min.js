/*!
*  filename: create-datasource.min.js
*  version : unknown version
*  Copyright Syncfusion Inc. 2001 - 2013. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
function initializeToastControl(){toastInstance=new ejs.notifications.Toast({title:"Success!",content:"Data Source has been created successfully",target:document.body,cssClass:"e-toast-success",timeOut:1e3,close:function(){toastInstance.toastCloseCb()},position:{X:"Right",Y:"Top"},showCloseButton:!0,newestOnTop:!0,animation:{hide:{effect:"SlideRightOut"},show:{effect:"SlideRightIn"}}});toastInstance.appendTo(".dc-toast")}function showToast(n){toastInstance.show();toastInstance.toastCloseCb=n}function initializeDataSetFormTooltip(){$(".dataset-form-container").ejTooltip({content:"description",target:".e-rptdesigner-error-icon",position:{target:{horizontal:"bottom",vertical:"bottom"},stem:{horizontal:"right",vertical:"top"}},tip:{adjust:{xValue:10,yValue:100}},animation:{effect:"Fade",speed:500},isBalloon:!1,showShadow:!0,showRoundedCorner:!0,beforeOpen:function(n){this.setModel({content:$(n.event.target).attr("data-title")})}})}function isSpecialCharacter(n){let t=new RegExp(/[!"#$%&'()*+,\s./:;<=>?@[\\\]^`{|}~-]/g);return t.test(n)}let createDataSourceApp=angular.module("createDataSourceApp",["ejangular"]);createDataSourceApp.config(["$httpProvider",function(n){n.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";n.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded"}]);createDataSourceApp.service("ajaxService",["$http","$q",function(n,t){function u(n){return!angular.isObject(n.data)||!n.data.message?t.reject(window.Server.App.LocalizationContent.UnknownError):t.reject(n.data.message)}function f(n){return n.data}let i,r=!1;return{get:function(e){r&&i.resolve();r=!0;i=t.defer();let o=n({method:"get",url:e,timeout:i.promise});return o.then(f,u)},postQueryData:function(t,i){let r=n({method:"post",url:t,data:JSON.stringify(i),headers:{"Content-Type":"application/json"}});return r.then(f,u)},cancelRequest:function(){r&&i.resolve()}}}]);let toastInstance;$(document).ready(function(){initializeToastControl()});createDataSourceApp.controller("createDataSourceCtrl",["$scope",function(n){n.datasetCreation=!1;n.selectedDataConnector=undefined;n.updateDataSetCreation=function(t){n.datasetCreation=t};n.changeDataConnector=function(t){n.selectedDataConnector=t};waitingPopUpElement=parent.$("#create-dataset-popup");hideWaitingPopup(waitingPopUpElement)}]);createDataSourceApp.controller("connectDataHeaderCtrl",["$scope",function(n){n.onBackBtnClick=function(){connectorScope.dataDesignerAlertDialog.open()};n.onCloseBtnClick=function(){parent.window.location.href=datasource}}]);let connectorListScope;createDataSourceApp.controller("connectorListCtrl",["$scope","$window","$timeout","ajaxService",function(n,t,i,r){connectorListScope=n;n.filterTimeout=undefined;n.connectorList=[];n.dataList=[];n.categories=[];n.categorySelection="0";n.fields={text:"displayName",value:"categoryId"};n.searchText="";(getConnectorList=function(){r.get(dataConnectorPath).then(function(t){n.categories=t.dataCategories;n.dataList=t.dataConnectors.filter(function(n){return(isAzureApplication&&isSelfHosted?n.accessibility.cloud&&n.accessibility.enterprise:isAzureApplication?n.accessibility.cloud:n.accessibility.enterprise)&&(isWindows?!0:n.itemType==="e-odbc"||n.itemType==="e-oledb"?!1:!0)});n.connectorList=n.dataList.slice()})})();(n.onConnertorListResize=function(){angular.element(".cd-connector-list").css("height",window.innerHeight-angular.element(".cd-header-container").height())})();angular.element(".cd-connector-list").css("height",window.innerHeight-angular.element(".cd-header-container").height());angular.element(".dc-list").ejTooltip({content:"valudescription",target:".dc-list-info",position:{target:{horizontal:"bottom",vertical:"bottom"},stem:{horizontal:"left",vertical:"top"}},tip:{adjust:{xValue:20,yValue:100}},animation:{effect:"Fade",speed:500},isBalloon:!1,showShadow:!0,showRoundedCorner:!0,beforeOpen:function(n){this.setModel({content:angular.element(n.event.target).attr("data-title")})}});n.onAutocompleteTailClick=function(t){t.currentTarget.classList.contains("dc-delete")&&(n.searchText="")};angular.element(t).on("resize",function(){n.onConnertorListResize()});n.onDataListHover=function(n){n.currentTarget.querySelector(".dc-list-img").classList.toggle("e-hover")};n.onDataConnectorSelect=function(t){n.$parent.changeDataConnector(t)};n.onDdlDataBound=function(){n.categorySelection="0";this.selectItemByValue(n.categorySelection);i(function(){angular.element(".dc-list-cards").addClass("dc-animate")})};n.$on("$destroy",function(){window.angular.element(t).off("resize")});n.$watch("searchText",function(t){n.filterTimeout&&i.cancel(n.filterTimeout);n.filterTimeout=i(function(){n.connectorList=n.filterConnectorList(t,n.categorySelection)},200)});n.$watch("categorySelection",function(t){n.connectorList=n.filterConnectorList(n.searchText,t)});n.filterConnectorList=function(t,i){return n.dataList&&n.dataList.length?n.dataList.filter(function(n){return(i==="0"?!0:n.category.toString()===i)&&(t?n.displayName.toLowerCase().indexOf(t)!==-1:!0)}):[]}}]);let connectorScope;createDataSourceApp.controller("connectorContainerCtrl",["$scope",function(n){n.onAlertYesBtnClick=function(){n.dataDesignerAlertDialog.close();n.$parent.changeDataConnector(undefined)};n.onAlertNoBtnClick=function(){n.dataDesignerAlertDialog.close()}}]);createDataSourceApp.controller("connectorCtrl",["$scope","ajaxService",function(n,t){connectorScope=n;n.isCustomExtension=n.selectedDataConnector.itemType==="e-custom";angular.element(".dc-header").text(n.selectedDataConnector.displayName);angular.element(".dc-description").text("Connect To "+n.selectedDataConnector.description);n.updateDataContainerHeight=function(){angular.element(".dc-container").css("height",window.innerHeight-angular.element(".cd-header-container").height()-angular.element(".cd-footer-container").height())};n.updateDesignerContainerHeight=function(){return window.innerHeight-(angular.element(".data-designer-container")[0].getBoundingClientRect().top-angular.element(".cd-header-container")[0].getBoundingClientRect().top)-angular.element(".cd-footer-container").height()-24};angular.element(".data-designer-container").css("height",n.updateDesignerContainerHeight());window.addEventListener("resize",n.updateDataContainerHeight);n.dataSourceName="";n.resizeTO=undefined;n.reportDataExtensions=dataExtensions;initializeDataSetFormTooltip();n.onDesignerCreate=function(){this.dataSource.renderContainer($(".dataContainer"));n.renderDescription.call(this);this.dataSource.configTable.data("selected",n.selectedDataConnector.itemType);this.dataSource.configTable.data("selectedExt",n.selectedDataConnector.extType);this.dataSource.createData(n.selectedDataConnector.itemType,n.selectedDataConnector.extType);let t=n.isCustomExtension?this.extensiondataSource:this.dataSource;t.validateConnection=function(t,i){$(".dataContainer").find(".e-rptdesigner-error").length||(n.isCustomExtension?n.connectionResult(t,i,this):n.connectionResult(this.constructCon(),t,this))};t.showIndicator=function(){showWaitingPopup(".cd-container")};t.hideIndicator=function(){hideWaitingPopup(".cd-container")};n.disableDesignerScroller()};n.renderDescription=function(){let n=this._id+"_datasource_descname";this.dataSource.renderTextArea("Description (Optional)",n,$("table.e-rptdesigner-dsconfig-table"));$("#"+n).attr("maxlength",1024);$("#"+n+"_td").append('<div class="descname-info">*1024 characters maximum<\/div>')};n.disableDesignerScroller=function(){$("#dataDesigner_dsConfigBodyContainer").data("ejScroller").disable();let n=$("#dataDesigner_dsConfigBodyContainer")[0].firstElementChild;n.classList.add("e-content");n.classList.add("rs-scroller")};n.testConnection=function(t){n.dataDesigner.dataSource.connectionCallBack=t;n.dataDesigner.dataSource.connectDatasource()};n.showValidationMsg=function(n,t,i){let r=$("#"+n+"_error_icon_td"),u=$("#"+n+"_td").find(".e-designer-content-label");t?(ej.ReportUtil.showErrIndictor(r,!0,i),u.addClass("e-rptdesigner-error")):(ej.ReportUtil.showErrIndictor(r,!1),u.removeClass("e-rptdesigner-error"))};n.saveDataSource=function(i){let r={Name:$("#dataDesigner_datasource_dsname").val(),Description:$("#dataDesigner_datasource_descname").val()};t.postQueryData(saveURL,{conString:JSON.stringify(i),dataSourceDetail:JSON.stringify(r)}).then(function(t){hideWaitingPopup(".cd-container");t.error?n.dataDesigner.getInstance("ReportUtil").ejAlertDialog("Data Connector",t.error,!1,!0,!1,"Failed to save data"):t.result.IsNameExist?n.showValidationMsg("dataDesigner_datasource_dsname",!0,"DataSource name already exists"):(n.dataSourceName=i.Name,n.dataDesigner.dataSource.connectionCallBack(!0))})};n.connectionResult=function(t,i,r){i==="true"?(showWaitingPopup(".cd-container"),t.ConnectionProperties.EmbeddedData?(delete t.ConnectionProperties.EmbeddedData.__type,n.dataDesigner.getInstance("ReportUtil").doAjaxPost("POST",ej.ReportUtil.getTenantUrl(n.dataDesigner.model.serviceUrl+"/PostDesignerAction/",n.dataDesigner.model.tenantName),{action:"EmbeddedData",data:JSON.stringify({designerAction:"EmbeddedData",embeddedData:t.ConnectionProperties.EmbeddedData})},{fnction:function(i){i.indexOf("Sf_Exception")!==-1?n.dataDesigner.getInstance("ReportUtil").ejAlertDialog("Data Connector",i,!1,!0,!1,"Report Designer failed to parse the embedded data"):(t.ConnectionProperties.EmbeddedData.Data=i,n.saveDataSource(t))},indicator:[null,null]})):n.saveDataSource(t)):r.reportDesigner.getInstance("ReportUtil").ejAlertDialog(r.getLocale("alertLabel"),i,!1,!0,!1,r.getLocale("alertConnectionFailed"),{})};n.$on("$destroy",function(){window.removeEventListener("resize",n.updateDataContainerHeight)})}]);let validateDataSetForm=function(n,t){hideDataSetFormValidation();let r=$(".dataset-form-name").val(),i=!0;r.length?isSpecialCharacter(r)&&(i=!1,toggleDataSetFormValidationMsg($(".dataset-form-name").closest("table"),!0,"Name should not contain spaces and special characters")):(i=!1,toggleDataSetFormValidationMsg($(".dataset-form-name").closest("table"),!0,"Specify the DataSet name"));i?n.postQueryData(isDataSetExistUrl,{dataSetName:r}).then(function(n){n.Data&&toggleDataSetFormValidationMsg($(".dataset-form-name").closest("table"),!0,"DataSet name already exists");t(!n.Data)}):t(i)},hideDataSetFormValidation=function(){toggleDataSetFormValidationMsg($(".dataset-form-name").closest("table"))},toggleDataSetFormValidationMsg=function(n,t,i){t=t===undefined?!1:t;n.find(".e-rptdesigner-error-icon").css("display",t?"block":"none");n.find(".e-designer-content-label")[t?"addClass":"removeClass"]("e-rptdesigner-error");i&&n.find(".e-rptdesigner-error-icon").attr("data-title",i)};createDataSourceApp.controller("connectDataFooterCtrl",["$scope","ajaxService",function(n,t){n.onSaveBtnClick=function(){connectorScope.testConnection(function(){showToast(function(){parent.window.location.href=datasource})})};n.onDataSetBtnClick=function(){connectorScope.testConnection(function(){showToast(function(){n.onDataSetCreate();n.$applyAsync()})})};n.onProceedBtnClick=function(){showWaitingPopup(".cd-container");validateDataSetForm(t,function(n){n&&($(".dataset-form").submit(),parent.window.location.href=datasource);hideWaitingPopup(".cd-container")})};n.onDataSetCreate=function(){n.$parent.updateDataSetCreation(!0)}}])