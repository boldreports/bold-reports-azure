/*!
*  filename: create-datasource.min.js
*  version : unknown version
*  Copyright Syncfusion Inc. 2001 - 2013. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
function showEJ2Spinner(n){ejs.popups.showSpinner($(n)[0])}function hideEJ2Spinner(n){ejs.popups.hideSpinner($(n)[0])}function renderEJ2Textbox(n,t){if(n.ej2_instances==undefined){let i=new ejs.inputs.TextBox({width:t});i.appendTo(n)}}function createEJ2Spinner(n){ejs.popups.createSpinner({target:$(n)[0],cssClass:"e-spin-overlay"})}function renderEJ2Button(n,t){let i=new ejs.buttons.Button({isPrimary:t});i.appendTo(n)}function initializeToastControl(){toastInstance=new ejs.notifications.Toast({title:window.Server.App.LocalizationContent.Success+"!",content:window.Server.App.LocalizationContent.CreateDatasourceSuccess,target:document.body,cssClass:"e-toast-success",timeOut:1e3,close:function(){toastInstance.toastCloseCb()},position:{X:"Right",Y:"Top"},showCloseButton:!0,newestOnTop:!0,animation:{hide:{effect:"SlideRightOut"},show:{effect:"SlideRightIn"}}});toastInstance.appendTo(".dc-toast")}function showToast(n){toastInstance.show();toastInstance.toastCloseCb=n}function dialogShow(){var n=$("#dataDesigner").data("boldReportDesigner");n&&n.getInstance("ReportUtil").ejAlertDialog(window.Server.App.LocalizationContent.CancelDlgTitle,window.Server.App.LocalizationContent.CancelDlgContent,!0,!1,!0,"",{method:"onAlertYesBtnClick",instance:this})}function onAlertYesBtnClick(n){if(n){var t=angular.element(document.getElementsByClassName("cd-container")).scope();t.$apply(function(){t.changeDataConnector(undefined)})}}function onFocus(){angular.element(".e-input-group.e-control-wrapper.dc-filter-autocomplete").addClass("e-input-focus")}function onBlur(){angular.element(".e-input-group.e-control-wrapper.dc-filter-autocomplete").removeClass("e-input-focus")}function initializeDataSetFormTooltip(){let n=new ejs.popups.Tooltip({content:"valudescription",target:".e-rptdesigner-error-icon",position:"LeftBottom",offsetX:1,offsetY:-12,cssClass:"e-rpt-label-tooltip",windowCollision:!0,showTipPointer:!1,animation:{open:{effect:"FadeIn",duration:500,delay:0},close:{effect:"FadeOut",duration:500,delay:0}}});n.beforeOpen=function(t){if(t.event&&t.event.target){let i=t.event.target;n.content=$(i).attr("data-title");n.refresh(i)}};n.appendTo($(".dataset-form-container")[0])}function isSpecialCharacter(n){let t=new RegExp(/[!"#$%&'()*+,\s./:;<=>?@[\\\]^`{|}~-]/g);return t.test(n)}function extractXSRFTokenFromCookie(){var n=parent.document.cookie.split("; ").find(n=>n.startsWith("XSRF-TOKEN="));return n?n.split("=")[1]:null}function setXSRFRequestHeader(n){n.setRequestHeader("X-XSRF-TOKEN",extractXSRFTokenFromCookie())}function decodeHtmlAsString(n){var t=document.createElement("textarea");return t.innerHTML=n,t.value}function EscapeHtml(n){return n.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}let createDataSourceApp=angular.module("createDataSourceApp",["ejangular"]);createDataSourceApp.config(["$httpProvider",function(n){n.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";n.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded"}]);createDataSourceApp.service("ajaxService",["$http","$q",function(n,t){function u(n){return!angular.isObject(n.data)||!n.data.message?t.reject(window.Server.App.LocalizationContent.UnknownError):t.reject(n.data.message)}function f(n){return n.data}let i,r=!1;return{get:function(e){r&&i.resolve();r=!0;i=t.defer();let o=n({method:"get",url:e,timeout:i.promise});return o.then(f,u)},postQueryData:function(t,i){let r=n({method:"post",url:t,data:JSON.stringify(i),headers:{"Content-Type":"application/json"}});return r.then(f,u)},cancelRequest:function(){r&&i.resolve()}}}]);let toastInstance;$(document).ready(function(){initializeToastControl()});showEJ2Spinner(".cd-container");createDataSourceApp.controller("createDataSourceCtrl",["$scope",function(n){n.datasetCreation=!1;n.selectedDataConnector=undefined;n.updateDataSetCreation=function(t){n.datasetCreation=t};n.changeDataConnector=function(t){n.selectedDataConnector=t}}]);createDataSourceApp.controller("connectDataHeaderCtrl",["$scope",function(n){n.onBackBtnClick=function(){dialogShow()};n.onCloseBtnClick=function(){parent.window.location.href=datasource}}]);let connectorListScope;createDataSourceApp.controller("connectorListCtrl",["$scope","$window","$timeout","ajaxService",function(n,t,i){connectorListScope=n;n.loadingStatus=!1;n.filterTimeout=undefined;n.connectorList=[];n.dataList=[];n.categories=[];n.searchText="";n._CryptoAES=window.CryptoJS;n._keyCode=(Math.random()+" ").substring(2,10)+(Math.random()+" ").substring(2,10);n._ivCode=(Math.random()+" ").substring(2,10)+(Math.random()+" ").substring(2,10);n._key=n._CryptoAES.enc.Utf8.parse(n._keyCode);n._iv=n._CryptoAES.enc.Utf8.parse(n._ivCode);(n.onConnertorListResize=function(){angular.element(".cd-connector-list").css("height",window.innerHeight-angular.element(".cd-header-container").height())})();angular.element(".cd-connector-list").css("height",window.innerHeight-angular.element(".cd-header-container").height());let r=new ejs.popups.Tooltip({content:"valudescription",target:".dc-list-info",position:"RightBottom",windowCollision:!0,offsetY:-10,cssClass:"e-rpt-label-tooltip",animation:{open:{effect:"FadeIn",duration:500,delay:0},close:{effect:"FadeOut",duration:500,delay:0}}});r.beforeOpen=function(n){r.content=angular.element(n.event.target).attr("data-title");r.dataBind()};r.appendTo(angular.element(".dc-list")[0]);let u=new ejs.dropdowns.DropDownList({dataSource:[],fields:{text:"displayName"},cssClass:"dc-filter-ddl-wrapper",width:"200px",height:"28px",value:"All Categories"});u.change=function(t){n.filterTimeout=i(function(){n.connectorList=n.filterConnectorList(n.searchText,t.value)},200)};u.dataBound=function(){angular.element(".dc-filter-ddl")[0].ej2_instances[0].value="All Categories";angular.element(".dc-filter-ddl")[0].ej2_instances[0].dataBind();i(function(){angular.element(".dc-list-cards").addClass("dc-animate");hideEJ2Spinner(".cd-container")})};u.appendTo(angular.element(".dc-filter-ddl")[0]);n.onAutocompleteTailClick=function(t){t.currentTarget.classList.contains("dc-delete")&&(n.searchText="")};angular.element(t).on("resize",function(){n.onConnertorListResize()});n.onDataListHover=function(n){n.currentTarget.querySelector(".dc-list-img").classList.toggle("e-hover")};n.onDataConnectorSelect=function(t){n.$parent.changeDataConnector(t)};n.$on("$destroy",function(){window.angular.element(t).off("resize")});n.$watch("searchText",function(t){n.filterTimeout&&i.cancel(n.filterTimeout);n.filterTimeout=i(function(){n.connectorList=n.filterConnectorList(t,angular.element(".dc-filter-ddl")[0].ej2_instances[0].value)},200)});n.filterConnectorList=function(t,i){return n.dataList&&n.dataList.length?n.dataList.filter(function(n){return(i==="All Categories"?!0:n.category===i)&&(t.toLowerCase()?n.displayName.toLowerCase().indexOf(t.toLowerCase())!==-1:!0)}):[]};n.datasourceCallback=function(t){availableDSList=n.sortCollection(t,"name");n.doAjaxRequest("GET",getDataConnectors,{},$.proxy(n.getConnectionInfo,this))};n.convertTilesInfoFormat=function(n){for(var r=!ej.isNullOrUndefined(connectionList)&&connectionList.length>0?connectionList:[],u=[],i=0;i<n.length;i++){var t=n[i],f=ej.isNullOrUndefined(t.category)?"Rest":t.category,e=r.length===0?!0:r.indexOf(t.connector)!==-1;e&&u.push({id:t.id,iconClassName:t.src+"-tile",category:f,itemType:t.itemType,extType:t.extType,displayName:t.name,connector:t.connector,description:t.description})}return u};n.initializeDesigner=function(){var t={serviceUrl:serviceURL,reportServerUrl:serverURL,isAzureApp:isAzureApplication,serviceAuthorizationToken:designerToken,ajaxBeforeLoad:n.ajaxBeforeSend,encryptData:n.encryptData,decryptData:n.decryptData,customBrandSettings:{hideHelpLink:isHideHelpLink,customDomain:customDomain,customBrandName:custombrandName,customLinks:window.customLinks}};designerInstance=new boldReportDesigner($("#designer"),t)};(getConnectorList=function(){var t=$.proxy(n.datasourceCallback,this);n.initializeDesigner();designerInstance.getDataConnectorsInfo(t,null)})();n.getConnectionInfo=function(t){var u,i,r;for(t&&t.status&&t.data&&(connectionList=t.data.connectionList),n.dataList=n.convertTilesInfoFormat(availableDSList),n.connectorList=n.dataList,u=[],n.connectorList.filter(function(n){u.push(n.category)}),i=[],$.each(u,function(n,t){$.inArray(t,i)==-1&&i.push(t)}),n.categories.push({displayName:"All Categories"}),r=0;r<i.length;r++)n.categories.push({displayName:i[r]});angular.element(".dc-filter-ddl")[0].ej2_instances[0].dataSource=n.categories;angular.element(".dc-filter-ddl")[0].ej2_instances[0].dataBind();n.loadingStatus=!0;n.$apply()};n.doAjaxRequest=function(t,i,r,u){$.ajax({type:t,url:i,data:r,beforeSend:function(t){t.setRequestHeader("ServerUrl",serverURL);t.setRequestHeader("serviceAuthorizationToken",designerToken);n._setRequestHeader(t)},success:function(n){(u,n)&&ej.ReportUtil.invokeCallBack(u,n)},error:function(){ej.ReportUtil.invokeCallBack(u,null)}})};n.sortCollection=function(n,t){return n.sort(function(n,i){return n[t]<i[t]?-1:n[t]>i[t]?1:0})};n._setRequestHeader=function(t){t&&(t.setRequestHeader("keyCode",n._keyCode),t.setRequestHeader("ivCode",n._ivCode))};n._encryptData=function(t){return n._CryptoAES.AES.encrypt(n._CryptoAES.enc.Utf8.parse(t),_key,{keySize:16,iv:_iv,mode:n._CryptoAES.mode.CBC,padding:n._CryptoAES.pad.Pkcs7}).toString()};n._decryptData=function(t){return n._CryptoAES.AES.decrypt(t,_key,{keySize:16,iv:_iv,mode:n._CryptoAES.mode.CBC,padding:n._CryptoAES.pad.Pkcs7}).toString(n._CryptoAES.enc.Utf8)};n.encryptData=function(t){t&&t.data&&(t.data=n._encryptData(t.data))};n.decryptData=function(t){t&&t.data&&(t.data=n._decryptData(t.data))};n._injectKeys=function(t){t&&t.headers&&(t.headers.push({Key:"keyCode",Value:n._keyCode}),t.headers.push({Key:"ivCode",Value:n._ivCode}))};n.ajaxBeforeSend=function(t){n._injectKeys(t)}}]);$(document).on("focus","#search-connectors",onFocus);$(document).on("blur","#search-connectors",onBlur);let connectorScope;createEJ2Spinner(".cd-container");createDataSourceApp.controller("connectorCtrl",["$scope","ajaxService",function(n,t){connectorScope=n;n.isCustomExtension=n.selectedDataConnector.itemType==="e-custom";angular.element(".dc-header").text(n.selectedDataConnector.displayName);let i=new ejs.popups.Tooltip({content:"valudescription",target:".dc-description-img",position:"RightBottom",offsetY:-10,cssClass:"e-rpt-label-tooltip",windowCollision:!0,animation:{open:{effect:"FadeIn",duration:500,delay:0},close:{effect:"FadeOut",duration:500,delay:0}}});i.beforeOpen=function(){i.content="Connect To "+n.selectedDataConnector.description;i.dataBind()};i.appendTo(angular.element(".dc-header-container")[0]);n.updateDataContainerHeight=function(){angular.element(".dc-container").css("height",window.innerHeight-angular.element(".cd-header-container").height()-angular.element(".cd-footer-container").height())};n.updateDesignerContainerHeight=function(){return window.innerHeight-(angular.element(".data-designer-container")[0].getBoundingClientRect().top-angular.element(".cd-header-container")[0].getBoundingClientRect().top)-angular.element(".cd-footer-container").height()-24};angular.element(".data-designer-container").css("height",n.updateDesignerContainerHeight());window.addEventListener("resize",n.updateDataContainerHeight);n.dataSourceName="";n.resizeTO=undefined;n.reportDataExtensions=dataExtensions;n._CryptoAES=window.CryptoJS;n._keyCode=(Math.random()+" ").substring(2,10)+(Math.random()+" ").substring(2,10);n._ivCode=(Math.random()+" ").substring(2,10)+(Math.random()+" ").substring(2,10);n._key=n._CryptoAES.enc.Utf8.parse(n._keyCode);n._iv=n._CryptoAES.enc.Utf8.parse(n._ivCode);initializeDataSetFormTooltip();n.onAjaxBeforeLoad=function(t){t&&t.headers&&(t.headers.push({Key:"keyCode",Value:n._keyCode}),t.headers.push({Key:"ivCode",Value:n._ivCode}))};n.encryptData=function(t){t&&t.data&&(t.data=n._CryptoAES.AES.encrypt(n._CryptoAES.enc.Utf8.parse(t.data),n._key,{keySize:16,iv:n._iv,mode:n._CryptoAES.mode.CBC,padding:n._CryptoAES.pad.Pkcs7}).toString())};n.decryptData=function(t){t&&t.data&&(t.data=n._CryptoAES.AES.decrypt(t.data,n._key,{keySize:16,iv:n._iv,mode:n._CryptoAES.mode.CBC,padding:n._CryptoAES.pad.Pkcs7}).toString(n._CryptoAES.enc.Utf8))};n.onDesignerCreate=function(){this.model.filterDataConnectors=window.connectionList;this.dataExtensions=designerInstance.dataExtensions;this.builtInExts=designerInstance.builtInExts;this.isOnPremiseMode=window.isSelfHosted;this.dataSource.renderContainer($(".dataContainer"));n.renderDescription.call(this);this.dataSource.configTable.data("selected",n.selectedDataConnector.itemType);this.dataSource.configTable.data("selectedExt",n.selectedDataConnector.extType);this.dataSource.createData(n.selectedDataConnector.itemType,n.selectedDataConnector.extType);let t=n.isCustomExtension?this.extensiondataSource:this.dataSource;t.validateConnection=function(t,i){$(".dataContainer").find(".e-rptdesigner-error").length||(n.isCustomExtension?n.connectionResult(t,i,this):n.connectionResult(this.constructCon(),t,this))};t.showIndicator=function(){showEJ2Spinner(".cd-container")};t.hideIndicator=function(){hideEJ2Spinner(".cd-container")}};n.renderDescription=function(){let n=this._id+"_datasource_descname";this.dataSource.renderTextArea(window.Server.App.LocalizationContent.Description,n,$("table.e-rptdesigner-dsconfig-table"));$("#"+n).attr("maxlength",1024);$("#"+n+"_td").append('<div class="descname-info">* '+window.Server.App.LocalizationContent.MaxNoOfCharacters+"<\/div>")};n.testConnection=function(t){n.dataDesigner.dataSource.connectionCallBack=t;n.dataDesigner.dataSource.connectDatasource()};n.showValidationMsg=function(n,t,i){let r=$("#"+n+"_error_icon_td"),u=$("#"+n+"_td").find(".e-designer-content-label");t?(ej.ReportUtil.showErrIndictor(r,!0,i),u.addClass("e-rptdesigner-error")):(ej.ReportUtil.showErrIndictor(r,!1),u.removeClass("e-rptdesigner-error"))};n.saveDataSource=function(i){let r={Name:$("#dataDesigner_datasource_dsname").val(),Description:$("#dataDesigner_datasource_descname").val()};t.postQueryData(saveURL,{conString:JSON.stringify(i),dataSourceDetail:JSON.stringify(r)}).then(function(t){hideEJ2Spinner(".cd-container");t.error?n.dataDesigner.getInstance("ReportUtil").ejAlertDialog(window.Server.App.LocalizationContent.DataConnector,t.error,!1,!0,!1,window.Server.App.LocalizationContent.DataFailure):t.result.IsNameExist?n.showValidationMsg("dataDesigner_datasource_dsname",!0,window.Server.App.LocalizationContent.IsDataSourceExist):(n.dataSourceName=i.Name,n.dataDesigner.dataSource.connectionCallBack(!0))})};n.connectionResult=function(t,i,r){if(i==="true"){showEJ2Spinner(".cd-container");let i=t.ConnectionProperties.SSLConnectionSettings&&t.ConnectionProperties.SSLConnectionSettings.EmbeddedData;t.ConnectionProperties.EmbeddedData||i?(i?delete t.ConnectionProperties.SSLConnectionSettings.EmbeddedData.__type:delete t.ConnectionProperties.EmbeddedData.__type,n.dataDesigner.getInstance("ReportUtil").doAjaxPost("POST",ej.ReportUtil.getTenantUrl(n.dataDesigner.model.serviceUrl+"/PostDesignerAction/",n.dataDesigner.model.tenantName),{action:"EmbeddedData",data:JSON.stringify({designerAction:"EmbeddedData",embeddedData:i?t.ConnectionProperties.SSLConnectionSettings.EmbeddedData:t.ConnectionProperties.EmbeddedData})},{fnction:function(r){r.indexOf("Sf_Exception")!==-1?n.dataDesigner.getInstance("ReportUtil").ejAlertDialog(window.Server.App.LocalizationContent.DataConnector,r,!1,!0,!1,window.Server.App.LocalizationContent.EmbeddeddDataFailure):(i?t.ConnectionProperties.SSLConnectionSettings.EmbeddedData.Data=r:t.ConnectionProperties.EmbeddedData.Data=r,n.saveDataSource(t))},indicator:[null,null]})):n.saveDataSource(t)}else r.reportDesigner.getInstance("ReportUtil").ejAlertDialog(r.getLocale("alertLabel"),i,!1,!0,!1,r.getLocale("alertConnectionFailed"),{})};n.$on("$destroy",function(){window.removeEventListener("resize",n.updateDataContainerHeight)})}]);let validateDataSetForm=function(n,t){hideDataSetFormValidation();let r=$(".dataset-form-name").val(),i=!0;r.length?isSpecialCharacter(r)&&(i=!1,toggleDataSetFormValidationMsg($(".dataset-form-name").closest("table"),!0,window.Server.App.LocalizationContent.AvoidSpacesAndSpecialCharacters)):(i=!1,toggleDataSetFormValidationMsg($(".dataset-form-name").closest("table"),!0,window.Server.App.LocalizationContent.DatasetNameValidation));i?n.postQueryData(isDataSetExistUrl,{dataSetName:r}).then(function(n){n.Data&&toggleDataSetFormValidationMsg($(".dataset-form-name").closest("table"),!0,window.Server.App.LocalizationContent.DatasetNameAlreadyExist);t(!n.Data)}):t(i)},hideDataSetFormValidation=function(){toggleDataSetFormValidationMsg($(".dataset-form-name").closest("table"))},toggleDataSetFormValidationMsg=function(n,t,i){t=t===undefined?!1:t;n.find(".e-rptdesigner-error-icon").css("display",t?"block":"none");n.find(".e-designer-content-label")[t?"addClass":"removeClass"]("e-rptdesigner-error");i&&n.find(".e-rptdesigner-error-icon").attr("data-title",i)};createDataSourceApp.controller("connectDataFooterCtrl",["$scope","ajaxService",function(n,t){n.onSaveBtnClick=function(){connectorScope.testConnection(function(){showToast(function(){parent.window.location.href=datasource})})};n.onDataSetBtnClick=function(){connectorScope.testConnection(function(){showToast(function(){n.onDataSetCreate();n.$applyAsync()})});renderEJ2Textbox($(".dataset-form-name")[0],430);renderEJ2Textbox($(".dataset-form-desc")[0],430)};n.onProceedBtnClick=function(){showEJ2Spinner(".cd-container");validateDataSetForm(t,function(n){n&&($(".dataset-form").submit(),parent.window.location.href=datasource);hideEJ2Spinner(".cd-container")})};n.onDataSetCreate=function(){n.$parent.updateDataSetCreation(!0)}}]);renderEJ2Button(angular.element(".cd-footer-dataset-btn")[0],!0);renderEJ2Button(angular.element(".cd-footer-save-btn")[0],!1);renderEJ2Button(angular.element(".cd-footer-connect-btn")[0],!0);$.ajaxSetup({beforeSend:function(n){setXSRFRequestHeader(n)}})