@using Syncfusion.Server.Base.Helpers

@model ReportUploadResponse
@{
    Layout = null;
    var isUploaded = ViewData["IsUploaded"] != null ? Convert.ToBoolean(ViewData["IsUploaded"]) : false;
    var globalAppSettings = _globalAppSettings;
    var reportServerResourceUrl = globalAppSettings.SystemSettings.CDNLink.TrimEnd('/');
}
<html class="report-server">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0">
    <title>
        [[[New RDL popup]]]
    </title>
    <environment include="Development,CloudDevelopment">
        <link rel="stylesheet" asp-append-version="true" href="@reportServerResourceUrl/cdn/css/theme/light.css" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/css/theme/light.css")" crossorigin="anonymous" />
        <link rel="stylesheet" asp-append-version="true" href="@ServerAppConfig.CustomFontUrl(globalAppSettings?.SystemSettings?.FontPreference, reportServerResourceUrl)" />
        <link rel="stylesheet" asp-append-version="true" href="@reportServerResourceUrl/cdn/css/upload-report.css" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/css/upload-report.css")" crossorigin="anonymous" />
        <script nonce="@Context.Items["ScriptNonce"]" asp-append-version="true" src="@reportServerResourceUrl/cdn/scripts/upload-report.js" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/scripts/upload-report.js")" crossorigin="anonymous"></script>
    </environment>
    <environment exclude="Development,CloudDevelopment">
        <link rel="stylesheet" asp-append-version="true" href="@reportServerResourceUrl/cdn/css/theme/light.min.css" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/css/theme/light.min.css")" crossorigin="anonymous" />
        <link rel="stylesheet" asp-append-version="true" href="@ServerAppConfig.CustomFontUrl(globalAppSettings?.SystemSettings?.FontPreference, reportServerResourceUrl)" />
        <link rel="stylesheet" asp-append-version="true" href="@reportServerResourceUrl/cdn/css/upload-report.min.css" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/css/upload-report.min.css")" crossorigin="anonymous" />
        <script nonce="@Context.Items["ScriptNonce"]" asp-append-version="true" src="@reportServerResourceUrl/cdn/scripts/upload-report.min.js" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/scripts/upload-report.min.js")" crossorigin="anonymous"></script>
    </environment>
    <script nonce="@Context.Items["ScriptNonce"]">
        $(function () {
            if (window.parent.$("#rdl_filename").val() != "" && window.parent.$("#rdl_filename").val() != undefined) {
                $("#upload_browse_file").val(window.parent.$("#rdl_filename").val());
            }
            window.parent.parent.$('#report_popup_wrapper').ejWaitingPopup("hide");
            $(document).on("change", "#browse_file", function () {
                parent.$("#uploadValidation").html("");
                parent.$("#publish_report").attr("disabled", true);
                var filename = $("#browse_file").val();
                var previousRDLFileName = $("#upload_browse_file").val().slice(0, -4);
                if (filename == "") {
                    $("#upload_browse_file").val('');
                }
                if (filename.substring(filename.lastIndexOf('.') + 1) == "rdl") {
                    filename = filename.substring(filename.lastIndexOf('\\') + 1);
                    $("#upload_browse_file").css("color", "#555555");
                    $("#upload_browse_file").closest("span").removeClass("has-error");
                    $(".fileUpload").removeClass("error-file-upload");
                    parent.$("#rdl_filename").val(filename);
                    $("#upload_browse_file").val(filename);
                    window.parent.$("#rdl_filename").val(filename);
                    if ((window.parent.$(".edit-field").val() == "") || (window.parent.$(".edit-field").val() == previousRDLFileName)) {
                    window.parent.$(".edit-field").val(filename.slice(0, -4));
                    }
                    window.parent.$(".add-report-form, #edit-report-form").valid();
                    $('#browse_file').attr('title', filename);
                    parent.$("#datasource_list_table").html("");
                    parent.$("#dataset_list_table").html("");
                    parent.$("#datasource_list").hide();
                    parent.$("#dataset_list").hide();
                    parent.$("#automap-message").hide();
                    $("#upload-form").submit();
                    if (parent.isEditPopup) {
                        parent.$("#comment").removeAttr("readonly");
                    }
                } else {
                    $("#upload_browse_file").closest("span").addClass("has-error");
                    $("#browse_file").closest('div').addClass("error-file-upload");
                    parent.$("#uploadValidation").text("[[[Please choose a valid RDL file to upload]]]");
                    $("#publish_report").attr("disabled", "disabled");
                    $('#browse_file').attr('title', filename);
                }
            });
        });
        $(document).on("click", "#browse_file", function () {
            $("#browse_file").trigger("focus");
        });
        $(document).on("click", "#upload_browse_file", function () {
            $("#browse_file").trigger("click");
        });

        $(document).keyup(function (e) {
            if (e.keyCode == 27) {
                if (e.target.id != "browse_file") {
                    window.parent.$('.PopupClose').click();
                    window.parent.parent.$("#createButton").focus();
                } else {
                    window.$("#upload_browse_file").focus();
                }
            }
        });
    </script>
</head>
<body onload="load();">
    <form name="uploadReportForm" id="upload-form" method="post" onsubmit="return onUploadReport();" action="@Url.Action("UploadReport", "Reports")" enctype="multipart/form-data">
        @Html.AntiForgeryToken()
        <label for="browse_file" class="trigger-file-input-wrapper-report"></label>
        <span>
            <input id='upload_browse_file' class='form-control input-fields text' readonly name='uploadedFileName' type='text' value="@ViewBag.FileName" tabindex="-1">
        </span>
        <div class='col-xs-1 fileUpload btn btn-default'>
            <span>...</span><input id='browse_file' title="[[[No file selected.]]]" class='browse-button upload-btn' type='file' accept='.rdl' name="file">
        </div>
        @if (isUploaded)
        {
            <input type="hidden" name="previousFileName" value="@Model.UploadedReportName" />
        }
        else
        {
            <input type="hidden" name="previousFileName" value="none" />
        }
    </form>
</body>
</html>
<script nonce="@Context.Items["ScriptNonce"]">
    function onUploadReport() {
        if (window.parent.isEditPopup) {
            window.parent.editReportData.IsFileChanged = true;
            window.parent.editReportData.IsDataSourceChanged = false;
        }
        window.parent.parent.$("#report_popup_wrapper").ejWaitingPopup("show");
    }

    function load() {
        if (($(parent.window).width()) > 1400) {
            $("#upload-form").addClass("iframe");
        }

        if (($(parent.window).width()) < 1400) {
            $("#upload-form").removeClass("iframe");
        }
    }
</script>
@if (isUploaded)
{
    <script nonce="@Context.Items["ScriptNonce"]">
        $(function () {
            window.parent.reportUploadComplete(@Json.Serialize(Model));
        });
    </script>
}