@using System.Configuration
@using Syncfusion.Server.Base.Helpers

@{
    Layout = null;
    var globalAppSettings = _globalAppSettings;
    var idPUrl = globalAppSettings.SystemSettings.IDPUrl;
    var isItemWatched = ViewBag.IsWatched != null ? ViewBag.IsWatched : false;
    var userId = ViewBag.UserId;
    var reportServerResourceUrl = globalAppSettings.SystemSettings.CDNLink.TrimEnd('/');
    var rootUrl = Context.Request.RouteValues["tenantName"] != null ? (Context.Request.PathBase + "/" + ServerAppConfig.TenantIdentifierPrefix + "/" + Context.Request.RouteValues["tenantName"]).TrimEnd('/') : Context.Request.PathBase.ToString();
}

<!DOCTYPE html>
<html class="dashboard-server">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0">

    <environment include="Development,CloudDevelopment">
        <link rel="stylesheet" asp-append-version="true" href="@reportServerResourceUrl/cdn/css/theme/light.css" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/css/theme/light.css")" crossorigin="anonymous" />
        <link rel="stylesheet" asp-append-version="true" href="@reportServerResourceUrl/cdn/css/comments-page.css" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/css/comments-page.css")" crossorigin="anonymous" />
        <link rel="stylesheet" asp-append-version="true" href="@ServerAppConfig.CustomFontUrl(globalAppSettings?.SystemSettings?.FontPreference, reportServerResourceUrl)" />
    </environment>
    <environment exclude="Development,CloudDevelopment">
        <link rel="stylesheet" asp-append-version="true" href="@reportServerResourceUrl/cdn/css/theme/light.min.css" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/css/theme/light.min.css")" crossorigin="anonymous" />
        <link rel="stylesheet" asp-append-version="true" href="@reportServerResourceUrl/cdn/css/comments-page.min.css" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/css/comments-page.min.css")" crossorigin="anonymous" />
        <link rel="stylesheet" asp-append-version="true" href="@ServerAppConfig.CustomFontUrl(globalAppSettings?.SystemSettings?.FontPreference, reportServerResourceUrl)" />
    </environment>


    @await Html.PartialAsync("~/Views/Shared/_LoaderIcon.cshtml")


    <script nonce="@Context.Items["ScriptNonce"]">
    var rootUrl = "@rootUrl";
    var getAllCommentsUrl = { "web": "@Url.Action("GetAllComments","comments")", "api": "/comments/operation" };
    var addCommentUrl = { "web": "@Url.Action("AddComment", "comments")", "api": "/comments/operation" };

    var fileUploadUrl = "@Url.Action("Upload", "fileupload")";
    var commentImageUrl = { "web": "@Url.Action("CommentImages", "comments")", "api": "/comments/upload-image" };
    var editCommentUrl = { "web": "@Url.Action("EditComment", "comments")", "api": "/comments/operation" };
    var deleteCommentUrl = { "web": "@Url.Action("DeleteComment", "comments")", "api": "/comments/operation" };
    var unWatchUrl = { "web": "@Url.Action("UnWatch", "items")", "api":  "/items/un-watch" };
    var userMentionDataSourceUrl = { "web": "@Url.Action("GetUserMentionSuggestionList", "comments")", "api": "/comments/user-mention-list" };
    var watchUrl = { "web": "@Url.Action("Watch", "items")", "api": "/items/watch" };
    var idpUrl = "@globalAppSettings.SystemSettings.IDPUrl";
    var avatarUrl = "@idPUrl/User/Avatar";
    var i_am_ie9 = false;
    var getdefaultavatarUrl="@Url.Action("getdefaultavatar", "User")";
    var itemId = "@ViewBag.itemId";
    var isSydjViewer = "@ViewBag.ViewerVersion" == "v2";
    var isViewerV2Enabled = parent.isViewerV2Enabled;
    var embedConfig = parent.embedConfig;
    var tailwindClassName = "";

    </script>
    <!--[if LT IE  10]>
        <script nonce="@Context.Items["ScriptNonce"]">
            i_am_ie9 = true;
        </script>
    <![endif]-->

    <style>
         .apply-tailwind-background {
            background: var(--blue-magenta) !important;
            border: 1px solid var(--blue-magenta) !important;
        }
        .apply-tailwind-color {
            color: var(--blue-magenta) !important;
        }
        .apply-tailwind-stroke {
            stroke: var(--blue-magenta) !important;
        }
    </style>

    <environment include="Development,CloudDevelopment">
        <script nonce="@Context.Items["ScriptNonce"]" asp-append-version="true" src="@reportServerResourceUrl/cdn/scripts/comments-page.js" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/scripts/comments-page.js")" crossorigin="anonymous"></script>
    </environment>
    <environment exclude="Development,CloudDevelopment">
        <script nonce="@Context.Items["ScriptNonce"]" asp-append-version="true" src="@reportServerResourceUrl/cdn/scripts/comments-page.min.js" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/scripts/comments-page.min.js")" crossorigin="anonymous"></script>
    </environment>
</head>
<body class="displayNone">
    <div class="d-none">
        <textarea id="temp" class="d-none"></textarea>
        <div id="toRemoveCulture"></div>
    </div>
    <div id="isadmin" class="displayNone">@ViewBag.isAdmin</div>
    <div id="isWatch" class="displayNone">@isItemWatched</div>
    @if (ViewBag.ItemType == "report")
    {
        <div id="itemType" class="displayNone" data-item-type="report"></div>
    }
    @*@if (ViewBag.ItemType == "individual-widget")
        {
            <div id="itemType" class="displayNone" data-item-type="widget"></div>
        }*@
    <div class="base-comment-container">
        <input type="hidden" id="userName" value="@(userId)" />
        <div class="header-section col-12 no-padding">
            <div id="header-pane" class="col-10 no-padding">
                <span class="view-heading col-10 no-padding" id="view-heading" style="display: none">
                    [[[COMMENTS]]]
                </span>
            </div>
            <div class="d-flex float-end no-padding" id="close-comment">
                <a href="#" title="[[[Close]]]" class="PopupClose" style="display: none"><span class="su su-close prevent-default-action"></span></a>
            </div>
        </div>
        <div id="comment_action_area" class="col-12">
            <input id="comment_action_slider" class="form-control" placeholder="[[[Write a comment]]]" type="text">
        </div>
        <div id="comment_submit_container" class="comment-submit-container float-end" style="display: none;">
            <textarea id="rte-post" class="form-control comment-area" maxlength="4000"></textarea>
            <span class='message'>*[[[4000 characters maximum]]]</span>
            <span class="error-message"></span>
            <div class="post-watch col-12 no-right-padding no-left-padding">

                <div class="col-12 col-md-6 no-right-padding float-end">
                    <button class="secondary-button app-btn-secondary float-end header-comment-close">[[[Cancel]]]</button>
                    <input id="post-comment" class="primary-button app-btn-primary float-end" value="[[[Post]]]" type="submit">
                </div>
            </div>
        </div>

        <div class="col-12 count-sort">
            <div class="comments-count col-6 no-padding">
                <div class="watch-txt-container">
                    @if (isItemWatched)
                    {
                        <span id="watchItem" class="su su-notification-settings watch-action unwatch" title="[[[Unwatch]]]" data-html='false'  data-bs-toggle='tooltip'></span>
                    }
                    else
                    {
                        <span id="watchItem" class="su su-notification-settings watch-action watch" title="[[[Watch]]]" data-html='false'  data-bs-toggle='tooltip'></span>
                    }
                </div>
                <span id="comment_count">0</span>
                <span class="">[[[Comment(s)]]]</span>
            </div>
            <div id="commentSorting" class="col-6 no-padding">
                <span class="col-3 sort-new sort-active no-padding">[[[Newest]]]</span>
                <span class="col-3 sort-old sort-inactive no-padding">[[[Oldest]]]</span>
            </div>
        </div>
        <div id="parent-scroll-element">
            <div id="scroll-element">
                <div>
                    <div id="list_container" class="col-12 no-padding">
                        <ul id="commentList" class="comment-list"></ul>
                    </div>
                    <div class="additional-content col-12">
                    </div>
                </div>
            </div>
        </div>
        <div style="display:none">
            <input type="text" id="autocomplete-input" />
        </div>
    </div>
    <environment include="Development,CloudDevelopment">
        <script nonce="@Context.Items["ScriptNonce"]" asp-append-version="true" src="~/js/localizationcontent.js?c=@System.Globalization.CultureInfo.CurrentCulture"></script>
    </environment>
    <environment exclude="Development,CloudDevelopment">
        <script nonce="@Context.Items["ScriptNonce"]" asp-append-version="true" src="~/js/localizationcontent.js?c=@System.Globalization.CultureInfo.CurrentCulture"></script>
    </environment>

    <script nonce="@Context.Items["ScriptNonce"]">
        if (isViewerV2Enabled && embedConfig!="undefined" && !embedConfig.IsEmbedCode) {
            $("#post-comment, #save-edit").addClass("apply-tailwind-background");
            $(".sort-active").addClass("apply-tailwind-color");
            $(".loader-icon .path").addClass("apply-tailwind-stroke");
            tailwindClassName = "apply-tailwind-background";
        }
    </script>
</body>
</html>