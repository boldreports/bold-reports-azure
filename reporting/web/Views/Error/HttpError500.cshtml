@using Microsoft.AspNetCore.Mvc.Routing;
@using Syncfusion.Server.Base.Helpers
@inject Microsoft.AspNetCore.Mvc.Infrastructure.IActionContextAccessor actionContextAccessor

@{
    var globalAppSettings = _globalAppSettings;
    Layout = null;
    var cdnLink = string.Empty;
    var faviconLogo = string.Empty;
    var reportServerResourceUrl = string.Empty;
    var homePageUrl = Url.Action("Reports", "Reports");
    if (ServerAppConfig.IsSelfHosted)
    {
        cdnLink = (Context.Request.PathBase.ToString().Equals("/") ? string.Empty : !string.IsNullOrWhiteSpace(Context.Request.PathBase) ? Context.Request.PathBase.ToString() : new Uri(ServerAppConfig.InternalAppReportUrl).AbsolutePath.TrimEnd('/') + "/") + ServerAppConfig.AppSettings.EndPoints.CdnLink + "/cdn/images";
        reportServerResourceUrl = ((!string.IsNullOrWhiteSpace(Context.Request.PathBase) ? Context.Request.PathBase : new Uri(ServerAppConfig.InternalAppReportUrl).AbsolutePath.TrimEnd('/') + "/") + ServerAppConfig.AppSettings.EndPoints.CdnLink).TrimEnd('/');
        faviconLogo = ServerAppConfig.InternalAppIdpUrl + "/ums/logos?type=favicon";
    }
    else
    {
        cdnLink = @GlobalAppSettings.CdnDomain;
        reportServerResourceUrl = ServerAppConfig.AppSettings.EndPoints.CdnLink.TrimEnd('/');
        faviconLogo = reportServerResourceUrl + "/cdn/images/application/" + @ServerAppConfig.AppSettings.AppBranding.Identifier + "/" + @IconFileNames.Favicon;
    }

    if (String.IsNullOrEmpty(homePageUrl))
    {
        homePageUrl = ServerAppConfig.InternalAppIdpUrl + "/ums/homepage";
    }
    var isAdminUser = Context.Session.GetString("IsAdmin") != null && Convert.ToBoolean(Context.Session.GetString("IsAdmin"));
    var loginLogo = globalAppSettings.SystemSettings != null ? globalAppSettings.SystemSettings.LoginLogo : cdnLink + "/application/" + ServerAppConfig.AppSettings.AppBranding.Identifier + "/" + IconFileNames.LoginLogo;
    var isDeploymentError = !string.IsNullOrWhiteSpace(ViewBag.TenantErrorMessage);
    var errorMessage = string.IsNullOrWhiteSpace(ViewBag.TenantErrorMessage) ? ViewBag.ErrorMessage : ViewBag.TenantErrorMessage;
    var errorandDebugHelpSiteUrl = GlobalAppSettings.GetHelpSiteUrl(HelpSiteUrlNames.ErrorAndDebugLogs);
    var faviconFallbackPath = reportServerResourceUrl + "/cdn/images/application/" + ServerAppConfig.AppSettings.AppBranding.Identifier + "/" + IconFileNames.Favicon;
    var loginLogoFallbackPath = reportServerResourceUrl + "/cdn/images/application/" + ServerAppConfig.AppSettings.AppBranding.Identifier + "/" + IconFileNames.LoginLogo;
}
<!DOCTYPE html>
<html class="dashboard-server">
<head>
    <meta name="viewport" content="width=device-width" />
    <title>[[[Internal Server Error]]]</title>
    <environment include="Development,CloudDevelopment">
        <link rel="stylesheet" asp-append-version="true" href="@reportServerResourceUrl/cdn/css/theme/light.css" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/css/theme/light.css")" crossorigin="anonymous" />
        <link rel="stylesheet" asp-append-version="true" href="@reportServerResourceUrl/cdn/css/layout.css" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/css/layout.css")" crossorigin="anonymous" />
        <link rel="stylesheet" asp-append-version="true" href="@reportServerResourceUrl/cdn/css/error-page-new.css" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/css/error-page-new.css")" crossorigin="anonymous" />
        <script nonce="@Context.Items["ScriptNonce"]" asp-append-version="true" src="~/js/localizationcontent.js?c=@System.Globalization.CultureInfo.CurrentCulture"></script>
        <script nonce="@Context.Items["ScriptNonce"]" asp-append-version="true" src="@reportServerResourceUrl/cdn/scripts/error-page.js" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/scripts/error-page.js")" crossorigin="anonymous"></script>
    </environment>
    <environment exclude="Development,CloudDevelopment">
        <link rel="stylesheet" asp-append-version="true" href="@reportServerResourceUrl/cdn/css/theme/light.min.css" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/css/theme/light.min.css")" crossorigin="anonymous" />
        <link rel="stylesheet" asp-append-version="true" href="@reportServerResourceUrl/cdn/css/layout.min.css" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/css/layout.min.css")" crossorigin="anonymous" />
        <link rel="stylesheet" asp-append-version="true" href="@reportServerResourceUrl/cdn/css/error-page-new.min.css" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/css/error-page-new.min.css")" crossorigin="anonymous" />
        <script nonce="@Context.Items["ScriptNonce"]" asp-append-version="true" src="~/js/localizationcontent.js?c=@System.Globalization.CultureInfo.CurrentCulture"></script>
        <script nonce="@Context.Items["ScriptNonce"]" asp-append-version="true" src="@reportServerResourceUrl/cdn/scripts/error-page.min.js" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/scripts/error-page.min.js")" crossorigin="anonymous"></script>
    </environment>
    <script nonce="@Context.Items["ScriptNonce"]">
        document.addEventListener("DOMContentLoaded", function () {
            var fallbackFaviconPath = '@faviconFallbackPath';
            var faviconLinkElement = document.getElementById("favicon-link");
            var fallbackImagePath = '@loginLogoFallbackPath';
            var loginLogoImageElement = document.getElementById("login-logo-error-image");
            var faviconValidationImageObj = new Image();
            faviconValidationImageObj.src = faviconLinkElement.href;

            faviconValidationImageObj.addEventListener("error", function () {
                faviconLinkElement.href = fallbackFaviconPath;
            });
            loginLogoImageElement.addEventListener("error", function () {
                this.src = fallbackImagePath;
            });
        });
    </script>
    <link rel="icon" href="@faviconLogo" id="favicon-link" />
    @await Html.PartialAsync("~/Views/Shared/_LoaderIcon.cshtml")
</head>
<body class="error-full-content">
    <div class="error-page-outer">
        <div class="error-page-content">
            <div class="error-inside">
                <div class="error-image-center-1">
                    <img src="@loginLogo" id="login-logo-error-image" class="error-image-1">
                </div>
                <div class="error-image-center-1">
                    <img src="@reportServerResourceUrl/cdn/images/static/error-pages/v1/500.svg" />
                </div>
                <div class="error-type">[[[Internal Server Error (500)]]]</div>
                <div class="error-text">
                    <span>[[[Sorry! The server has encountered an internal error and was unable to complete your request.]]]</span>

                </div>
                @if (!string.IsNullOrWhiteSpace(errorMessage))
                {
                    <div id="deploy-error-container">
                        <textarea type="text" id="deploy-error-box" disabled>@errorMessage</textarea>
                        <span class="su su-copy text focus" id="deploy-error-copy" data-bs-toggle="tooltip" title="[[[Click to copy]]]"></span>
                    </div>
                }
                <div class="take-me-back-to-home-page">
                    @if (isDeploymentError)
                    {
                        @if (isAdminUser && ServerAppConfig.IsSelfHosted)
                        {
                            <span class='error-page-cursor'><a class='error-to-beck-text-color' href='@(ServerAppConfig.InternalAppIdpUrl)/ums/sites'>[[[Go to sites page]]]</a></span>
                            <span class='error-text-color'>[[[ or ]]]</span>
                            <span class='error-page-cursor'>
                                <a class='error-to-beck-text-color' href='https://www.@(GlobalAppSettings.BrandingDomain)/support' target='_blank'>[[[Create a support ticket]]]</a><span>[[[ with application logs by referring to this ]]]</span><a class='error-to-beck-text-color' href="@(ServerAppConfig.AppSettings.Documentation.BaseUri + errorandDebugHelpSiteUrl)" target='_blank'>[[[link]]]</a>

                            </span>
                        }
                        @if (!ServerAppConfig.IsSelfHosted)
                        {
                            <span class='error-page-cursor'><a class='error-to-beck-text-color' href='@(ServerAppConfig.InternalAppIdpUrl)/ums/sites'>[[[Go to sites page]]]</a></span>
                            <span class='error-text-color'>[[[ or ]]]</span>
                            <span class='error-page-cursor'><a class='error-to-beck-text-color' href='https://www.@(GlobalAppSettings.BrandingDomain)/support' target='_blank'>[[[Create a support ticket]]]</a></span>
                        }
                    }
                    else
                    {
                        @if (isAdminUser && ServerAppConfig.IsSelfHosted)
                        {
                            <span class='error-page-cursor'><a class='error-to-beck-text-color' href='@homePageUrl'>[[[Go to home page]]]</a></span>
                            <span class='error-text-color'>[[[ or ]]]</span>
                            <span class='error-page-cursor'><a class='error-to-beck-text-color' href='https://www.@(GlobalAppSettings.BrandingDomain)/support' target='_blank'>[[[Create a support ticket]]]</a><span>[[[ with application logs by referring to this ]]]</span><a class='error-to-beck-text-color' href="@(ServerAppConfig.AppSettings.Documentation.BaseUri + errorandDebugHelpSiteUrl)" target='_blank'>[[[link]]]</a></span>
                        }
                        @if (!ServerAppConfig.IsSelfHosted)
                        {
                            <span class='error-page-cursor'><a class='error-to-beck-text-color' href='@homePageUrl'>[[[Go to home page]]]</a></span>
                            <span class='error-text-color'>[[[ or ]]]</span>
                            <span class='error-page-cursor'><a class='error-to-beck-text-color' href='https://www.@(GlobalAppSettings.BrandingDomain)/support' target='_blank'>[[[Create a support ticket]]]</a></span>
                        }
                    }
                </div>
            </div>
        </div>
    </div>
</body>
</html>
