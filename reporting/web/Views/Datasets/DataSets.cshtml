@using Syncfusion.Server.Base.Helpers

@{
    var globalAppSettings = _globalAppSettings;
    var isMobile = new DeviceDetection(Context).IsMobile;
    ViewBag.Title = "[[[Datasets]]] - " + globalAppSettings.SystemSettings.OrganizationName;
    ViewBag.HelpSiteUrl = GlobalAppSettings.GetHelpSiteUrl(HelpSiteUrlNames.ManageDatasets);
    var itemPermissions = ViewBag.ItemAddOptions as Dictionary<ItemType, bool>;
    var itemsCount = ViewBag.ItemsCount as Dictionary<ItemType, int>;
    var reportServerResourceUrl = globalAppSettings.SystemSettings.CDNLink.TrimEnd('/');
}

@model List<ItemDetail>

@section styles{
    <environment include="Development,CloudDevelopment">
        <link rel="stylesheet" asp-append-version="true" href="@reportServerResourceUrl/cdn/css/datasets.css" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/css/datasets.css")" crossorigin="anonymous" />
    </environment>
    <environment exclude="Development,CloudDevelopment">
        <link rel="stylesheet" asp-append-version="true" href="@reportServerResourceUrl/cdn/css/datasets.min.css" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/css/datasets.min.css")" crossorigin="anonymous" />
    </environment>
}

@section scripts{

    @if (!isMobile)
    {
        <environment include="Development,CloudDevelopment">
            <script nonce="@Context.Items["ScriptNonce"]" asp-append-version="true" src="@reportServerResourceUrl/cdn/scripts/dataset-page.js" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/scripts/dataset-page.js")" crossorigin="anonymous"></script>
        </environment>
        <environment exclude="Development,CloudDevelopment">
            <script nonce="@Context.Items["ScriptNonce"]" asp-append-version="true" src="@reportServerResourceUrl/cdn/scripts/dataset-page.min.js" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/scripts/dataset-page.min.js")" crossorigin="anonymous"></script>
        </environment>
    }
    else
    {
        <environment include="Development,CloudDevelopment">
            <script nonce="@Context.Items["ScriptNonce"]" asp-append-version="true" src="@reportServerResourceUrl/cdn/scripts/dataset-page-mobile.js" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/scripts/dataset-page-mobile.js")" crossorigin="anonymous"></script>
        </environment>
        <environment exclude="Development,CloudDevelopment">
            <script nonce="@Context.Items["ScriptNonce"]" asp-append-version="true" src="@reportServerResourceUrl/cdn/scripts/dataset-page-mobile.min.js" integrity="@IntegrityTagHelper.GetIntegrity("wwwroot/cdn/scripts/dataset-page-mobile.min.js")" crossorigin="anonymous"></script>
        </environment>
    }

    <script nonce="@Context.Items["ScriptNonce"]">
        let createDataSet = "@Url.Action("CreateDataset", "DataSets")";
        var datasetId = "@ViewBag.DatasetId";
        var datasetName = decodeHtmlAsString("@ViewBag.DatasetName");
        var designerInstallationHelpUrl = "@(ServerAppConfig.AppSettings.Documentation.Uri + GlobalAppSettings.GetHelpSiteUrl(HelpSiteUrlNames.DesignerInstallation))";
        $(document).ready(function () {
            $("#search-items").val("");
            if (datasetId != "" && datasetId != undefined && datasetName != "" && datasetName != undefined) {
                var newUrl = window.location.origin + rootUrlAction + "/datasets";
                history.pushState({}, "", newUrl);
                SuccessAlert(window.Server.App.LocalizationContent.AddDataset, window.Server.App.LocalizationContent.AddDatasetSuccess, 7000);
            }
        });
    </script>
}
@section MainSection{
    @if (itemsCount != null && itemsCount.ContainsKey(ItemType.Dataset) && itemsCount[ItemType.Dataset] > 0)
    {
        @await Html.PartialAsync("../Shared/_TopHeaderSection", new ViewDataDictionary(ViewData) { { "PageHeader", "[[[DATASETS]]]" } })
        <div id="item-grid-container" data-grid-name="datasets" class="admin-page-container" ng-controller="itemsCtrl" style="padding: 80px 20px 20px 30px;">
            <input type="hidden" class="page-name" data-content="[[[DATASETS]]]">
            @if (!isMobile)
            {
                <div class="import-area d-flex justify-content-end admin-page-header">
                    @if (itemPermissions[ItemType.Dataset])
                    {
                        <button type="button" class="cds-btn pull-right primary-button app-btn-primary">[[[Create Dataset]]]</button>
                    }
                </div>
                <div class="admin-page-body">
                    <div id="search-area" class="float-end">
                        <input type="text" id="search-items" class="float-start no-margin" placeholder="[[[Search datasets]]]" />
                        <span class="su close-icon su-inner-close float-end no-margin clear-search" id="clear-search" title="[[[Clear search]]]"></span>
                        <span class="su su-search search-item float-end no-margin" title="[[[Search datasets]]]"></span>
                    </div>

                    <div class="grid-container grid">
                        @await Html.PartialAsync("../Items/_ItemsGrid", new ViewDataDictionary(ViewData) { { "gridName", "datasets" }, { "Permissions", @itemPermissions } })
                    </div>
                </div>
            }
            else
            {
                <div class="grid-container grid">
                    @await Html.PartialAsync("../Items/_ItemsGridForMobile", new ViewDataDictionary(ViewData) { { "gridName", "datasets" } })
                </div>
            }
        </div>
    }
    else
    {
        @await Html.PartialAsync("../DefaultPages/DefaultPages", new ViewDataDictionary(ViewData) { { "Permissions", itemPermissions }, { "ItemType", ItemType.Dataset } })
    }
    <div id="cds-popup" class="cds-popup no-padding" style="display:none">
        <iframe class="cds-iframe"></iframe>
    </div>
    <div id="popup-container" style="display:none" class="no-padding">
        <iframe id="scheduler-popup-iframe" class="datasource-popup-frame"></iframe>
    </div>

    @if (!isMobile)
    {
        @await Html.PartialAsync("../Items/_AddItems")
        @await Html.PartialAsync("../Items/_ItemVersion")
        @await Html.PartialAsync("../Items/_SharePermission")
        @await Html.PartialAsync("../Items/_ItemInfo")
    }
}