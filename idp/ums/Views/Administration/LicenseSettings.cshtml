@using Syncfusion.Server.Base.DataClasses.Core;
@model ManageLicense
@{
    ViewBag.Title = "[[[Manage License - ]]]" + GlobalAppSettings.SystemSettings.OrganizationName;
    var boldBiLicense = Model != null && Model.LicensePlans != null ? Model.LicensePlans.Where(x => x.TenantType == TenantType.BoldBIOnPremise).FirstOrDefault() : null;
    var boldReportsLicense = Model != null && Model.LicensePlans != null ? Model.LicensePlans.Where(x => x.TenantType == TenantType.BoldReportsOnPremise).FirstOrDefault() : null;
    var buildInfoBi = Model != null && Model.BuildInfo != null ? Model.BuildInfo.Where(x => x.Name.ToLower() == AppBranding.Bold.Identifier).FirstOrDefault() : null;
    var buildInfoReports = Model != null && Model.BuildInfo != null ? Model.BuildInfo.Where(x => x.Name.ToLower() == AppBranding.BoldReports.Identifier).FirstOrDefault() : null;
    var isBoldBiLicenseAvailable = boldBiLicense != null;
    var isBoldReportsLicenseAvailable = boldReportsLicense != null;
    var isAzureApplication = string.IsNullOrEmpty(GlobalAppSettings.Configuration.GetSection("AppSettings")["IsAzureApplication"]) ? false : Convert.ToBoolean(GlobalAppSettings.Configuration.GetSection("AppSettings")["IsAzureApplication"]);
}

@section styles{
    <link rel="stylesheet" href="~/bundles/css/site-settings.css" asp-append-version="true" />
}

@section scripts{
    <script src="~/bundles/js/licenese-settings.js" asp-append-version="true"></script>
    <script src="~/bundles/js/offline-license-update.js" asp-append-version="true"></script>
    <script>
        var updateLicenseKeyUrl = "@Url.Action("ApplyLicenseKey", "Administration")";
        var isBoldBiLicenseAvailable = "@isBoldBiLicenseAvailable";
        var isBoldReportsLicenseAvailable = "@isBoldReportsLicenseAvailable";
        var validateLicenseKeyUrl = "@Url.Action("ValidateLicenseKey", "Administration")";
    </script>
}

@section MainSection{
    @await Html.PartialAsync("_AdminMenu")

    <div id="look-and-feel-container" class="admin-page-container">
        <div id="organization-block" class="col-xs-12 no-padding">
            <div class="col-md-12 import-area admin-page-header">
                <hgroup class="col-lg-6 col-md-6 col-sm-6 col-xs-12 no-padding">
                    <h1 class="h2 page-title">[[[MANAGE LICENSE]]]</h1>
                    <h5 class="page-description">[[[Managing the license and plan for the application]]]</h5>
                </hgroup>
            </div>
            @if (Model != null && Model.LicensePlans != null)
            {
                <div>
                    <ul id="license-tab-nav" class="nav nav-tabs" role="tablist">
                        <li role="presentation" class="active">
                            <a href="#bold-bi-tab" id="bold-bi" aria-controls="bold-bi-tab" role="tab" data-toggle="tab">Embedded BI</a>
                        </li>
                        <li role="presentation">
                            <a href="#bold-reports-tab" id="bold-reports" aria-controls="bold-reports-tab" role="tab" data-toggle="tab">Enterprise Reporting</a>
                        </li>
                    </ul>
                </div>
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="bold-bi-tab">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 admin-page-body tab-data">
                            @if (boldBiLicense != null && boldBiLicense.TenantInfoId != Guid.Empty)
                            {
                                <form id="look-and-feel-form" class="col-md-12 form-horizontal no-padding" autocomplete="off">
                                    <div class="col-xs-12 sub-section admin-page-body">
                                        <h3 class="title col-xs-12  sub-section-heading">[[[Plan Details]]]</h3>
                                        <div class="col-xs-6 no-margin no-padding">
                                            <table class="table table-section">
                                                <tr>
                                                    <th>[[[Particulars]]]</th>
                                                    <th>[[[Your Quota]]]</th>
                                                    <th>[[[Used]]]</th>
                                                    <th>[[[Remaining]]]</th>
                                                </tr>
                                                <tr>
                                                    <td>[[[Users]]]</td>
                                                    <td>@boldBiLicense.LicenseSettings["Users"]</td>
                                                    <td>@boldBiLicense.LicenseSettings["UsedUsers"]</td>
                                                    <td>@boldBiLicense.LicenseSettings["RemainingUsers"]</td>
                                                </tr>
                                                <tr>
                                                    <td>[[[Dashboard Tenants]]]</td>
                                                    <td>@boldBiLicense.LicenseSettings["DashboardTenants"]</td>
                                                    <td>@boldBiLicense.LicenseSettings["UsedDashboardTenants"]</td>
                                                    <td>@boldBiLicense.LicenseSettings["RemainingDashboardTenants"]</td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="col-xs-12 admin-page-body">
                                        <h3 class="title col-xs-12 sub-section-heading">[[[Subscription Information]]]</h3>
                                        <div class="col-xs-6 no-margin no-padding" id="subscription-information">
                                            <table class="table active-subscription-table-section">
                                                <tr>
                                                    <td>[[[Subscription]]]</td>
                                                    <td>
                                                        <p class="display-none">@boldBiLicense.SubscriptionInfo.TenantId</p>
                                                        <p id="subscription-id-bi"><a class="subscription-link" href="@CloudAppConfig.GetOnPremiseSubscriptionUrl(boldBiLicense.SubscriptionInfo.TenantId)" target="_blank">@boldBiLicense.SubscriptionInfo.TenantId</a></p>
                                                        <img data-toggle="tooltip" data-original-title="[[[Click to copy]]]" onclick="copyToClipboard('subscription-id-bi')" id="subscription-copy-bi" src="~/images/common/copy.svg" />
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>[[[Licensed To]]]</td>
                                                    <td>@boldBiLicense.LicenseSettings["LicensedTo"]</td>
                                                </tr>
                                                <tr>
                                                    <td>[[[Plan]]]</td>
                                                    <td>@boldBiLicense.SubscriptionInfo.Plan.PlanName</td>
                                                </tr>
                                                <tr>
                                                    <td>[[[Expiry Date]]]</td>
                                                    <td>@(new GlobalAppSettings().GetDateTimeFormat(boldBiLicense.SubscriptionInfo.ExpiryDate, _clientDateTimeInfo))</td>
                                                </tr>
                                                <tr>
                                                    <td>[[[License Version]]]</td>
                                                    <td>@boldBiLicense.SubscriptionInfo.Version</td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                    @if (!isAzureApplication)
                                    {
                                        <div class="col-xs-12 admin-page-body renewal-body">
                                            <h3 class="renewal-header title col-xs-12 sub-section-heading">[[[License Renewal]]]</h3>
                                            <div class="col-xs-12 no-margin no-padding" id="renewal-information">
                                                <div id="online-renewal" class="col-xs-12 no-margin no-padding">
                                                    <h3 class="title col-xs-12">[[[From Online]]]</h3>
                                                    <div class="col-xs-12 no-margin no-padding">
                                                        <p class="col-xs-6 no-margin no-padding">[[[Log in to your account portal to update the license.]]]</p>
                                                        <div class="col-xs-6 no-margin no-padding update-license-btn-holder">
                                                            <button id="update-onpremise-plan-bi" license-service-url="@boldBiLicense.UpdateLicenseUrl" class="col-xs-6 no-padding secondary-button pull-left">[[[Check License]]]</button>
                                                            <div id="update-license-key-notification-loader-bi" class="pull-left" style="display:none">
                                                                @await Html.PartialAsync("progressloader")
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                @if (!string.IsNullOrWhiteSpace(boldBiLicense.SubscriptionInfo.TenantStatus) && boldBiLicense.SubscriptionInfo.TenantStatus == GlobalAppSettings.GetDescription(TenantStatus.Active))
                                                {
                                                    <div class="offline-renewal col-xs-12 no-margin no-padding">
                                                        <h3 class="title col-xs-12">From License File</h3>
                                                        <div class="col-xs-12 no-margin no-padding">
                                                            <p class="col-xs-6 no-margin no-padding">If you’re behind a firewall, please upload the license file downloaded from the Bold BI website. If you don’t have the license file, download it <a target="_blank" href="@HelpSiteManager.GetHelpSiteUrl(HelpSiteUrlNames.Downloads, TenantType.BoldBIOnPremise)">here</a>.</p>
                                                            <button id="offline-update-bi" data-offlinelicense-url="@HelpSiteManager.GetHelpSiteUrl(HelpSiteUrlNames.Downloads, TenantType.BoldBIOnPremise)" data-tenant-type="@((int)TenantType.BoldBIOnPremise)" class="col-xs-6 no-padding secondary-button pull-left">[[[Upload]]]</button>
                                                        </div>
                                                    </div>
                                                }
                                            </div>
                                        </div>}
                                </form>
                            }
                            else if (buildInfoBi != null && buildInfoBi.IsCommonLogin)
                            {
                                <div class="new-start-container">
                                    <div class="new-start-container-bg">
                                        <span class="first-content">[[[Welcome to ]]]<span>Embedded BI</span>Server</span>
                                        <span class="second-content">
                                            [[[See Clearly. Act Boldly.]]]
                                        </span>
                                        <div class="btn-holder">
                                            <button type="button" id="online-license-bi" license-service-url="@($"{ViewBag.GetLicenseUrl}{(int)TenantType.BoldBIOnPremise}")" class="primary-button content-display">[[[Login to activate account]]]</button>
                                        </div>
                                        <div class="col-xs-12 align-center">
                                            <span class="link-header">Behind Firewall? <a class="offline-license-acion" data-offlinelicense-url="@HelpSiteManager.GetHelpSiteUrl(HelpSiteUrlNames.Downloads, TenantType.BoldBIOnPremise)" data-tenant-type="@((int)TenantType.BoldBIOnPremise)">[[[Upload license file]]]</a></span>
                                        </div>
                                        @if (!CloudAppConfig.IsHideHelpLink)
                                        {
                                            <a class="help col-xs-12" href="@(HelpSiteManager.GetHelpSiteUrl(HelpSiteUrlNames.SetupHelp, TenantType.BoldBIOnPremise))" target="_blank">[[[Need setup help?]]]</a>
                                        }
                                    </div>
                                </div>
                            }
                            else
                            {
                                <div class="no-license-container">
                                    <div class="no-license-container-bg">
                                        <img class="no-license-image" src="@Url.Content("~/images/static/startup/manage-license-bi.png")" />
                                        <p class="no-license-description">[[[You do not have a]]] Embedded BI [[[license.]]]</p>
                                        <p class="no-license-rediect">[[[Don’t have an account?]]] <a class="no-license-signup" target="_blank" href="@GlobalAppSettings.Configuration.GetSection("AppSettings")["documentation:BaseUri"]/?id=64&mode=on-premise">[[[Sign Up]]]</a></p>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                    <div role="tabpanel" class="tab-pane" id="bold-reports-tab">
                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 admin-page-body tab-data">
                            @if (boldReportsLicense != null && boldReportsLicense.TenantInfoId != Guid.Empty)
                            {
                                <form id="look-and-feel-form" class="col-md-12 form-horizontal no-padding" autocomplete="off">
                                    <div class="col-xs-12 sub-section admin-page-body">
                                        <h3 class="title col-xs-12  sub-section-heading">[[[Plan Details]]]</h3>
                                        <div class="col-xs-6 no-margin no-padding">
                                            <table class="table table-section">
                                                <tr>
                                                    <th>[[[Particulars]]]</th>
                                                    <th>[[[Your Quota]]]</th>
                                                    <th>[[[Used]]]</th>
                                                    <th>[[[Remaining]]]</th>
                                                </tr>
                                                <tr>
                                                    <td>[[[Users]]]</td>
                                                    <td>@boldReportsLicense.LicenseSettings["Users"]</td>
                                                    <td>@boldReportsLicense.LicenseSettings["UsedUsers"]</td>
                                                    <td>@boldReportsLicense.LicenseSettings["RemainingUsers"]</td>
                                                </tr>
                                                <tr>
                                                    <td>[[[Report Tenants]]]</td>
                                                    <td>@boldReportsLicense.LicenseSettings["ReportTenants"]</td>
                                                    <td>@boldReportsLicense.LicenseSettings["UsedReportTenants"]</td>
                                                    <td>@boldReportsLicense.LicenseSettings["RemainingReportTenants"]</td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="col-xs-12 admin-page-body">
                                        <h3 class="title col-xs-12 sub-section-heading">[[[Subscription Information]]]</h3>
                                        <div class="col-xs-6 no-margin no-padding" id="subscription-information">
                                            <table class="table active-subscription-table-section">
                                                <tr>
                                                    <td>[[[Subscription]]]</td>
                                                    <td>
                                                        <p class="display-none">@boldReportsLicense.SubscriptionInfo.TenantId</p>
                                                        <p id="subscription-id-reports"><a class="subscription-link" href="@CloudAppConfig.GetOnPremiseSubscriptionUrl(boldReportsLicense.SubscriptionInfo.TenantId)" target="_blank">@boldReportsLicense.SubscriptionInfo.TenantId</a></p>
                                                        <img data-toggle="tooltip" data-original-title="[[[Click to copy]]]" onclick="copyToClipboard('subscription-id-reports')" id="subscription-copy-reports" src="~/images/common/copy.svg" />
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td>[[[Licensed To]]]</td>
                                                    <td>@boldReportsLicense.LicenseSettings["LicensedTo"]</td>
                                                </tr>
                                                <tr>
                                                    <td>[[[Plan]]]</td>
                                                    <td>@boldReportsLicense.SubscriptionInfo.Plan.PlanName</td>
                                                </tr>
                                                <tr>
                                                    <td>[[[Expiry Date]]]</td>
                                                    <td>@(new GlobalAppSettings().GetDateTimeFormat(boldReportsLicense.SubscriptionInfo.ExpiryDate, _clientDateTimeInfo))</td>
                                                </tr>
                                                <tr>
                                                    <td>[[[License Version]]]</td>
                                                    <td>@boldReportsLicense.SubscriptionInfo.Version</td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                    @if (!isAzureApplication)
                                    {
                                        <div class="col-xs-12 admin-page-body renewal-body">
                                            <h3 class="renewal-header title col-xs-12 sub-section-heading">[[[License Renewal]]]</h3>
                                            <div class="col-xs-12 no-margin no-padding" id="renewal-information">
                                                <div id="online-renewal" class="col-xs-12 no-margin no-padding">
                                                    <h3 class="title col-xs-12">[[[From Online]]]</h3>
                                                    <div class="col-xs-12 no-margin no-padding">
                                                        <p class="col-xs-6 no-margin no-padding">[[[Log in to your account portal to update the license.]]]</p>
                                                        <div class="col-xs-6 no-margin no-padding update-license-btn-holder">
                                                            <button id="update-onpremise-plan-reports" license-service-url="@boldReportsLicense.UpdateLicenseUrl" class="col-xs-6 no-padding secondary-button pull-left">[[[Check License]]]</button>
                                                            <div id="update-license-key-notification-loader-reports" class="pull-left" style="display:none">
                                                                @await Html.PartialAsync("progressloader")
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                @if (!string.IsNullOrWhiteSpace(boldReportsLicense.SubscriptionInfo.TenantStatus) && boldReportsLicense.SubscriptionInfo.TenantStatus == GlobalAppSettings.GetDescription(TenantStatus.Active))
                                                {
                                                    <div class="offline-renewal col-xs-12 no-margin no-padding">
                                                        <h3 class="title col-xs-12">[[[From License File]]]</h3>
                                                        <div class="col-xs-12 no-margin no-padding">
                                                            <p class="col-xs-6 no-margin no-padding">[[[If you’re behind a firewall, please upload the license file downloaded from the]]] Bold Reports [[[website. If you don’t have the license file, download it]]] <a target="_blank" href="@HelpSiteManager.GetHelpSiteUrl(HelpSiteUrlNames.Downloads, TenantType.BoldReportsOnPremise)">[[[here]]]</a>.</p>
                                                            <button id="offline-update-reports" data-offlinelicense-url="@HelpSiteManager.GetHelpSiteUrl(HelpSiteUrlNames.Downloads, TenantType.BoldReportsOnPremise)" data-tenant-type="@((int)TenantType.BoldReportsOnPremise)" class="col-xs-6 no-padding secondary-button pull-left">[[[Upload]]]</button>
                                                        </div>
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    }
                                </form>
                            }
                            else if (buildInfoReports != null && buildInfoReports.IsCommonLogin)
                            {
                                <div class="new-start-container">
                                    <div class="new-start-container-bg">
                                        <span class="first-content">[[[Welcome to ]]]<span>Enterprise Reporting</span>Server</span>
                                        <span class="second-content">
                                            [[[See Clearly. Act Boldly.]]]
                                        </span>
                                        <div class="btn-holder">
                                            <button type="button" id="online-license-bi" license-service-url="@($"{ViewBag.GetLicenseUrl}{(int)TenantType.BoldReportsOnPremise}")" class="primary-button content-display">[[[Login to activate account]]]</button>
                                        </div>
                                        <div class="col-xs-12 align-center">
                                            <span class="link-header">[[[Behind Firewall?]]] <a class="offline-license-acion" data-offlinelicense-url="@HelpSiteManager.GetHelpSiteUrl(HelpSiteUrlNames.Downloads, TenantType.BoldReportsOnPremise)" data-tenant-type="@((int)TenantType.BoldReportsOnPremise)">[[[Upload license file]]]</a></span>
                                        </div>
                                        @if (!CloudAppConfig.IsHideHelpLink)
                                        {
                                            <a class="help col-xs-12" href="@HelpSiteManager.GetHelpSiteUrl(HelpSiteUrlNames.SetupHelp, TenantType.BoldReportsOnPremise)" target="_blank">[[[Need setup help?]]]</a>
                                        }
                                    </div>
                                </div>
                            }
                            else
                            {
                                <div class="no-license-container">
                                    <div class="no-license-container-bg">
                                        <img class="no-license-image" src="@Url.Content("~/images/static/startup/manage-license-reports.png")" />
                                        <p class="no-license-description ">[[[You do not have a]]] Enterprise Reporting [[[license.]]]</p>
                                        <p class="no-license-rediect">[[[Don’t have an account?]]] <a class="no-license-signup" target="_blank" href="@GlobalAppSettings.Configuration.GetSection("AppSettings")["documentation:BaseUri"]/?id=4046&mode=on-premise">[[[Sign Up]]]</a></p>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            }
            else
            {
                <p class="no-license-info">
                    [[[License details not found.]]]
                </p>
            }
        </div>
    </div>
    @await Html.PartialAsync("_offlinelicenseupdate")
}
