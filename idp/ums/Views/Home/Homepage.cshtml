@model List<TenantDetail>
@{
    Layout = null;
    var tenantIdentifierPrefix = CloudAppConfig.TenantIdentifierPrefix;
    var idPUrl = GlobalAppSettings.SystemSettings.BaseUrl.TrimEnd('/');
    var userId = Context.User.GetUserId();
    var profilePicture = idPUrl + "/User/Avatar?id=" + ViewBag.UserId + "&ImageSize=64";
    var displayName = ViewBag.UserDetails.DisplayName;
    var createSiteUrl = @Url.Action("Sites", "TenantsManagement") + "?action=create-new-site";
    var adminType = (AdminType)Enum.Parse(typeof(AdminType), GlobalAppSettings.HttpContextAccessor.HttpContext.Session.GetString("AdminType"));
    var poweredbyClass = GlobalAppSettings.SystemSettings.IsEnablePoweredBySyncfusion ? "block" : "none";
    var copyrightClass = GlobalAppSettings.SystemSettings.IsEnableCopyrightInfo ? "block" : "none";
    var imageUrl = GlobalAppSettings.SystemSettings.BaseUrl;
    var requestUrl = new Uri(this.Context.Request.GetDisplayUrl());
    var currentUrlPath = requestUrl.PathAndQuery.ToLower();
}

<html>
<head>
    <meta charset="utf-8">
    <title>@T["Home"] - @GlobalAppSettings.SystemSettings.OrganizationName</title>
    @await Html.PartialAsync("../Shared/_Favicon")
    @await Html.PartialAsync("../Shared/_FontReference")
    @await Html.PartialAsync("../Shared/_ThemeReference")

    <link rel="stylesheet" href="~/bundles/css/homepage.css" integrity="@IntegrityTagHelper.GetIntegrity("bundles/css/homepage.css")" crossorigin="anonymous" asp-append-version="true" />
</head>

<body>
    <script nonce="@Context.Items["ScriptNonce"]" src="~/js/onpremiselocalizationcontent.js" asp-append-version="true"></script>
    <script nonce="@Context.Items["ScriptNonce"]" src="~/bundles/js/homepage.js" integrity="@IntegrityTagHelper.GetIntegrity("bundles/js/homepage.js")" crossorigin="anonymous" asp-append-version="true"></script>
    <script nonce="@Context.Items["ScriptNonce"]" src="~/bundles/js/ej2.js" integrity="@IntegrityTagHelper.GetIntegrity("bundles/js/ej2.js")" crossorigin="anonymous" asp-append-version="true"></script>
       <script nonce="@Context.Items["ScriptNonce"]">
        var isShowAlert = "@ViewBag.IsShowErrorAlert.ToString()";
        var enableSameTabLinkTarget = @GlobalAppSettings.SystemSettings.EnableSameTabLinkTarget.ToString().ToLower();      
           var defaultErrorImageSrc = "@Url.Content("~/images/" + GlobalAppSettings.Branding + "/application/" + IconFileNames.DefaultErrorRectangleImage)";
    </script>
    <div id="site-down-alert"></div>
    @await Html.PartialAsync("_SiteDownAlert")
    <div id="header-container">
        <img id ="boldbi-logo" class="boldbi-logo" src="@Url.Content("~/logos?type=login")" alt="@T[$"{AppBranding.Bold.ProductName} Logo"]">
        <div class="logout-container">
            <a class="logout" href="@Url.Action("logout", "accounts")?returnUrl=@currentUrlPath">@T["Sign out"]</a>
        </div>
        @if (adminType == AdminType.SuperAdmin)
        {
            if (ViewBag.IsMultiTenant)
            {
                <a class="create-site primary-button" href="@createSiteUrl">@T["Create new site"]</a>
            }

            <a class="manage-sites secondary-button" href="@Url.Action("Sites", "TenantsManagement")">@T["Manage sites"]</a>
        }
    </div>

    <div id="body-container">
        <div class="user-image-container">
            @if (!string.IsNullOrWhiteSpace(ViewBag.UserDetails.Picture))
            {
                <img class="user-image" rel="alternate" hreflang="en" href="" src="@profilePicture" alt="@T["User's Display Name"]">
            }
            else
            {
                <div class="profile-pic-tag" data-id="@userId" data-type="user" data-display-name="@displayName" data-image-size="100" data-toggle="tooltip" title="@displayName" data-placement="top" data-url="@imageUrl" style="border-radius:50%;margin:auto"></div>
            }
        </div>
        <div class="user-name">@T["Hello, "]@displayName</div>
        <div class="welcome-note">@T["Welcome back!"]</div>
        <div class="line"></div>
        <div class="choose-site">@T["Choose site to enter"]</div>

        <div id="site-container">
            <div class="row">
                @if (Model != null)
                {
                    for (var i = 0; i < Model.Count; i++)
                    {
                        <a class="dns-link site-row-container" rel="alternate" hreflang="en" href="@Model[i].SiteUrl" target="_blank">
                            <div class="user-dns">
                                <div class="image-div site-logo-container">
                                    <div class="lazyload img-loader" data-class="site-logo" data-id="homepagelogo" data-src="@(Model[i].UseCustomBranding ? GlobalAppSettings.SystemSettings.LoginLogo : Url.Content(Model[i].SiteUrl + "/get-client-logo"))" data-alt="boldbi" data-width="110px" data-height="25px" data-default="@Url.Content("~/images/" + GlobalAppSettings.Branding + "/application/" + IconFileNames.DefaultErrorImage)"></div>
                                </div>
                                <div class="dns-org-name site-name" title="@Model[i].TenantName" data-toggle="tooltip">
                                    @Model[i].TenantName
                                </div>
                                <div class="site-url-container">
                                    <div class="dns-name site-url" title="@Model[i].SiteUrl" data-toggle="tooltip">
                                        @Model[i].SiteUrl
                                    </div>
                                </div>
                            </div>
                        </a>
                    }
                }
            </div>
        </div>
    </div>

    <div id="footer-container" class="displaynone">
        <div class="copyright-container" style="display:@copyrightClass">
            <div class="copyright">@Html.Raw(GlobalAppSettings.SystemSettings.CopyrightInformation.Replace("$$CurrentYear$$", DateTime.UtcNow.Year.ToString()))</div>
        </div>
        <div class="footer-logo-container" style="display:@poweredbyClass">
            <div class="powered-by">@T["Powered by"]</div>
            <img class="footer-logo" src="@Url.Content("~/logos?type=poweredby")" alt="@T["Footer Logo"]">
        </div>
    </div>

       <script nonce="@Context.Items["ScriptNonce"]">
       $(window).on('load', function() {
    $('.lazyload').each(function() {
        var img = $('<img>')
            .on('load', imageOnLoad)
            .attr({
                src: $(this).attr("data-src"),
                alt: $(this).attr("data-alt"),
                id: $(this).attr("data-id"),
            })
            .on('error', function() {
                        $(this).attr('src', defaultErrorImageSrc);
            })
            .addClass($(this).attr("data-class"))
            .css('display', 'none');

        // Handling case where src becomes undefined
        img.on('error', function() {
                    $(this).attr('src', defaultErrorImageSrc);
        });

        $(this).parent().append(img);
    });

    refreshLoginFooter();
});

        function imageOnLoad() {
            $(this).show().parent().find("div.lazyload").remove();
        }

        $(document).ready(function () {
            $('[data-toggle="tooltip"]').tooltip();
        });

        $(window).resize(function () {
            refreshLoginFooter();
        });

        function refreshLoginFooter() {
            var windowHeight = window.innerHeight;
            var loginContainerTop = $("#header-container").innerHeight();
            var contentHeight = $("#body-container").innerHeight();

            var footerOuterHeight = $('#footer-container').outerHeight();
            var total = loginContainerTop + contentHeight + 16 + footerOuterHeight;
            var remainingHeight = windowHeight - total;
            if (total < windowHeight) {
                $('#footer-container').css("margin-top", remainingHeight + "px");
            }
            else {
                $("#footer-container").css("margin-top", "16px");
            }
            $("#footer-container").removeClass("displaynone");
        }

    </script>
</body>
</html>
