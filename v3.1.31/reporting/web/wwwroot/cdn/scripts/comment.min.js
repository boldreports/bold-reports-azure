/*!
*  filename: comment.min.js
*  version : unknown version
*  Copyright Syncfusion Inc. 2001 - 2013. All rights reserved.
*  Use of this code is subject to the terms of our license.
*  A copy of the current license can be obtained at any time by e-mailing
*  licensing@syncfusion.com. Any infringement will be prosecuted under
*  applicable laws. 
*/
function GetAllComments(n,t,i,r){var u={orderBy:r,skip:0,take:0,itemType:t,itemId:n,dashboardItemId:i,commentAction:commentAction.GetComments,parentDashboardId:parentDashboardId};showWaitingPopup("parent-scroll-element");getAllCommentAjax=parent.ajaxPostCall("POST",getAllCommentsUrl,u,null,getCommentsResult,null,completeCommentResult)}function completeCommentResult(){$(".post-message > p > img").load(function(){refreshCommentScroller()});generateProfileAvatar()}function getCommentsResult(n){var u,f,e,t,r,i;if(n){if(n.Status==!0){if($(".view-heading").css("display","block"),parent.$("#commentModuleContainer").hasClass("displayNone")?$($(".header-section a")[0]).css("display","none"):($($(".header-section a")[0]).css("display","block"),parent.$("#widget-loader-icon").hide()),u=n.Comments,f=ConstructTree(u,null),$(".comment-list").html(f),$(".comment-list").find(".post").find(".post").find(".children").addClass("no-left-padding"),$("#comment_count").text(n.ActiveCommentsCount),n.ActiveCommentsCount==0&&($("#comment_action_slider").click(),$(".additional-content").html("<h5>"+window.Server.App.LocalizationContent.NoComments+"<\/h5>")),$('[data-toggle="tooltip"]').tooltip(),hideWaitingPopup("parent-scroll-element"),$("body").removeClass("displayNone"),refreshCommentScroller(),e=document.URL,parent.document.URL.indexOf("comment=")>-1)if(t="#comment-"+getUrlVars(parent.document.URL.split("#")[0]).comment,$(t).find("span.time-ago:first").click(),$(t).find(".post-content:first").css({"background-color":"#F4E4AE"}),parent.document.URL.indexOf("isreply=true")>-1&&$(t).find(".reply-comment").first().click(),i_am_ie9)for($(t).find(".post-content:first").css("backgroundColor","hsl(46,76%,82%"),r=3e3,i=82;i<=100;i=i+.1)r+=10,function(n,i){setTimeout(function(){$(t).find(".post-content:first").css("backgroundColor","hsl(46,76%,"+n+"%)")},i)}(i,r);else setTimeout(function(){$(t).find(".post-content:first").css({transition:"background-color 10s ease-in-out","background-color":"inherit"})},40),setTimeout(function(){$(t).find(".post-content:first").attr("style","")},7e3);addTarget_blank()}else hideWaitingPopup("parent-scroll-element");parent.document.URL.indexOf("comment=")==-1&&refreshCommentScroller()}}function refreshCommentScroller(){var i,n,r,t;i=$("#comment_action_area").hasClass("isHide")?$("#comment_submit_container").outerHeight():$("#comment_action_area").outerHeight();$("#isWidgetComment").val()=="true"||(parent.$("#comment-module-container-loader-icon").hide(),$("#scroll-element").children().addClass("e-content"),n=parent.$("#commentModuleContainer").height()-(i+$(".count-sort").outerHeight()+$(".header-section").outerHeight()),r=parent.$("#commentModuleContainer").width()-2,$("#scroll-element").ejScroller({height:n,width:r,scrollerSize:7,buttonSize:0,enableTouchScroll:parent.$("#is_mobile").val()!=="false"}),t=$("#scroll-element").ejScroller("instance"),t.model.height=n,t.refresh())}function ConstructTree(n,t){var r,i,u,f;if(generateProfileAvatar(),r="",n!=null)for(i=0;i<n.length;i++){if(u=0,n[i].Replies.length>0)for(f=0;f<n[i].Replies.length;f++)n[i].Replies[f].IsActive&&(u+=1);n[i].IsActive?(r+="<li id='comment-"+n[i].Id+"'data-comment-id='"+n[i].Id+"' class='post collapse in'><div class='post-content'><div class='avatar-container'> <div class='user' data-userid='"+n[i].UserId+"'><div class='profile-pic-tag avatar' data-id='"+n[i].IdPReferenceId+"' data-type='user' data-display-name='"+n[i].UserDisplayName+"' data-image-size='32' data-toggle='tooltip' title='"+n[i].UserDisplayName+"' data-placement='top'><\/div><\/div><\/div><div class='post-body'> <header><span class='post-byline col-xs-5 no-padding'><span title='"+n[i].UserDisplayName+"'class='author publisher-anchor-color'>"+n[i].UserDisplayName+"<\/span><\/span><menu>",r+="<li class='reply' title='"+window.Server.App.LocalizationContent.ReplyButton+"' data-toggle='tooltip' data-placement='bottom'> <a class='reply-comment'><span class='su su-reply'><\/span> <\/a><\/li>",($("#isadmin").text().toLowerCase()=="true"||n[i].UserId==$("#userName").val()||t!==null)&&(r+="<span class='dropdown-toggle option-icon' title='"+window.Server.App.LocalizationContent.Action+"' data-toggle='dropdown'><span class='su su-options-horizontal'><\/span><\/span><ul class='dropdown-menu' role='menu'>",n[i].UserId==$("#userName").val()&&(r+="<li class='edit' title='"+window.Server.App.LocalizationContent.EditButton+"' data-toggle='tooltip' data-placement='top'> <a class='edit-comment'><span>"+window.Server.App.LocalizationContent.EditButton+"<\/span> <\/a><\/li>"),($("#isadmin").text().toLowerCase()=="true"||n[i].UserId==$("#userName").val())&&(r+="<li class='delete' title='"+window.Server.App.LocalizationContent.Delete+"' data-toggle='tooltip' data-placement='top'> <a class='delete-comment'><span>"+window.Server.App.LocalizationContent.Delete+"<\/span> <\/a><\/li>"),t!=null&&(r+="<li class='parent' data-parent-id='"+t.Id+"' title='"+window.Server.App.LocalizationContent.Replied+" "+t.UserDisplayName+"' data-toggle='tooltip' data-placement='top'> <a class='parent-name'><span>"+window.Server.App.LocalizationContent.ShowParent+"<\/span> <\/a><\/li><\/ul>")),r+="<\/menu><span class='post-meta col-xs-9 no-padding'><a "+commentPermalinkHelper(n[i].Id)+" class='permalink'><span class='time-ago' title='"+n[i].Id+"'class='permalink'><span class='time-ago' title='"+n[i].CreatedDateString+" - "+n[i].TimeZoneName+"'data-html='false' data-toggle='tooltip' data-placement='right'>"+n[i].TimeAgo+"<\/span><\/a><\/span> <\/header> <div class='post-body-inner'><div class='edit-post displayNone'><\/div><div class='post-message'>"+SplitUserDisplayName(n[i].HtmlComment,n[i].MarkdownComment)+"<\/div><div class='markDownComment hidden'>"+n[i].MarkdownComment+"<\/div> <\/div><\/div><div class='reply-form-container displayNone'><\/div><div class='col-xs-12 reply-count "+(u>0?"hasChild":"")+"'><div class='col-xs-6 child-count'><span class='count-text'>"+u+"<\/span><span class='count-label'>"+(u!=1?window.Server.App.LocalizationContent.Replies:window.Server.App.LocalizationContent.ReplyMessage)+"<\/span><\/div><div class='col-xs-6 no-padding collapse-icon-container'><span class='su ",r+=u>0?"su-vertical-collapse collapse-icon' title='"+window.Server.App.LocalizationContent.Collapse+"'><\/span>":"collapse-icon' data-toggle='collapse'><\/span>",r+="<\/div><\/div><\/div><ul class='children'>"):(r+="<li id='comment-"+n[i].Id+"'data-comment-id='"+n[i].Id+"' class='post'><div class='post-content'><div class='avatar-container'><div class='profile-pic-tag avatar' data-id='"+n[i].IdPReferenceId+"' data-type='user' data-display-name='"+n[i].UserDisplayName+"' data-image-size='32' data-toggle='tooltip' title='"+n[i].UserDisplayName+"' data-placement='top'><\/div><\/div><div class='post-body'> <header><span class='post-byline col-xs-5 no-padding'><\/span><span class='post-meta col-xs-9 hidden no-padding'><a "+commentPermalinkHelper(n[i].Id)+" class='permalink'><span class='time-ago' title='"+n[i].CreatedDateString+" - "+n[i].TimeZoneName+"'data-html='false' data-toggle='tooltip' data-placement='right'>"+n[i].TimeAgo+"<\/span><\/a><\/span><menu class='deleted-post'><li class='reply' > <span class='su su-reply'><\/span> <\/li><span class='dropdown-toggle option-icon' ><span class='su su-options-horizontal'><\/span><\/span><\/menu><\/header> <div class='post-body-inner'><div class='post-message deleted-message'><span class='su su-warning'><\/span><span>"+window.Server.App.LocalizationContent.DeletedMessage+"<\/span><\/div> <\/div><\/div><div class='col-xs-12 reply-count "+(u>0?"hasChild":"")+"'><div class='col-xs-6 child-count'><span class='count-text'>"+u+"<\/span><span class='count-label'>"+(u!=1?window.Server.App.LocalizationContent.Replies:window.Server.App.LocalizationContent.ReplyMessage)+"<\/span><\/div><div class='col-xs-6 no-padding'>",u>0&&(r+="<span class='su su-vertical-collapse collapse-icon' data-toggle='collapse'<\/span>"),r+="<\/div><\/div><\/div><ul class='children'>");r+=n[i].Replies.length>0?ConstructTree(n[i].Replies,n[i])+"<\/ul> <\/li>":"<\/ul> <\/li>"}return r}function customMarkdownParser(n){var f=[],o=[],e=[],l=/(?:\@\ (.*?)\ )/g,v=$("#itemType").attr("data-item-type").toLowerCase().replace(/\b[a-z]/g,function(n){return n.toUpperCase()}),y=new EasyMDE({element:$("#temp")[0],spellChecker:!1,autoDownloadFontAwesome:!1}),r=n,a,c,s,u,i,h,t;if(f=r.match(/(?:\@\ (\[.*?\])\ )/g),f!=null)for(f=jQuery.unique(f),t=0;t<f.length;t++)a=SplitUserDisplayName(f[t],f[t]),r=r.replace(f[t],"<span class='cm-usercontainer'>"+a+"<\/span>");if(o=r.match(l),o!=null)for(o=jQuery.unique(r.match(l)),t=0;t<o.length;t++)c=new RegExp(o[t],"g"),r=r.replace(c,"<span class='cm-groupcontainer'>"+o[t]+"<\/span>");if(e=r.match(/(@all)/g),e!=null)for(e=jQuery.unique(e),t=0;t<e.length;t++)c=new RegExp(e[t],"g"),r=r.replace(e[t],"<span class='cm-allcontainer'>"+e[t]+"<\/span>");for(r=y.options.previewRender(r),$("#toRemoveCulture").html(r),splitter=window.location.href.split("/")[4]+"/",s=$("#toRemoveCulture a"),i=0;i<s.length;i++)s[i].setAttribute("target","_blank"),s[i].href=s[i].href.split(splitter)[1];for(u=$("#toRemoveCulture img"),i=0;i<u.length;i++)if(u[i].setAttribute("target","_blank"),u[i].src.indexOf(splitter)!==-1&&(u[i].src=u[i].src.split(splitter)[1]),u[i].src.indexOf("image-")!==-1)for(h=u[i].src.split("/"),t=0;t<h.length;t++)h[t].indexOf("image-")!==-1&&(u[i].src=rootUrl+"/content/images/commentimages/"+v+"/"+itemId+"/"+h[t]);return $("#toRemoveCulture").html()}function renderMde(n){var t=new EasyMDE({element:$(n)[0],status:!1,spellChecker:!1,autoDownloadFontAwesome:!1,toolbar:[{name:"bold",action:EasyMDE.toggleBold,className:"su su-bold",title:window.Server.App.LocalizationContent.Bold},{name:"italic",action:EasyMDE.toggleItalic,className:"su su-italic",title:window.Server.App.LocalizationContent.Italic},{name:"heading",action:EasyMDE.toggleHeadingSmaller,className:"su su-header",title:window.Server.App.LocalizationContent.Heading},"|",{name:"quote",action:EasyMDE.toggleBlockquote,className:"su su-quote",title:window.Server.App.LocalizationContent.Quote},{name:"unordered-list",action:EasyMDE.toggleUnorderedList,className:"su su-list-ul",title:window.Server.App.LocalizationContent.Generic},{name:"ordered-list",action:EasyMDE.toggleOrderedList,className:"su su-list-ol",title:window.Server.App.LocalizationContent.Number},"|",{name:"link",action:EasyMDE.drawLink,className:"su su-link",title:window.Server.App.LocalizationContent.Link},{name:"image",action:EasyMDE.drawImage,className:"su su-image",title:window.Server.App.LocalizationContent.Image},{name:"uploadImage",className:"su su-upload-image",title:window.Server.App.LocalizationContent.UploadImage},{name:"preview",action:EasyMDE.togglePreview,className:"su su-preview no-disable",title:window.Server.App.LocalizationContent.Preview}],previewRender:function(n){return customMarkdownParser(n)}});return $(".su-upload-image").attr("id")=="comment-image-file"?$(".su-upload-image").attr("id","comment-image-edit-file"):$(".su-upload-image").attr("id","comment-image-file"),t}function getUrlVars(n){var t={},i=n.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(n,i,r){t[i]=r});return t}function addTarget_blank(){$("ul#commentList li .post-message").find("a").attr("target","_blank")}function truncateUrl(){var n=parent.window.location.href.split("#")[0],i=n.indexOf("?comment="),r=n.indexOf("&comment="),t=n.substr(0,n.indexOf("/reports")+1);return t.length>0&&(n=n.replace(t,"/")),i>0?n=n.slice(0,n.lastIndexOf("?comment=")):r>0&&(n=n.slice(0,n.lastIndexOf("&comment="))),n}function getRelativePath(n){var e=$("#itemType").attr("data-item-type").toLowerCase().replace(/\b[a-z]/g,function(n){return n.toUpperCase()}),f=n.match(/(?:\!\[\]\((.*?)\))/g),t=[],r,u,i;if(f!=null){for(r=0;r<f.length;r++)t[r]=f[r].split(/[\(\\!\[\ \]\\)\s]+/),t[r]=$.grep(t[r],function(n){return n});for(u="",i=0;i<t.length;i++)t[i]=t[i].toString(),t[i].indexOf("image-")!==-1&&(u=rootUrl+"/content/images/commentimages/"+e+"/"+itemId+"/"+t[i],u!=""&&(t[i]="![]("+t[i]+")",u="![]("+u+")",n=n.replace(t[i],u)))}return n}function pasteImageReader(n){var t=n,i=$("#itemType").attr("data-item-type").toLowerCase().replace(/\b[a-z]/g,function(n){return n.toUpperCase()}),r={DataUrl:t,itemId:itemId,itemType:i,parentDashboardId:parentDashboardId};parent.ajaxPostCall("POST",commentImageUrl,r,null,pasteCommentImages,null,null)}function pasteCommentImages(n){if(n!==""&&n.indexOf("image-")!==-1){var t=" ![]("+n+")";cursorPos.codemirror.replaceSelection(t);hideWaitingPopup("parent-scroll-element")}else hideWaitingPopup("parent-scroll-element")}function autoCompletes(n,t){var u=function(n){return window.event?n.keyCode:n.which?n.which:void 0},r=u(n),i,f;r===38?(i=jQuery.Event("keydown"),i.keyCode=38,i.which=38,$("#autocomplete-input").trigger(i)):r===40?(i=jQuery.Event("keydown"),i.keyCode=40,i.which=40,$("#autocomplete-input").trigger(i)):r===13?(n.preventDefault(),f=$("ul.e-ul li.e-hover").attr("id")):(autoCompleteRefresh(t),$("#autocomplete-input").val(t),$("#autocomplete-input").ejAutocomplete("enable"),$("#autocomplete-input").ejAutocomplete("search"),$("#autocomplete-input").ejAutocomplete("hide"))}function getCaretCharacterOffsetWithin(n){var e=0,i=n.ownerDocument||n.document,o=i.defaultView||i.parentWindow,t,r,u,s,f;return typeof o.getSelection!="undefined"?(t=o.getSelection(),t.rangeCount>0&&(r=o.getSelection().getRangeAt(0),u=r.cloneRange(),u.selectNodeContents(n),u.setEnd(r.endContainer,r.endOffset),e=u.toString().length)):(t=i.selection)&&t.type!="Control"&&(s=t.createRange(),f=i.body.createTextRange(),f.moveToElementText(n),f.setEndPoint("EndToEnd",s),e=f.text.length),e}function onSelect(n){var u,e="",t,i;$("#scroll-element").ejScroller("enable");t=$("ul.e-ul li.e-hover").attr("id");t!=""&&t!=undefined&&t!=null&&(i=t.split("-"),i!=""&&i!=undefined&&i!=null&&(u=i[0],e=t.split(/-(.+)?/)[1]));var r=initialPosition.line,f=initialPosition.ch,o=initialLine.length;targetElement.focus();cursorPos.codemirror.setSelection({line:r,ch:0},{line:r,ch:o});cursorPos.codemirror.replaceSelection(initialLine);cursorPos.codemirror.setSelection({line:r,ch:f},{line:r,ch:f});u=="User"?cursorPos.codemirror.replaceSelection("@ ["+n.item.Name+"|~"+n.item.IdPReferenceId+"] "):cursorPos.codemirror.replaceSelection("@ "+n.value+" ");$("#autocomplete-input").ejAutocomplete("disable");$("#autocomplete-input_suggestion").attr("style","display:none !important;")}function onOpen(){var n=$("#autocomplete-input").data("ejAutocomplete").scrollerObj,t;n.model.height=135;n.model.buttonSize=0;n.model.scrollerSize=9;n.refresh();$("#autocomplete-input_suggestion").attr("style","display:block !important; z-index: 9;");var r=document.getElementById("autocomplete"),u=0,f=0;if($(r).length){t=$(r)[0].getBoundingClientRect();u=t.left;f=t.top;var i=u,o=f+30,e=$("#autocomplete-input_suggestion").width(),h=$("#autocomplete-input_suggestion").height(),c=$(parent.$("#commentModuleContainer")[0]).height(),s=$(parent.$("#commentModuleContainer")[0]).width(),l=s>i+e?$("#autocomplete-input_suggestion").css("left",i):$("#autocomplete-input_suggestion").css("left",i-e+16);$("#autocomplete-input_suggestion").css("top",o);$("#autocomplete-input_suggestion").addClass("usermention-suggestionlist")}}function autoCompleteRefresh(n){var t=n;clearTimeout(window.timer);window.timer=setTimeout(function(){autosuggestion(t)},400)}function autosuggestion(n){var t,i;$.xhrPool.abortAll();t=parent.$("#dashboard_Comment").attr("data-item-id");$("#autocomplete-input_suggestion").css("display","none");n.trim()!=""&&(i={searchWord:n,itemId:t,parentDashboardId:parent.$("#isMultiDashboard").attr("data-parent-id")},parent.ajaxPostCall("GET",userMentionDataSourceUrl,i,null,userMentionDataList,null,null))}function userMentionDataList(n){$("#autocomplete-input_suggestion").css("display","none");var t=$("#autocomplete-input").data("ejAutocomplete");t.model.dataSource=JSON.parse(n);t._OnTextEnter();onOpen()}function splitUserMention(n){var r=$(n).children().find(".CodeMirror-code"),s=!1,h=[],c=[],t=[],u=[],f=[],e=$(r)[0].getElementsByClassName("cm-usercontainer"),o=$(r)[0].getElementsByClassName("cm-groupcontainer"),l=$(r)[0].getElementsByClassName("cm-allcontainer");if(e.length)for(i=0;i<e.length;i++)t[i]=/(?:\@\ (.*?)\ )/.exec(e[i].textContent),t[i]&&h.push(t[i][1].replaceAll("[","").replaceAll("]",""));if(o.length)for(i=0;i<o.length;i++)t[i]=/(?:\@\ (.*?)\ )/.exec(o[i].textContent),t[i]&&c.push(t[i][1]);return l.length?s=!0:($.each(h,function(n,t){$.inArray(t,u)===-1&&u.push(t)}),$.each(c,function(n,t){$.inArray(t,f)===-1&&f.push(t)})),{uniqueUsersValue:u,uniqueGroupValue:f,mentionedAll:s}}function userMentionInitializing(n,t){var e=n.target,p=n.keyCode?n.keyCode:n.which,w=cursorPos.value(),c,s,y,f,a;if(p===64&&(targetElement=e,$("#autocomplete-trigger").length==0)){c='<span id="autocomplete"><span id="autocomplete-trigger">@<\/span><span id="autocomplete-search-text" contenteditable><\/span><\/span>';cursorPos.codemirrorIgnore;s=cursorPos.codemirror.getCursor();initialPosition=s;var r=s.line,i=s.ch,u=cursorPos.codemirror.getLine(r);initialLine=u;var o=u.length,h="",l=cursorPos.codemirror.findWordAt({line:r,ch:i}).anchor.ch,v=cursorPos.codemirror.findWordAt({line:r,ch:i}).head.ch;l==v-1&&o==i||l==0&&v==0||u[i-1]==" "&&u[i]==undefined?(f=$(t).children().find(".CodeMirror-code").children(),f&&($(f[r].firstChild).append(c),h=$("#autocomplete-search-text"),$(h[0]).focus()),n.preventDefault(),$("#scroll-element").ejScroller("disable")):(i==l||u[i-1]==" "&&(u[i+1]==" "||u[i]==" "))&&(cursorPos.codemirror.setSelection({line:r,ch:i},{line:r,ch:o}),y=cursorPos.codemirror.getSelection(),cursorPos.codemirror.replaceSelection(""),f=$(t).children().find(".CodeMirror-code").children(),f&&(a=f[r].firstChild,$(a).append(c),a.append(y),h=$("#autocomplete-search-text"),$(h[0]).focus()),n.preventDefault(),$("#scroll-element").ejScroller("disable"));$("#autocomplete-search-text").on("keydown",function(n){var t=n.keyCode?n.keyCode:n.which,f=$("#autocomplete-search-text").text(),s=document.getElementById("autocomplete-search-text"),h=getCaretCharacterOffsetWithin(s);t===8&&h==0&&($("#autocomplete-input_suggestion").css("display","none"),removingUserMentionContainer(e,f,r,i,o,u))});$("#autocomplete-search-text").on("blur",function(){$("#scroll-element").ejScroller("enable")});$("#autocomplete-search-text").on("keyup",function(n){var t=n.keyCode?n.keyCode:n.which,h,s,c,a;$("#scroll-element").ejScroller("enable");var f=$("#autocomplete-search-text").text(),l=document.getElementById("autocomplete-search-text"),v=getCaretCharacterOffsetWithin(l);t===27||t===33||t===9||t===36?removingUserMentionContainer(e,f,r,i,o,u):t===13?(n.preventDefault(),h=$("ul.e-ul li.e-hover").attr("id"),s=$("ul.e-ul li.e-hover").text(),s!=""&&s!="No suggestions"?(c={id:h,value:s},onSelect(c)):removingUserMentionContainer(e,f,r,i,o,u)):a=t!=38&&t!=40?autoCompletes(n,f):autoCompletes(n,f)});$(".CodeMirror").on("click",function(){var n="",t;$("#autocomplete-search-text").length&&$("#autocomplete").length&&(t=$("#autocomplete-search-text").text(),n="@"+t,n=n.trim(),e.focus(),cursorPos.codemirror.setSelection({line:initialPosition.line,ch:0},{line:initialPosition.line,ch:initialLine.length}),cursorPos.codemirror.replaceSelection(initialLine),cursorPos.codemirror.setSelection({line:initialPosition.line,ch:initialPosition.ch},{line:initialPosition.line,ch:initialPosition.ch}),cursorPos.codemirror.replaceSelection(n),$("#autocomplete-input").ejAutocomplete("disable"),$("#autocomplete-input_suggestion").attr("style","display:none !important;"))})}}function displaySuggestionList(){$("#autocomplete-input_suggestion").css("display","none")}function removingUserMentionContainer(n,t,i,r,u,f){$("#scroll-element").ejScroller("enable");var e="";$("#autocomplete-search-text").length&&$("#autocomplete").length&&(e="@"+t,e=e.trim(),$("#autocomplete-input").ejAutocomplete("disable"),$("#autocomplete-input_suggestion").attr("style","display:none !important;"),n.focus(),cursorPos.codemirror.setSelection({line:i,ch:0},{line:i,ch:u}),cursorPos.codemirror.replaceSelection(f),cursorPos.codemirror.setSelection({line:i,ch:r},{line:i,ch:r}),cursorPos.codemirror.replaceSelection(e),$("#autocomplete-input").ejAutocomplete("disable"),$("#autocomplete-input_suggestion").attr("style","display:none !important;"))}function ajaxSetup(){$.xhrPool=[];$.xhrPool.abortAll=function(){$(this).each(function(n,t){t.abort()});$.xhrPool.length=0};$.ajaxSetup({beforeSend:function(n){$.xhrPool.push(n)},complete:function(n){var t=$.xhrPool.indexOf(n);t>-1&&$.xhrPool.splice(t,1)}})}function commentPermalinkHelper(n){return"href='#comment-"+n+"'"}function SplitUserDisplayName(n,t){var r=/\[|\]\\|\|\~.*?]/g,i=t.match(/(?:\@\ (.*?)\ )/g);return i!=null&&$.each(i,function(t,i){var u=i.replace(r,"");n=n.replace(i,u)}),n}var cursorPos,Paste,createHiddenEditable,isFocusable,initialLine,initialPosition,targetElement,itemId,dataManger,elementNode,getAllCommentAjax,deletedCommentId,dashboardTypeId="#sync_report_viewer",parentRefUrl=window.location!=window.parent.location?document.referrer:document.location.href.replace(document.location.pathname+document.location.search,""),parentUrl=parentRefUrl==""?"":parentRefUrl.match(/:\/\/(.[^/]+)/)[1];var iframeRefUrl=window.location.href,iframeUrl=iframeRefUrl.match(/:\/\/(.[^/]+)/)[1],commentAction={Add:0,Edit:1,Delete:2,GetComments:3},date=new Date;$(document).ready(function(){function e(n){var r,u;n?(r="<li id='comment-"+n.Comments[0].Id+"'data-comment-id='"+n.Comments[0].Id+"' class='post'><div class='post-content'><div class='avatar-container'> <div class='user' data-userid='"+n.Comments[0].UserId+"'><div class='profile-pic-tag avatar' data-id='"+n.Comments[0].IdPReferenceId+"' data-type='user' data-display-name='"+n.Comments[0].UserDisplayName+"' data-image-size='32' data-toggle='tooltip' title='"+n.Comments[0].UserDisplayName+"' data-placement='top'><\/div> <\/div><\/div><div class='post-body'> <header><span class='post-byline col-xs-5 no-padding'><span title='"+n.Comments[0].UserDisplayName+"'class='author publisher-anchor-color'>"+n.Comments[0].UserDisplayName+"<\/span><span class='su su-status-active'><\/span><\/span><menu><li class='reply' title='"+window.Server.App.LocalizationContent.ReplyButton+"' data-toggle='tooltip' data-placement='bottom'> <a class='reply-comment'><span class='su su-reply'><\/span> <\/a><\/li><span class='dropdown-toggle option-icon' title='"+window.Server.App.LocalizationContent.Action+"' data-toggle='dropdown'><span class='su su-options-horizontal'><\/span><\/span><ul class='dropdown-menu' role='menu'><li class='edit' title='"+window.Server.App.LocalizationContent.EditButton+"'  data-toggle='tooltip' data-placement='top'> <a class='edit-comment'><span>"+window.Server.App.LocalizationContent.EditButton+"<\/span> <\/a><\/li><li class='delete' title='"+window.Server.App.LocalizationContent.Delete+"'  data-toggle='tooltip' data-placement='top'> <a class='delete-comment'><span>"+window.Server.App.LocalizationContent.Delete+"<\/span> <\/a><\/li><\/menu><span class='post-meta col-xs-9 no-padding'><a "+commentPermalinkHelper(n.Comments[0].Id)+" class='permalink'><span class='time-ago' title='"+n.Comments[0].Id+"'class='permalink'><span class='time-ago' title='"+n.Comments[0].CreatedDateString+" - "+n.Comments[0].TimeZoneName+"' data-html='false' data-toggle='tooltip' data-placement='right'>"+n.Comments[0].TimeAgo+"<\/span><\/a><\/span> <\/header> <div class='post-body-inner'><div class='edit-post displayNone'><\/div><div class='post-message'>"+SplitUserDisplayName(n.Comments[0].HtmlComment,n.Comments[0].MarkdownComment)+"<\/div><div class='markDownComment hidden'>"+n.Comments[0].MarkdownComment+"<\/div><\/div> <div class='footer'><\/div><\/div><div class='reply-form-container displayNone'><\/div><div class='col-xs-12 reply-count'><div class='col-xs-6 child-count'><span class='count-text'>0<\/span><span class='count-label'> "+window.Server.App.LocalizationContent.Replies+"<\/span><\/div><div class='col-xs-6 no-padding collapse-icon-container'><span class='su collapse-icon' data-toggle='collapse' data-target=''><\/span><\/div><\/div><\/div><ul class='children'><\/ul> <\/li>",$(".sort-old").hasClass("sort-active")?$(".comment-list").append(r):$(".comment-list").prepend(r),$(".additional-content").html(""),u=parseInt($("#comment_count").text()),$("#comment_count").text(u+1),$('[data-toggle="tooltip"]').tooltip(),i.value(""),$("#comment_action_area").show(),$(".watch-action").hasClass("watch")&&($("#watchItem").val("Unwatch"),$("#watchItem").removeClass("watch").addClass("unwatch"),$("#watch-text").removeClass("watch").addClass("unwatch"),$("#watchItem").attr("data-original-title",window.Server.App.LocalizationContent.Unwatch)),hideWaitingPopup("parent-scroll-element"),$("#comment_action_area").removeClass("isHide"),$("#comment_action_area").show(),$("#comment_submit_container").hide(),refreshCommentScroller(),addTarget_blank(),$("#comment-"+n.Comments[0].Id).find("span.time-ago:first").click(),u==0&&t=="report"&&parent.$("#dashboard-comment").removeClass("su-without-comment").addClass("su-with-comment"),$(".post-message > p > img").load(function(){refreshCommentScroller()})):(hideWaitingPopup("parent-scroll-element"),parent.frames[1].messageBox("su-open",window.Server.App.LocalizationContent.AddComment,window.Server.App.LocalizationContent.AddCommentFail,"success",function(){parent.frames[1].onCloseMessageBox()}));generateProfileAvatar()}function o(n){n?($("#save-edit").parentsUntil(".post").find(".post-message").html(SplitUserDisplayName(n.Comments[0].HtmlComment,n.Comments[0].MarkdownComment)),$("#save-edit").parentsUntil(".post").find(".markDownComment").html(n.Comments[0].MarkdownComment),$("#save-edit").parentsUntil(".post").find(".post-message").removeClass("displayNone"),$(".watch-action").hasClass("watch")&&($("#watchItem").val("Unwatch"),$("#watchItem").removeClass("watch").addClass("unwatch"),$("#watch-text").removeClass("watch").addClass("unwatch"),$("#watchItem").attr("data-original-title",window.Server.App.LocalizationContent.Unwatch)),hideWaitingPopup($("#save-edit").parentsUntil(".post").find(".edit-post")),$(".edit-post").addClass("displayNone"),$(".edit-post").html(""),refreshCommentScroller(),addTarget_blank()):(parent.frames[1].messageBox("su-open",window.Server.App.LocalizationContent.EditComment,window.Server.App.LocalizationContent.EditCommentFail,"success",function(){parent.frames[1].onCloseMessageBox()}),hideWaitingPopup($("#save-edit").parentsUntil(".post").find(".edit-post")))}function s(n){n?(addComment="<li id='comment-"+n.Comments[0].Id+"'data-comment-id='"+n.Comments[0].Id+"' class='post collapse in'><div class='post-content'><div class='avatar-container'> <div class='user' data-userid='"+n.Comments[0].UserId+"'><div class='profile-pic-tag avatar' data-id='"+n.Comments[0].IdPReferenceId+"' data-type='user' data-display-name='"+n.Comments[0].UserDisplayName+"' data-image-size='32' data-toggle='tooltip' title='"+n.Comments[0].UserDisplayName+"' data-placement='top'><\/div><\/div><\/div><div class='post-body'> <header><span class='post-byline col-xs-5 no-padding'><span title='"+n.Comments[0].UserDisplayName+"'class='author publisher-anchor-color'>"+n.Comments[0].UserDisplayName+"<\/span><span class='su su-status-active'><\/span><\/span><menu>",addComment+="<li class='reply' title='"+window.Server.App.LocalizationContent.ReplyButton+"'data-toggle='tooltip' data-placement='bottom'> <a class='reply-comment'><span class='su su-reply'><\/span> <\/a><\/li><span class='dropdown-toggle option-icon' title='"+window.Server.App.LocalizationContent.Action+"' data-toggle='dropdown'><span class='su su-options-horizontal'><\/span><\/span><ul class='dropdown-menu' role='menu'><li class='edit' title='"+window.Server.App.LocalizationContent.EditButton+"'  data-toggle='tooltip' data-placement='top'> <a class='edit-comment'><span>"+window.Server.App.LocalizationContent.EditButton+"<\/span> <\/a><\/li><li class='delete' title='"+window.Server.App.LocalizationContent.Delete+"'  data-toggle='tooltip' data-placement='top'> <a class='delete-comment'><span>"+window.Server.App.LocalizationContent.Delete+"<\/span> <\/a><\/li><li class='parent' data-parent-id='"+n.Comments[0].ParentId+"' title='"+window.Server.App.LocalizationContent.Replied+" "+$("#replyComment").parents(".post").find(".author").attr("title")+"'> <a class='parent-name'><span>"+window.Server.App.LocalizationContent.ShowParent+"<\/span> <\/a><\/li><\/ul><\/menu><span class='post-meta col-xs-9 no-padding'><a "+commentPermalinkHelper(n.Comments[0].Id)+" class='permalink'><span class='time-ago' title='"+n.Comments[0].Id+"'class='permalink'><span class='time-ago' title='"+n.Comments[0].CreatedDateString+" - "+n.Comments[0].TimeZoneName+"'data-html='false' data-toggle='tooltip' data-placement='right'>"+n.Comments[0].TimeAgo+"<\/span><\/a><\/span> <\/header> <div class='post-body-inner'><div class='edit-post displayNone'><\/div><div class='post-message'>"+SplitUserDisplayName(n.Comments[0].HtmlComment,n.Comments[0].MarkdownComment)+"<\/div><div class='markDownComment hidden'>"+n.Comments[0].MarkdownComment+"<\/div> <\/div> <div class='footer'><\/div><\/div><div class='reply-form-container displayNone'><\/div><div class='col-xs-12 reply-count'><div class='col-xs-6 child-count'><span class='count-text'>0<\/span><span class='count-label'> "+window.Server.App.LocalizationContent.Replies+"<\/span><\/div><div class='col-xs-6 no-padding collapse-icon-container'><span class='su collapse-icon' data-toggle='collapse' data-target=''><\/span><\/div><\/div><\/div><ul class='children'><\/ul> <\/li>",$("#post-reply").closest(".post-content").siblings().prepend(addComment),$(".reply-form-container").html(""),$("#replyComment").addClass("displayNone"),$(".comment-list").find(".post").find(".post").find(".children").addClass("no-left-padding"),$("#comment_count").text(parseInt($("#comment_count").text())+1),$('[data-toggle="tooltip"]').tooltip(),$("#replyComment").parent().find(".count-text").text(parseInt($("#replyComment").parent().find(".count-text").text())+1),parseInt($("#replyComment").parent().find(".count-text").text())==1?$("#replyComment").parent().find(".count-label").text(window.Server.App.LocalizationContent.ReplyMessage):$("#replyComment").parent().find(".count-label").text(" "+window.Server.App.LocalizationContent.Replies),$("#replyComment").parent().find(".collapse-icon").addClass("su-vertical-collapse"),$("#replyComment").parent().find(".reply-count").addClass("hasChild"),$(".watch-action").hasClass("watch")&&($("#watchItem").val("Unwatch"),$("#watchItem").removeClass("watch").addClass("unwatch"),$("#watch-text").removeClass("watch").addClass("unwatch"),$("#watchItem").attr("data-original-title",window.Server.App.LocalizationContent.Unwatch)),hideWaitingPopup("replyComment"),$("#replyComment").removeClass("e-waitingpopup e-js"),$(".reply-form-container").attr("id",""),refreshCommentScroller(),addTarget_blank(),generateProfileAvatar()):($("#replyComment").addClass("displayNone"),hideWaitingPopup("replyComment"),$(".reply-form-container").attr("id",""),parent.frames[1].messageBox("su-open",window.Server.App.LocalizationContent.ReplyButton,window.Server.App.LocalizationContent.ReplyFail,"success",function(){parent.frames[1].onCloseMessageBox()}),refreshCommentScroller())}function h(n){if(n){var i=deletedCommentId;parent.messageBox("su-delete",window.Server.App.LocalizationContent.DeleteComment,window.Server.App.LocalizationContent.DeleteCommnetSuccess,"success",function(){var r,n;$("#"+i).find(".children").html()==""||$("#"+i).find(".user").length==1?$("#"+i).html(""):($("#"+i).find(".avatar-container:first").html("<img src='"+avatarUrl+"' class='avatar'>"),$("#"+i).find(".post-body:first").html("<header><span class='post-byline col-xs-5 no-padding'><\/span><span class='post-meta col-xs-9 no-padding'><\/span><menu class='deleted-post'><li class='reply' > <span class='su su-reply'><\/span> <\/li><span class='dropdown-toggle option-icon' ><span class='su su-options-horizontal'><\/span><\/span><\/menu> <\/header> <div class='post-body-inner'><div class='post-message deleted-message'><span class='su su-warning'><\/span><span>"+window.Server.App.LocalizationContent.DeletedMessage+"<\/span><\/div> <\/div>"));$("#"+i).parents(".post:first").find(".post-content").find(".user").length==0&&$("#"+i).parents(".post:first").html("");parent.onCloseMessageBox();r=parseInt($("#comment_count").text());$("#comment_count").text(r-1);n=parseInt($("#"+i).parents(".post:first").find(".count-text:first").html());n==1&&($("#"+i).parents(".post:first").find(".collapse-icon:first").removeClass("su-vertical-collapse"),$("#"+i).parents(".post:first").find(".reply-count:first").removeClass("hasChild"));n==2&&$("#"+i).parents(".post:first").find(".count-label:first").html(window.Server.App.LocalizationContent.ReplyMessage);$("#"+i).parents(".post:first").find(".count-text:first").html(n-1);refreshCommentScroller();r==1&&t=="report"&&(parent.$("#dashboard-comment").removeClass("su-with-comment").addClass("su-without-comment"),$(".additional-content").html("<h5>"+window.Server.App.LocalizationContent.NoComments+"<\/h5>"))})}else parent.messageBox("su-delete",window.Server.App.LocalizationContent.DeleteComment,window.Server.App.LocalizationContent.DeleteCommentFail,"success",function(){parent.onCloseMessageBox()});$("#messageBox_wrapper").ejWaitingPopup("hide")}function c(n){n?($("#watchItem").val("Unwatch"),$("#watchItem").removeClass("watch").addClass("unwatch"),$("#watch-text").removeClass("watch").addClass("unwatch"),$("#watchItem").attr("data-original-title",window.Server.App.LocalizationContent.Unwatch)):parent.frames[1].messageBox("su-eye",window.Server.App.LocalizationContent.AddWatch,window.Server.App.LocalizationContent.WatchFail,"success",function(){parent.frames[1].onCloseMessageBox()});$(".watch-action").removeClass("disable-post")}function l(n){n?($("#watchItem").val("Watch"),$("#watchItem").removeClass("unwatch").addClass("watch"),$("#watch-text").removeClass("unwatch").addClass("watch"),$("#watchItem").attr("data-original-title",window.Server.App.LocalizationContent.Watch)):parent.frames[1].messageBox("su-eye",window.Server.App.LocalizationContent.Unwatch,window.Server.App.LocalizationContent.UnWatchFail,"success",function(){parent.frames[1].onCloseMessageBox()});$(".watch-action").removeClass("disable-post")}var f,i;dataManager=null;ajaxSetup();f=ej.Query().from("userMentionList").select("Name","Type");$("#autocomplete-input").ejAutocomplete({allowSorting:!1,dataSource:dataManger,width:"200px",popupHeight:"135px",filterType:"contains",query:f,fields:{text:"Name",key:"Type"},select:"onSelect",create:"displaySuggestionList",actionSuccess:"displaySuggestionList",open:"displaySuggestionList"});var t=$("#itemType").attr("data-item-type").toLowerCase(),n=parent.$("#dashboard_Comment").attr("data-item-id"),r=parent.$("#dashboard_Comment").attr("data-category-name"),u=parent.$("#dashboard_Comment").attr("data-item-name");parentDashboardId=parent.$("#isMultiDashboard").attr("data-parent-id");i=renderMde("#rte-post");cursorPos=i;$("#comment_action_slider").click(function(){cursorPos=i.value("");i.isPreviewActive()&&i.togglePreview();$(".reply-form-container").html("");$(".reply-form-container").addClass("displayNone");$(".reply-form-container").attr("id","");$(".edit-post").addClass("displayNone");$(".post-message").removeClass("displayNone");$(".edit-post").html("");$("#comment_action_area").hide();$("#comment_submit_container").show();$("#comment_action_area").addClass("isHide");$(".error-message").html("");refreshCommentScroller();setTimeout(function(){cursorPos.codemirror.focus();cursorPos.codemirror.setCursor({line:0,ch:0})},500)});$("#comment_submit_container > .CodeMirror").on("keypress","textarea",function(n){var t=i.value();t.length>=4e3?n.preventDefault():(elementNode=$("#comment_submit_container > .CodeMirror"),userMentionInitializing(n,elementNode))});$(document).on("click",".header-comment-close",function(){i.value("");$("#comment_action_area").removeClass("isHide");$("#comment_action_area").show();$("#comment_submit_container").hide();refreshCommentScroller()});$(".sort-new").click(function(){GetAllComments(itemId,t,n,"desc");$(".sort-new").addClass("sort-active");$(".sort-new").removeClass("sort-inactive");$(".sort-old").addClass("sort-inactive");$(".sort-old").removeClass("sort-active")});$(".sort-old").click(function(){GetAllComments(itemId,t,n,"asc");$(".sort-new").addClass("sort-inactive");$(".sort-new").removeClass("sort-active");$(".sort-old").addClass("sort-active");$(".sort-old").removeClass("sort-inactive")});$(document).on("focus","textarea",function(){$("textarea").pastableTextarea()});$(document).on("click","#post-comment",function(){var w=$("#comment_submit_container > .CodeMirror"),s=splitUserMention(w),o=truncateUrl(),l=o.split("?"),h="",c,f,a,v,y,p;if(l.length>1&&(h=l[1]),c=o.split("/"),t.toLowerCase()=="report"&&(o=h!=""?"/"+c[1]+"/"+n+"/"+r+"/"+u+"?"+h:"/"+c[1]+"/"+n+"/"+r+"/"+u),f=i.value(),a=i.options.previewRender(f).replace("#",""),f=getRelativePath(f),v=f,y=v.replace("http://","").replace("https://","").replace("(","").replace(")","").replace("![]",""),isEmptyOrWhitespace(a.replace(/<[^>]*>!/ig,""))||isEmptyOrWhitespace(y)){$(".error-message").html("<span class='validate-fail'>"+window.Server.App.LocalizationContent.CommentValidator+"<\/span>");return}if(f.length>4e3){$(".error-message").html("<span class='validate-fail'>"+window.Server.App.LocalizationContent.CommnetLengthValidator+"<\/span>");return}$(".comment-area").val("");$(".error-message").html("");p={itemId:itemId,comment:f,itemType:t,dashboardItemId:n,url:decodeURI(o),uniqueUsersValue:s.uniqueUsersValue,uniqueGroupValue:s.uniqueGroupValue,mentionedAll:s.mentionedAll,parentDashboardId:parentDashboardId,CommentAction:commentAction.Add,currentDate:date};showWaitingPopup("parent-scroll-element");parent.ajaxPostCall("POST",addCommentUrl,p,null,e,null,null)});$(document).on("click",".edit-comment",function(){var h,v,y,c,s,k,e,p,a,b;i.value("");h=$(this).parents("menu").siblings(".post-meta").find("a.permalink");v=$(h).attr("href").split("comment-")[1];typeof v=="undefined"&&(v=$(h).attr("href").split("comment=")[1]);$(h).attr("href","#comment-"+v);$(h).attr("target","");y=$(this).parents(".post").attr("data-comment-id");$("#comment_action_area").removeClass("isHide");$("#comment_action_area").show();$("#comment_submit_container").hide();$(".reply-form-container").html("");$(".reply-form-container").addClass("displayNone");$(".reply-form-container").attr("id","");$(".edit-post").addClass("displayNone");$(".post-message").removeClass("displayNone");$(".edit-post").html("");$(this).closest("div").find(".edit-post").html("<div class='edit'><textarea id='edit_comment_"+y+"' class='form-control edit-text' placeholder='' style='overflow: hidden;'><\/textarea><span class='message'>*"+window.Server.App.LocalizationContent.CommentWords+"<\/span><span class='error-message-edit'><\/span><div class='temp-post'><button class='edit-cancel secondary-button pull-right'>"+window.Server.App.LocalizationContent.CancelButton+"<\/button><button id ='save-edit' class='primary-button pull-right' type='submit'>"+window.Server.App.LocalizationContent.SaveButton+"<\/button><\/div><\/div>");c=renderMde("#edit_comment_"+y);cursorPos=c;$(this).closest("div").find(".post-message").addClass("displayNone");$(this).closest("div").find(".edit-post").removeClass("displayNone");refreshCommentScroller();$(h).find("span.time-ago").click();var l=$(this).closest("div").find(".markDownComment").text(),w=l.match(/(?:\!\[\]\((.*?)\))/g),f=[];if(w!=null){for(s=0;s<w.length;s++)f[s]=w[s].split(/[\(\\!\[\ \]\\)\s]+/),f[s]=$.grep(f[s],function(n){return n});for(k="",e=0;e<f.length;e++)if(f[e]=f[e].toString(),f[e].indexOf("image-")!==-1)for(p=f[e].split("/"),a=0;a<p.length;a++)p[a].indexOf("image-")!==-1&&(l=l.replace(f[e],p[a]))}c.value(l);setTimeout(function(){cursorPos.codemirror.focus()},200);cursorPos.codemirror.setCursor({line:l.length,ch:l.length});parent.$("#is_mobile").val()=="false"&&$("#save-edit").prop("disabled","true");b=$(this).closest("div").find(".markDownComment").text();$(".CodeMirror").on("keypress keyup","textarea",function(n){var t=c.value();t.length>=4e3?n.preventDefault():(elementNode=$("#edit_comment_"+y).parent(),userMentionInitializing(n,elementNode));b!=t.trim()?$("#save-edit").removeAttr("disabled"):$("#save-edit").prop("disabled","true")});$(".editor-toolbar").on("click",function(){$("textarea").keypress()});$("#save-edit").on("click",function(){var f=truncateUrl(),l=f.split("?"),e="",s,i;l.length>1&&(e=l[1]);s=f.split("/");t.toLowerCase()=="report"&&(f=e!=""?"/"+s[1]+"/"+n+"/"+r+"/"+u+"?"+e:"/"+s[1]+"/"+n+"/"+r+"/"+u);i=c.value();i=getRelativePath(i);var a=$(this).closest(".post").attr("data-comment-id"),v=$("#edit_comment_"+a).parent(),h=splitUserMention(v),y={itemId:itemId,comment:i,commentId:a,itemType:t,dashboardItemId:n,url:decodeURI(f),uniqueUsersValue:h.uniqueUsersValue,uniqueGroupValue:h.uniqueGroupValue,mentionedAll:h.mentionedAll,commentAction:commentAction.Edit,parentDashboardId:parentDashboardId,currentDate:date},p=c.options.previewRender(i).replace("#",""),w=i,b=w.replace("http://","").replace("https://","").replace("(","").replace(")","").replace("![]","");if(isEmptyOrWhitespace(p.replace(/<[^>]*>!/ig,""))||isEmptyOrWhitespace(b)){$(".edit-text").addClass("inactive-box");$(".error-message-edit").html("<span class='validate-fail'>"+window.Server.App.LocalizationContent.CommentValidator+"<\/span>");return}if(i.length>4e3){$(".reply-text").addClass("inactive-box");$(".error-message-edit").html("<span class='validate-fail'>"+window.Server.App.LocalizationContent.CommnetLengthValidator+"<\/span>");return}showWaitingPopup($("#save-edit").parentsUntil(".post").find(".edit-post"));parent.ajaxPostCall("POST",editCommentUrl,y,null,o,null,null)});$(".edit-cancel").on("click",function(){$(".post-message").removeClass("displayNone");$(".edit-post").addClass("displayNone");$(".edit-post").html("");$(".error-message-edit").html("");refreshCommentScroller()})});$(document).on("click",".reply-comment",function(){var f,o,h,e;i.value("");f=$(this).parents("menu").siblings(".post-meta").find("a.permalink");o=$(f).attr("href").split("comment-")[1];typeof o=="undefined"&&(o=$(f).attr("href").split("comment=")[1]);$(f).attr("href","#comment-"+o);$(f).attr("target","");h=$(this).parents(".post").attr("data-comment-id");$("#comment_action_area").removeClass("isHide");$("#comment_action_area").show();$("#comment_submit_container").hide();$(".post-message").removeClass("displayNone");$(".edit-post").addClass("displayNone");$(".edit-post").html("");$(".reply-form-container").html("");$(".reply-form-container").addClass("displayNone");$(".reply-form-container").attr("id","");$(this).closest("div").parent().parent().find(".reply-form-container").html("<textarea id='replyto_comment_"+h+"' class='form-control reply-text' maxlength='4000' style='overflow: hidden;'><\/textarea><span class='message'>*"+window.Server.App.LocalizationContent.CommentWords+"<\/span><div class='reply-comment-footer'><span class='error-message-reply'><\/span><button class='reply-cancel secondary-button pull-right'>"+window.Server.App.LocalizationContent.CancelButton+"<\/button><input id='post-reply' class='primary-button pull-right' value='"+window.Server.App.LocalizationContent.ReplyButton+"' type='submit'><\/div>");e=renderMde("#replyto_comment_"+h);cursorPos=e;$(this).closest("div").parent().parent().find(".reply-form-container").attr("id","replyComment");$("#replyComment").removeClass("displayNone");refreshCommentScroller();$(f).find("span.time-ago").click();setTimeout(function(){cursorPos.codemirror.focus()},200);cursorPos.codemirror.setCursor({line:0,ch:0});$("#replyComment > .CodeMirror").on("keypress","textarea",function(n){var t=e.value();t.length>=4e3?n.preventDefault():(elementNode=$("#replyComment > .CodeMirror"),userMentionInitializing(n,elementNode))});$("#post-reply").on("click",function(){var f=truncateUrl(),l=f.split("?"),o="",h;l.length>1&&(o=l[1]);h=f.split("/");t.toLowerCase()=="report"&&(f=o!==""?"/"+h[1]+"/"+n+"/"+r+"/"+u+"?"+o:"/"+h[1]+"/"+n+"/"+r+"/"+u);var i=e.value(),a=$("#replyComment > .CodeMirror"),c=splitUserMention(a);i=getRelativePath(i);var v=$(this).closest(".post").attr("data-comment-id"),y={itemId:itemId,comment:i,parentId:v,itemType:t,dashboardItemId:n,url:decodeURI(f),uniqueUsersValue:c.uniqueUsersValue,uniqueGroupValue:c.uniqueGroupValue,mentionedAll:c.mentionedAll,parentDashboardId:parentDashboardId,currentDate:date},p=e.options.previewRender(i).replace("#",""),w=i,b=w.replace("http://","").replace("https://","").replace("(","").replace(")","").replace("![]","");if(isEmptyOrWhitespace(p.replace(/<[^>]*>!/ig,""))||isEmptyOrWhitespace(b)){$(".reply-text").addClass("inactive-box");$(".error-message-reply").html("<span class='validate-fail'>"+window.Server.App.LocalizationContent.ReplyValidator+"<\/span>");return}if(i.length>4e3){$(".reply-text").addClass("inactive-box");$(".error-message-reply").html("<span class='validate-fail'>"+window.Server.App.LocalizationContent.ReplayContenLength+"<\/span>");return}showWaitingPopup("replyComment");parent.ajaxPostCall("POST",addCommentUrl,y,null,s,null,null)});$(".reply-cancel").on("click",function(){$("#replyComment").addClass("displayNone");$(".reply-form-container").html("");$(".reply-form-container").attr("id","");$(".error-message-reply").html("");refreshCommentScroller()})});$(document).on("click",".delete-comment",function(){var i=truncateUrl(),o=i.split("?"),f="",e,s,c;o.length>1&&(f=o[1]);e=i.split("/");t.toLowerCase()=="report"&&(i=f!==""?"/"+e[1]+"/"+n+"/"+r+"/"+u+"?"+f:"/"+e[1]+"/"+n+"/"+r+"/"+u);s=$(this).closest(".post").attr("data-comment-id");c=$(this).closest(".post").attr("id");deletedCommentId=c;parent.messageBox("su-delete",window.Server.App.LocalizationContent.DeleteComment,window.Server.App.LocalizationContent.DeleteComentConfirm,"error",function(){var u=parent.createLoader("messageBox_wrapper"),r;$("#messageBox_wrapper").ejWaitingPopup({template:parent.$("#"+u)});$("#messageBox_wrapper").ejWaitingPopup("show");r={itemId:itemId,commentId:s,itemType:t,dashboardItemId:n,url:decodeURI(i),commentAction:commentAction.Delete,currentDate:date};parent.ajaxPostCall("POST",deleteCommentUrl,r,null,h,null,null)})});$(document).on("click",".watch-action",function(){var n;$(this).hasClass("disable-post")||($(".watch-action").addClass("disable-post"),$(this).hasClass("watch")?(n={itemId:itemId,isWatch:!0,currentDate:date},parent.ajaxPostCall("POST",watchUrl,n,null,c,null,null)):(n={itemId:itemId,isWatch:!1,currentDate:date},parent.ajaxPostCall("POST",unWatchUrl,n,null,l,null,null)))});$(document).on("click",".parent",function(){var n="#comment-"+$(this).attr("data-parent-id"),i=$(n).find(".permalink:first").attr("href").split("comment-")[1],r,t;if(typeof i=="undefined"&&(i=$(n).find(".permalink:first").attr("href").split("comment=")[1]),$(n).find(".permalink:first").attr("href","#comment-"+i),$(n).find(".permalink:first").attr("target",""),$(n).isOnScreen()||$(n).find(".time-ago:first").click(),$(n).find(".post-content:first").css({"background-color":"#F4E4AE"}),i_am_ie9)for($(n).find(".post-content:first").css("backgroundColor","hsl(46,76%,82%"),r=3e3,t=82;t<=100;t=t+.1)r+=10,function(t,i){setTimeout(function(){$(n).find(".post-content:first").css("backgroundColor","hsl(46,76%,"+t+"%)")},i)}(t,r);else setTimeout(function(){$(n).find(".post-content:first").css({transition:"background-color 5s ease-in-out","background-color":"inherit"})},20),setTimeout(function(){$(n).find(".post-content:first").attr("style","")},4e3)});$(document).on("mousedown",".permalink",function(n){if(postId=$(this).attr("href").split("comment-")[1],typeof postId=="undefined"&&(postId=$(this).attr("href").split("comment=")[1]),n.which==2||n.which==3){var t=parent.document.URL;parent.window.location.href.indexOf("?comment")!=-1||parent.window.location.href.indexOf("?")==-1?(t=t.split("?comment=")[0],$(this).attr("href",t+"?comment="+postId)):(t=t.split("&comment=")[0],$(this).attr("href",t+"&comment="+postId));$(this).attr("target","_blank")}n.which==1&&($(this).attr("href","#comment-"+postId),$(this).attr("target",""))});$(document).on("click",".hasChild",function(){$(this).find(".collapse-icon").hasClass("su-vertical-expand")?($(this).find(".collapse-icon").parents(".post-content").siblings("ul.children").slideDown("slow",function(){refreshCommentScroller()}),$(this).find(".collapse-icon").addClass("su-vertical-collapse"),$(this).find(".collapse-icon").removeClass("su-vertical-expand"),$(this).find(".collapse-icon").parents(".reply-count").removeClass("expanded"),$(this).find(".collapse-icon").attr("title","Collapse")):($(this).find(".collapse-icon").parents(".post-content").siblings("ul.children").slideUp("slow",function(){refreshCommentScroller()}),$(this).find(".collapse-icon").addClass("su-vertical-expand"),$(this).find(".collapse-icon").removeClass("su-vertical-collapse"),$(this).find(".collapse-icon").parents(".reply-count").addClass("expanded"),$(this).find(".collapse-icon").attr("title","Expand"))});$(document).on("mouseover","#comment-image-file,#comment-image-edit-file",function(){var n,t,i=$.now(),r=$("#itemType").attr("data-item-type").toLowerCase().replace(/\b[a-z]/g,function(n){return n.toUpperCase()});$("#comment-image-file,#comment-image-edit-file").ejUploadbox({saveUrl:fileUploadUrl+"?imageType=commentimage&&timeStamp="+i+"&&itemId="+itemId+"&&itemType="+r,autoUpload:!0,showFileDetails:!1,multipleFilesSelection:!1,buttonText:{browse:""},width:"29px",height:"29px",showBrowseButton:!1,extensionsAllow:".PNG,.png,.jpg,.JPG,.jpeg,.JPEG",begin:function(){showWaitingPopup("parent-scroll-element")},fileSelect:function(i){$(".confirmatioMessage").hide();n=i.files[0].extension.toLowerCase();t=i.files[0].name},error:function(){if(n!=".png"&&n!=".jpg"&&n!=".jpeg"){$(".error-message").html("<span class='validate-fail'>"+window.Server.App.LocalizationContent.FileFormatNotsupport+"<\/span>");return}},complete:function(n){if(n.responseText!=""&&n.responseText.indexOf("image-")!==-1){var t=n.responseText.split(";"),i=" ![]("+t[1]+")";$("textarea").focus();cursorPos.codemirror.replaceSelection(i);hideWaitingPopup("parent-scroll-element");$("textarea").keypress()}}});$("#comment-image-file_SelectButton,#comment-image-file,#comment-image-edit-file,.e-uploadinput").attr("title",window.Server.App.LocalizationContent.UploadImage)});parent.$("#commentImage_popup").ejDialog({showOnInit:!1,allowDraggable:!1,enableResize:!1,showHeader:!1,enableModal:!0,close:"commentImageDialogClose",closeOnEscape:!0});$(document).on("click",".post-message > p > img",function(){var i=$(window).height();var r=parent.$(dashboardTypeId).width()==null?parent.$("#widget").width():parent.$(dashboardTypeId).width(),o=$(this).attr("src"),t,n,u,f,e=new Image;e.src=o;$(e).on("load",function(){t=e.width;n=e.height;i>n?(i-n>40?u=n:(n=i-7/100*i,u=n),parent.$("#commentImage_popup_wrapper").css({height:u}),parent.$("#commentImage_popup_image,#commentImage_popup,#PopupContainer,#commentImage_popup_wrapper .e-dialog-scroller").css({height:n})):(n=parent.$("#widget").height()!==null?n-(n-i+40):n-(n-i+20),u=n,parent.$("#commentImage_popup_wrapper").css({height:u}),parent.$("#commentImage_popup_image,#commentImage_popup,#PopupContainer,#commentImage_popup_wrapper .e-dialog-scroller").css({height:n}));r>=t&&t<=900?(r-t>40?f=t:(t=r-7/100*r,f=t),parent.$("#commentImage_popup_wrapper").css({width:f}),parent.$("#commentImage_popup_image,#commentImage_popup,#PopupContainer,#commentImage_popup_wrapper .e-dialog-scroller").css({width:t})):(t=r*(68/100),f=t,parent.$("#commentImage_popup_wrapper").css({width:f}),parent.$("#commentImage_popup_image,#commentImage_popup,#PopupContainer,#commentImage_popup_wrapper .e-dialog-scroller").css({width:t}));parent.$("#commentImage_popup_image").attr("src",o);parent.$("#commentImage_popup").removeClass("hidden");parent.$("#commentImage_popup").ejDialog("open")})});$(window).resize(function(){refreshCommentScroller()})});$.fn.isOnScreen=function(){windowHeight=$("#list_container").outerHeight();textAreaHeight=$("#comment_action_area").hasClass("isHide")?$("#comment_submit_container").outerHeight():$("#comment_action_area").outerHeight();var n=textAreaHeight+$(".count-sort").outerHeight();return offsetTop=this.offset().top,offsetTop>=n&&offsetTop<=windowHeight};$.fn.pastableTextarea=function(){for(var n,t=0,i=this.length;t<i;t++)(n=this[t],n._pastable||$(n).is(":not(textarea, input:text)"))||(Paste.mountTextarea(n),n._pastable=!0);return this};createHiddenEditable=function(){return $(document.createElement("div")).attr("contenteditable",!0).attr("aria-hidden",!0).attr("tabindex",-1).css({width:1,height:1,position:"fixed",left:-100,overflow:"hidden"})};isFocusable=function(n,t){var r,i,u,f,e,o;return(f=void 0,e=void 0,u=void 0,i=void 0,r=void 0,o=n.nodeName.toLowerCase(),"area"===o)?(f=n.parentNode,e=f.name,!n.href||!e||f.nodeName.toLowerCase()!=="map")?!1:(u=$("img[usemap='#"+e+"']"),u.length>0&&u.is(":visible")):(/^(input|select|textarea|button|object)$/.test(o)?(i=!n.disabled,i&&(r=$(n).closest("fieldset")[0],r&&(i=!r.disabled))):i="a"===o?n.href||t:t,i=i||$(n).is("[contenteditable]"),i&&$(n).is(":visible"))};Paste=function(){function n(n,t){this._container=n;this._target=t;this._container=$(this._container);this._target=$(this._target).addClass("pastable");this._container.on("paste",function(n){return function(t){showWaitingPopup("parent-scroll-element");var i,c,r,u,f,l,a,o,v,s,y,h,e;if(n._paste_event_fired=!0,((v=t.originalEvent)!=null?v.clipboardData:void 0)!=null)if(i=t.originalEvent.clipboardData,i.items)for(s=i.items,u=0,l=s.length;u<l;u++){if(r=s[u],r.type.match(/^image\//)){o=new FileReader;o.onload=function(t){return n._handleImage(t.target.result)};o.readAsDataURL(r.getAsFile());t.preventDefault();break}r.type==="text/plain"&&r.getAsString(function(t){setTimeout(function(){return hideWaitingPopup("parent-scroll-element"),n._target.trigger("pasteText",{text:t})},1)})}else-1!==Array.prototype.indexOf.call(i.types,"text/plain")&&(e=i.getData("Text"),setTimeout(function(){return hideWaitingPopup("parent-scroll-element"),n._target.trigger("pasteText",{text:e})},1)),n._checkImagesInContainer(function(t){return n._handleImage(t)});if(i=window.clipboardData)if((y=e=i.getData("Text"))!=null?y.length:void 0)setTimeout(function(){return hideWaitingPopup("parent-scroll-element"),n._target.trigger("pasteText",{text:e}),n._target.trigger("_pasteCheckContainerDone")},1);else{for(h=i.files,f=0,a=h.length;f<a;f++)c=h[f],n._handleImage(URL.createObjectURL(c));n._checkImagesInContainer(function(){})}return setTimeout(function(){hideWaitingPopup("parent-scroll-element")},1e3),null}}(this))}return n.prototype._target=null,n.prototype._container=null,n.mountNonInputable=function(t){var i=new n(createHiddenEditable().appendTo(t),t);$(t).on("click",function(){return function(n){if(!isFocusable(n.target,!1))return i._container.focus()}}(this));i._container.on("focus",function(){return function(){return $(t).addClass("pastable-focus")}}(this));return i._container.on("blur",function(){return function(){return $(t).removeClass("pastable-focus")}}(this))},n.mountTextarea=function(t){var r,i;if(DataTransfer.prototype.__lookupGetter__("items"))return this.mountContenteditable(t);i=new n(createHiddenEditable().insertBefore(t),t);r=!1;$(t).on("keyup",function(n){var t;return((t=n.keyCode)===17||t===224)&&(r=!1),null});$(t).on("keydown",function(n){var u;return((u=n.keyCode)===17||u===224)&&(r=!0),n.ctrlKey!=null&&n.metaKey!=null&&(r=n.ctrlKey||n.metaKey),r&&n.keyCode===86&&(i._textarea_focus_stolen=!0,i._container.focus(),i._paste_event_fired=!1,setTimeout(function(){return function(){if(!i._paste_event_fired)return $(t).focus(),i._textarea_focus_stolen=!1}}(this),1)),null});$(t).on("paste",function(){return function(){}}(this));$(t).on("focus",function(){return function(){if(!i._textarea_focus_stolen)return $(t).addClass("pastable-focus")}}(this));$(t).on("blur",function(){return function(){if(!i._textarea_focus_stolen)return $(t).removeClass("pastable-focus")}}(this));$(i._target).on("_pasteCheckContainerDone",function(){return function(){return $(t).focus(),i._textarea_focus_stolen=!1}}(this));return $(i._target).on("pasteText",function(){return function(n,i){var r=i.text;return cursorPos.codemirror.replaceSelection(r),hideWaitingPopup("parent-scroll-element"),$(t).trigger("change")}}(this))},n.mountContenteditable=function(t){var i=new n(t,t);$(t).on("focus",function(){return hideWaitingPopup("parent-scroll-element"),function(){return $(t).addClass("pastable-focus")}}(this));return $(t).on("blur",function(){return function(){return hideWaitingPopup("parent-scroll-element"),$(t).removeClass("pastable-focus")}}(this))},n.prototype._handleImage=function(n){var t;return t=new Image,t.crossOrigin="anonymous",t.onload=function(){return function(){var n,r,i;n=document.createElement("canvas");n.width=t.width;n.height=t.height;r=n.getContext("2d");r.drawImage(t,0,0,n.width,n.height);i=null;try{i=n.toDataURL("image/png");pasteImageReader(i)}catch(u){hideWaitingPopup("parent-scroll-element")}}}(this),t.onerror=function(){}(this),t.src=n},n.prototype._checkImagesInContainer=function(n){var t,i,f,r,u;for(u=Math.floor(1e3*Math.random()),r=this._container.find("img"),i=0,f=r.length;i<f;i++)t=r[i],t["_paste_marked_"+u]=!0;return setTimeout(function(i){return function(){var r,e,f;for(f=i._container.find("img"),f.length==0&&hideWaitingPopup("parent-scroll-element"),r=0,e=f.length;r<e;r++)t=f[r],t["_paste_marked_"+u]||(n(t.src),$(t).remove());return i._target.trigger("_pasteCheckContainerDone")}}(this),1)},n}();$(document).on("click","#close-comment",function(){$(".view-heading").css("display","none");$(".header-section a").css("display","none");parent.$("#commentImage_popup").ejDialog("close");parent.$("#commentModuleContainer").addClass("displayNone");parent.$("#delete_popup_iframe").addClass("displayNone");parent.$("#dashboard-comment").removeClass(" highlight-icon");parent.$("#widgetCommentModuleContainer").addClass("displayNone");parent.$("#is_mobile").val()=="true"&&(parent.$(dashboardTypeId).show(),parent.$("#server-mobile-navbar .server-comment").hasClass("active")&&(parent.$("#server-mobile-navbar a.active").removeClass("active"),parent.$("#server-mobile-navbar .su-nav-dashboard").addClass("active")));parent.$(".options").css("right","0px");parent.$(".options li").removeClass("active");iframeUrl==parentUrl?parent.$(dashboardTypeId).css("width",$(parent.window).width()):parent.$(".su-sidebar-collapse").is(":visible")||(parent.$(dashboardTypeId).css("width",parent.document.body.clientWidth-40),$(parent.parent.document.body).find("#item-viewer").css("width",parent.document.body.clientWidth-5))})